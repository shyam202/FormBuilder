{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nvar _fetchPonyfill2 = _interopRequireDefault(require(\"fetch-ponyfill\"));\n\nvar _EventEmitter = _interopRequireDefault(require(\"./EventEmitter\"));\n\nvar _browserCookies = _interopRequireDefault(require(\"browser-cookies\"));\n\nvar _providers = _interopRequireDefault(require(\"./providers\"));\n\nvar _intersection2 = _interopRequireDefault(require(\"lodash/intersection\"));\n\nvar _get2 = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _cloneDeep2 = _interopRequireDefault(require(\"lodash/cloneDeep\"));\n\nvar _defaults2 = _interopRequireDefault(require(\"lodash/defaults\"));\n\nvar _utils = require(\"./utils/utils\");\n\nvar _jwtDecode = _interopRequireDefault(require(\"jwt-decode\"));\n\nrequire(\"./polyfills\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e2) {\n          throw _e2;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e3) {\n      didErr = true;\n      err = _e3;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nvar _fetchPonyfill = (0, _fetchPonyfill2.default)({\n  Promise: _nativePromiseOnly.default\n}),\n    fetch = _fetchPonyfill.fetch,\n    Headers = _fetchPonyfill.Headers;\n\nvar isBoolean = function isBoolean(val) {\n  return _typeof(val) === _typeof(true);\n};\n\nvar isNil = function isNil(val) {\n  return val === null || val === undefined;\n};\n\nvar isObject = function isObject(val) {\n  return val && _typeof(val) === 'object';\n};\n\nfunction cloneResponse(response) {\n  var copy = (0, _cloneDeep2.default)(response);\n\n  if (Array.isArray(response)) {\n    copy.skip = response.skip;\n    copy.limit = response.limit;\n    copy.serverCount = response.serverCount;\n  }\n\n  return copy;\n}\n/**\n * The Formio interface class.\n *\n *   let formio = new Formio('https://examples.form.io/example');\n */\n\n\nvar Formio = /*#__PURE__*/function () {\n  /* eslint-disable max-statements */\n  function Formio(path) {\n    var _this = this;\n\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Formio); // Ensure we have an instance of Formio.\n\n\n    if (!(this instanceof Formio)) {\n      return new Formio(path);\n    } // Initialize our variables.\n\n\n    this.base = '';\n    this.projectsUrl = '';\n    this.projectUrl = '';\n    this.projectId = '';\n    this.roleUrl = '';\n    this.rolesUrl = '';\n    this.roleId = '';\n    this.formUrl = '';\n    this.formsUrl = '';\n    this.formId = '';\n    this.submissionsUrl = '';\n    this.submissionUrl = '';\n    this.submissionId = '';\n    this.actionsUrl = '';\n    this.actionId = '';\n    this.actionUrl = '';\n    this.vsUrl = '';\n    this.vId = '';\n    this.vUrl = '';\n    this.query = ''; // Store the original path and options.\n\n    this.path = path;\n    this.options = options;\n\n    if (options.hasOwnProperty('base')) {\n      this.base = options.base;\n    } else if (Formio.baseUrl) {\n      this.base = Formio.baseUrl;\n    } else if (typeof window !== 'undefined') {\n      this.base = window.location.href.match(/http[s]?:\\/\\/api./)[0];\n    }\n\n    if (!path) {\n      // Allow user to create new projects if this was instantiated without\n      // a url\n      this.projectUrl = Formio.projectUrl || \"\".concat(this.base, \"/project\");\n      this.projectsUrl = \"\".concat(this.base, \"/project\");\n      this.projectId = false;\n      this.query = '';\n      return;\n    }\n\n    if (options.hasOwnProperty('project')) {\n      this.projectUrl = options.project;\n    }\n\n    var project = this.projectUrl || Formio.projectUrl;\n    var projectRegEx = /(^|\\/)(project)($|\\/[^/]+)/;\n    var isProjectUrl = path.search(projectRegEx) !== -1; // The baseURL is the same as the projectUrl, and does not contain \"/project/MONGO_ID\" in\n    // its domain. This is almost certainly against the Open Source server.\n\n    if (project && this.base === project && !isProjectUrl) {\n      this.noProject = true;\n      this.projectUrl = this.base;\n    } // Normalize to an absolute path.\n\n\n    if (path.indexOf('http') !== 0 && path.indexOf('//') !== 0) {\n      path = this.base + path;\n    }\n\n    var hostparts = this.getUrlParts(path);\n    var parts = [];\n    var hostName = hostparts[1] + hostparts[2];\n    path = hostparts.length > 3 ? hostparts[3] : '';\n    var queryparts = path.split('?');\n\n    if (queryparts.length > 1) {\n      path = queryparts[0];\n      this.query = \"?\".concat(queryparts[1]);\n    } // Register a specific path.\n\n\n    var registerPath = function registerPath(name, base) {\n      _this[\"\".concat(name, \"sUrl\")] = \"\".concat(base, \"/\").concat(name);\n      var regex = new RegExp(\"/\".concat(name, \"/([^/]+)\"));\n\n      if (path.search(regex) !== -1) {\n        parts = path.match(regex);\n        _this[\"\".concat(name, \"Url\")] = parts ? base + parts[0] : '';\n        _this[\"\".concat(name, \"Id\")] = parts.length > 1 ? parts[1] : '';\n        base += parts[0];\n      }\n\n      return base;\n    }; // Register an array of items.\n\n\n    var registerItems = function registerItems(items, base, staticBase) {\n      for (var i in items) {\n        if (items.hasOwnProperty(i)) {\n          var item = items[i];\n\n          if (Array.isArray(item)) {\n            registerItems(item, base, true);\n          } else {\n            var newBase = registerPath(item, base);\n            base = staticBase ? base : newBase;\n          }\n        }\n      }\n    };\n\n    if (!this.projectUrl || this.projectUrl === this.base) {\n      // If a project uses Subdirectories path type, we need to specify a projectUrl\n      if (!this.projectUrl && !isProjectUrl && Formio.pathType === 'Subdirectories') {\n        var regex = \"^\".concat(hostName.replace(/\\//g, '\\\\/'), \".[^/]+\");\n        var match = project.match(new RegExp(regex));\n        this.projectUrl = match ? match[0] : hostName;\n      } else {\n        this.projectUrl = hostName;\n      }\n    } // Check if we have a specified path type.\n\n\n    var isNotSubdomainType = false;\n\n    if (Formio.pathType) {\n      isNotSubdomainType = Formio.pathType !== 'Subdomains';\n    }\n\n    if (!this.noProject) {\n      // Determine the projectUrl and projectId\n      if (isProjectUrl) {\n        // Get project id as project/:projectId.\n        registerItems(['project'], hostName);\n        path = path.replace(projectRegEx, '');\n      } else if (hostName === this.base) {\n        // Get project id as first part of path (subdirectory).\n        if (hostparts.length > 3 && path.split('/').length > 1) {\n          var pathParts = path.split('/');\n          pathParts.shift(); // Throw away the first /.\n\n          this.projectId = pathParts.shift();\n          path = \"/\".concat(pathParts.join('/'));\n          this.projectUrl = \"\".concat(hostName, \"/\").concat(this.projectId);\n        }\n      } else {\n        // Get project id from subdomain.\n        if (hostparts.length > 2 && (hostparts[2].split('.').length > 2 || hostName.includes('localhost')) && !isNotSubdomainType) {\n          this.projectUrl = hostName;\n          this.projectId = hostparts[2].split('.')[0];\n        }\n      }\n\n      this.projectsUrl = this.projectsUrl || \"\".concat(this.base, \"/project\");\n    } // Configure Role urls and role ids.\n\n\n    registerItems(['role'], this.projectUrl); // Configure Form urls and form ids.\n\n    if (/(^|\\/)(form)($|\\/)/.test(path)) {\n      registerItems(['form', ['submission', 'action', 'v']], this.projectUrl);\n    } else {\n      var subRegEx = new RegExp('/(submission|action|v)($|/.*)');\n      var subs = path.match(subRegEx);\n      this.pathType = subs && subs.length > 1 ? subs[1] : '';\n      path = path.replace(subRegEx, '');\n      path = path.replace(/\\/$/, '');\n      this.formsUrl = \"\".concat(this.projectUrl, \"/form\");\n      this.formUrl = path ? this.projectUrl + path : '';\n      this.formId = path.replace(/^\\/+|\\/+$/g, '');\n      var items = ['submission', 'action', 'v'];\n\n      for (var i in items) {\n        if (items.hasOwnProperty(i)) {\n          var item = items[i];\n          this[\"\".concat(item, \"sUrl\")] = \"\".concat(this.projectUrl + path, \"/\").concat(item);\n\n          if (this.pathType === item && subs.length > 2 && subs[2]) {\n            this[\"\".concat(item, \"Id\")] = subs[2].replace(/^\\/+|\\/+$/g, '');\n            this[\"\".concat(item, \"Url\")] = this.projectUrl + path + subs[0];\n          }\n        }\n      }\n    } // Set the app url if it is not set.\n\n\n    if (!Formio.projectUrlSet) {\n      Formio.projectUrl = this.projectUrl;\n    }\n  }\n  /* eslint-enable max-statements */\n\n\n  _createClass(Formio, [{\n    key: \"delete\",\n    value: function _delete(type, opts) {\n      var _id = \"\".concat(type, \"Id\");\n\n      var _url = \"\".concat(type, \"Url\");\n\n      if (!this[_id]) {\n        return _nativePromiseOnly.default.reject('Nothing to delete');\n      }\n\n      Formio.cache = {};\n      return this.makeRequest(type, this[_url], 'delete', null, opts);\n    }\n  }, {\n    key: \"index\",\n    value: function index(type, query, opts) {\n      var _url = \"\".concat(type, \"Url\");\n\n      query = query || '';\n\n      if (query && isObject(query)) {\n        query = \"?\".concat(Formio.serialize(query.params));\n      }\n\n      return this.makeRequest(type, this[_url] + query, 'get', null, opts);\n    }\n  }, {\n    key: \"save\",\n    value: function save(type, data, opts) {\n      var _id = \"\".concat(type, \"Id\");\n\n      var _url = \"\".concat(type, \"Url\");\n\n      var method = this[_id] || data._id ? 'put' : 'post';\n      var reqUrl = this[_id] ? this[_url] : this[\"\".concat(type, \"sUrl\")];\n\n      if (!this[_id] && data._id && method === 'put' && !reqUrl.includes(data._id)) {\n        reqUrl += \"/\".concat(data._id);\n      }\n\n      Formio.cache = {};\n      return this.makeRequest(type, reqUrl + this.query, method, data, opts);\n    }\n  }, {\n    key: \"load\",\n    value: function load(type, query, opts) {\n      var _id = \"\".concat(type, \"Id\");\n\n      var _url = \"\".concat(type, \"Url\");\n\n      if (query && isObject(query)) {\n        query = Formio.serialize(query.params);\n      }\n\n      if (query) {\n        query = this.query ? \"\".concat(this.query, \"&\").concat(query) : \"?\".concat(query);\n      } else {\n        query = this.query;\n      }\n\n      if (!this[_id]) {\n        return _nativePromiseOnly.default.reject(\"Missing \".concat(_id));\n      }\n\n      return this.makeRequest(type, this[_url] + query, 'get', null, opts);\n    }\n  }, {\n    key: \"makeRequest\",\n    value: function makeRequest() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return Formio.makeRequest.apply(Formio, [this].concat(args));\n    }\n  }, {\n    key: \"loadProject\",\n    value: function loadProject(query, opts) {\n      return this.load('project', query, opts);\n    }\n  }, {\n    key: \"saveProject\",\n    value: function saveProject(data, opts) {\n      return this.save('project', data, opts);\n    }\n  }, {\n    key: \"deleteProject\",\n    value: function deleteProject(opts) {\n      return this.delete('project', opts);\n    }\n  }, {\n    key: \"loadRole\",\n    value: function loadRole(opts) {\n      return this.load('role', null, opts);\n    }\n  }, {\n    key: \"saveRole\",\n    value: function saveRole(data, opts) {\n      return this.save('role', data, opts);\n    }\n  }, {\n    key: \"deleteRole\",\n    value: function deleteRole(opts) {\n      return this.delete('role', opts);\n    }\n  }, {\n    key: \"loadRoles\",\n    value: function loadRoles(opts) {\n      return this.index('roles', null, opts);\n    }\n  }, {\n    key: \"loadForm\",\n    value: function loadForm(query, opts) {\n      var _this2 = this;\n\n      return this.load('form', query, opts).then(function (currentForm) {\n        // Check to see if there isn't a number in vId.\n        if (!currentForm.revisions || isNaN(parseInt(_this2.vId))) {\n          return currentForm;\n        } // If a submission already exists but form is marked to load current version of form.\n\n\n        if (currentForm.revisions === 'current' && _this2.submissionId) {\n          return currentForm;\n        } // If they specified a revision form, load the revised form components.\n\n\n        if (query && isObject(query)) {\n          query = Formio.serialize(query.params);\n        }\n\n        if (query) {\n          query = _this2.query ? \"\".concat(_this2.query, \"&\").concat(query) : \"?\".concat(query);\n        } else {\n          query = _this2.query;\n        }\n\n        return _this2.makeRequest('form', _this2.vUrl + query, 'get', null, opts).then(function (revisionForm) {\n          currentForm._vid = revisionForm._vid;\n          currentForm.components = revisionForm.components;\n          currentForm.settings = revisionForm.settings; // Using object.assign so we don't cross polinate multiple form loads.\n\n          return Object.assign({}, currentForm);\n        }) // If we couldn't load the revision, just return the original form.\n        .catch(function () {\n          return Object.assign({}, currentForm);\n        });\n      });\n    }\n  }, {\n    key: \"saveForm\",\n    value: function saveForm(data, opts) {\n      return this.save('form', data, opts);\n    }\n  }, {\n    key: \"deleteForm\",\n    value: function deleteForm(opts) {\n      return this.delete('form', opts);\n    }\n  }, {\n    key: \"loadForms\",\n    value: function loadForms(query, opts) {\n      return this.index('forms', query, opts);\n    }\n  }, {\n    key: \"loadSubmission\",\n    value: function loadSubmission(query, opts) {\n      var _this3 = this;\n\n      return this.load('submission', query, opts).then(function (submission) {\n        _this3.vId = submission._fvid;\n        _this3.vUrl = \"\".concat(_this3.formUrl, \"/v/\").concat(_this3.vId);\n        return submission;\n      });\n    }\n  }, {\n    key: \"saveSubmission\",\n    value: function saveSubmission(data, opts) {\n      if (!isNaN(parseInt(this.vId))) {\n        data._fvid = this.vId;\n      }\n\n      return this.save('submission', data, opts);\n    }\n  }, {\n    key: \"deleteSubmission\",\n    value: function deleteSubmission(opts) {\n      return this.delete('submission', opts);\n    }\n  }, {\n    key: \"loadSubmissions\",\n    value: function loadSubmissions(query, opts) {\n      return this.index('submissions', query, opts);\n    }\n  }, {\n    key: \"loadAction\",\n    value: function loadAction(query, opts) {\n      return this.load('action', query, opts);\n    }\n  }, {\n    key: \"saveAction\",\n    value: function saveAction(data, opts) {\n      return this.save('action', data, opts);\n    }\n  }, {\n    key: \"deleteAction\",\n    value: function deleteAction(opts) {\n      return this.delete('action', opts);\n    }\n  }, {\n    key: \"loadActions\",\n    value: function loadActions(query, opts) {\n      return this.index('actions', query, opts);\n    }\n  }, {\n    key: \"availableActions\",\n    value: function availableActions() {\n      return this.makeRequest('availableActions', \"\".concat(this.formUrl, \"/actions\"));\n    }\n  }, {\n    key: \"actionInfo\",\n    value: function actionInfo(name) {\n      return this.makeRequest('actionInfo', \"\".concat(this.formUrl, \"/actions/\").concat(name));\n    }\n  }, {\n    key: \"isObjectId\",\n    value: function isObjectId(id) {\n      var checkForHexRegExp = new RegExp('^[0-9a-fA-F]{24}$');\n      return checkForHexRegExp.test(id);\n    }\n  }, {\n    key: \"getProjectId\",\n    value: function getProjectId() {\n      if (!this.projectId) {\n        return _nativePromiseOnly.default.resolve('');\n      }\n\n      if (this.isObjectId(this.projectId)) {\n        return _nativePromiseOnly.default.resolve(this.projectId);\n      } else {\n        return this.loadProject().then(function (project) {\n          return project._id;\n        });\n      }\n    }\n  }, {\n    key: \"getFormId\",\n    value: function getFormId() {\n      if (!this.formId) {\n        return _nativePromiseOnly.default.resolve('');\n      }\n\n      if (this.isObjectId(this.formId)) {\n        return _nativePromiseOnly.default.resolve(this.formId);\n      } else {\n        return this.loadForm().then(function (form) {\n          return form._id;\n        });\n      }\n    }\n  }, {\n    key: \"currentUser\",\n    value: function currentUser(options) {\n      return Formio.currentUser(this, options);\n    }\n  }, {\n    key: \"accessInfo\",\n    value: function accessInfo() {\n      return Formio.accessInfo(this);\n    }\n    /**\n     * Returns the JWT token for this instance.\n     *\n     * @return {*}\n     */\n\n  }, {\n    key: \"getToken\",\n    value: function getToken(options) {\n      return Formio.getToken(Object.assign({\n        formio: this\n      }, this.options, options));\n    }\n    /**\n     * Sets the JWT token for this instance.\n     *\n     * @return {*}\n     */\n\n  }, {\n    key: \"setToken\",\n    value: function setToken(token, options) {\n      return Formio.setToken(token, Object.assign({\n        formio: this\n      }, this.options, options));\n    }\n    /**\n     * Returns a temporary authentication token for single purpose token generation.\n     */\n\n  }, {\n    key: \"getTempToken\",\n    value: function getTempToken(expire, allowed, options) {\n      var token = Formio.getToken(options);\n\n      if (!token) {\n        return _nativePromiseOnly.default.reject('You must be authenticated to generate a temporary auth token.');\n      }\n\n      var authUrl = Formio.authUrl || this.projectUrl;\n      return this.makeRequest('tempToken', \"\".concat(authUrl, \"/token\"), 'GET', null, {\n        ignoreCache: true,\n        header: new Headers({\n          'x-expire': expire,\n          'x-allow': allowed\n        })\n      });\n    }\n    /**\n     * Get a download url for a submission PDF of this submission.\n     *\n     * @return {*}\n     */\n\n  }, {\n    key: \"getDownloadUrl\",\n    value: function getDownloadUrl(form) {\n      var _this4 = this;\n\n      if (!this.submissionId) {\n        return _nativePromiseOnly.default.resolve('');\n      }\n\n      if (!form) {\n        // Make sure to load the form first.\n        return this.loadForm().then(function (_form) {\n          if (!_form) {\n            return '';\n          }\n\n          return _this4.getDownloadUrl(_form);\n        });\n      }\n\n      var apiUrl = \"/project/\".concat(form.project);\n      apiUrl += \"/form/\".concat(form._id);\n      apiUrl += \"/submission/\".concat(this.submissionId);\n      apiUrl += '/download';\n      var download = this.base + apiUrl;\n      return new _nativePromiseOnly.default(function (resolve, reject) {\n        _this4.getTempToken(3600, \"GET:\".concat(apiUrl)).then(function (tempToken) {\n          download += \"?token=\".concat(tempToken.key);\n          resolve(download);\n        }, function () {\n          resolve(download);\n        }).catch(reject);\n      });\n    }\n  }, {\n    key: \"uploadFile\",\n    value: function uploadFile(storage, file, fileName, dir, progressCallback, url, options, fileKey, groupPermissions, groupId, uploadStartCallback, abortCallback) {\n      var _this5 = this;\n\n      var requestArgs = {\n        provider: storage,\n        method: 'upload',\n        file: file,\n        fileName: fileName,\n        dir: dir\n      };\n      fileKey = fileKey || 'file';\n      var request = Formio.pluginWait('preRequest', requestArgs).then(function () {\n        return Formio.pluginGet('fileRequest', requestArgs).then(function (result) {\n          if (storage && isNil(result)) {\n            var Provider = _providers.default.getProvider('storage', storage);\n\n            if (Provider) {\n              var provider = new Provider(_this5);\n\n              if (uploadStartCallback) {\n                uploadStartCallback();\n              }\n\n              return provider.uploadFile(file, fileName, dir, progressCallback, url, options, fileKey, groupPermissions, groupId, abortCallback);\n            } else {\n              throw 'Storage provider not found';\n            }\n          }\n\n          return result || {\n            url: ''\n          };\n        });\n      });\n      return Formio.pluginAlter('wrapFileRequestPromise', request, requestArgs);\n    }\n  }, {\n    key: \"downloadFile\",\n    value: function downloadFile(file, options) {\n      var _this6 = this;\n\n      var requestArgs = {\n        method: 'download',\n        file: file\n      };\n      var request = Formio.pluginWait('preRequest', requestArgs).then(function () {\n        return Formio.pluginGet('fileRequest', requestArgs).then(function (result) {\n          if (file.storage && isNil(result)) {\n            var Provider = _providers.default.getProvider('storage', file.storage);\n\n            if (Provider) {\n              var provider = new Provider(_this6);\n              return provider.downloadFile(file, options);\n            } else {\n              throw 'Storage provider not found';\n            }\n          }\n\n          return result || {\n            url: ''\n          };\n        });\n      });\n      return Formio.pluginAlter('wrapFileRequestPromise', request, requestArgs);\n    }\n  }, {\n    key: \"deleteFile\",\n    value: function deleteFile(file, options) {\n      var _this7 = this;\n\n      var requestArgs = {\n        method: 'delete',\n        file: file\n      };\n      var request = Formio.pluginWait('preRequest', requestArgs).then(function () {\n        return Formio.pluginGet('fileRequest', requestArgs).then(function (result) {\n          if (file.storage && isNil(result)) {\n            var Provider = _providers.default.getProvider('storage', file.storage);\n\n            if (Provider) {\n              var provider = new Provider(_this7);\n              return provider.deleteFile(file, options);\n            } else {\n              throw 'Storage provider not found';\n            }\n          }\n\n          return result || {\n            url: ''\n          };\n        });\n      });\n      return Formio.pluginAlter('wrapFileRequestPromise', request, requestArgs);\n    }\n    /**\n     * Returns the user permissions to a form and submission.\n     *\n     * @param user - The user or current user if undefined. For anonymous, use \"null\"\n     * @param form - The form or current form if undefined. For no form check, use \"null\"\n     * @param submission - The submisison or \"index\" if undefined.\n     *\n     * @return {create: boolean, read: boolean, edit: boolean, delete: boolean}\n     */\n\n  }, {\n    key: \"userPermissions\",\n    value: function userPermissions(user, form, submission) {\n      return _nativePromiseOnly.default.all([form !== undefined ? _nativePromiseOnly.default.resolve(form) : this.loadForm(), user !== undefined ? _nativePromiseOnly.default.resolve(user) : this.currentUser(), submission !== undefined || !this.submissionId ? _nativePromiseOnly.default.resolve(submission) : this.loadSubmission(), this.accessInfo()]).then(function (results) {\n        var form = results.shift();\n        var user = results.shift() || {\n          _id: false,\n          roles: []\n        };\n        var submission = results.shift();\n        var access = results.shift();\n        var permMap = {\n          create: 'create',\n          read: 'read',\n          update: 'edit',\n          delete: 'delete'\n        };\n        var perms = {\n          user: user,\n          form: form,\n          access: access,\n          create: false,\n          read: false,\n          edit: false,\n          delete: false\n        };\n\n        for (var roleName in access.roles) {\n          if (access.roles.hasOwnProperty(roleName)) {\n            var role = access.roles[roleName];\n\n            if (role.default && user._id === false) {\n              // User is anonymous. Add the anonymous role.\n              user.roles.push(role._id);\n            } else if (role.admin && user.roles.indexOf(role._id) !== -1) {\n              perms.create = true;\n              perms.read = true;\n              perms.delete = true;\n              perms.edit = true;\n              return perms;\n            }\n          }\n        }\n\n        if (form && form.submissionAccess) {\n          for (var i = 0; i < form.submissionAccess.length; i++) {\n            var permission = form.submissionAccess[i];\n\n            var _permission$type$spli = permission.type.split('_'),\n                _permission$type$spli2 = _slicedToArray(_permission$type$spli, 2),\n                perm = _permission$type$spli2[0],\n                scope = _permission$type$spli2[1];\n\n            if (['create', 'read', 'update', 'delete'].includes(perm)) {\n              if ((0, _intersection2.default)(permission.roles, user.roles).length) {\n                perms[permMap[perm]] = scope === 'all' || !submission || user._id === submission.owner;\n              }\n            }\n          }\n        } // check for Group Permissions\n\n\n        if (submission) {\n          // we would anyway need to loop through components for create permission, so we'll do that for all of them\n          (0, _utils.eachComponent)(form.components, function (component, path) {\n            if (component && component.defaultPermission) {\n              var value = (0, _get2.default)(submission.data, path); // make it work for single-select Group and multi-select Group\n\n              var groups = Array.isArray(value) ? value : [value];\n              groups.forEach(function (group) {\n                if (group && group._id && // group id is present\n                user.roles.indexOf(group._id) > -1 // user has group id in his roles\n                ) {\n                    if (component.defaultPermission === 'read') {\n                      perms[permMap.read] = true;\n                    }\n\n                    if (component.defaultPermission === 'create') {\n                      perms[permMap.create] = true;\n                      perms[permMap.read] = true;\n                    }\n\n                    if (component.defaultPermission === 'write') {\n                      perms[permMap.create] = true;\n                      perms[permMap.read] = true;\n                      perms[permMap.update] = true;\n                    }\n\n                    if (component.defaultPermission === 'admin') {\n                      perms[permMap.create] = true;\n                      perms[permMap.read] = true;\n                      perms[permMap.update] = true;\n                      perms[permMap.delete] = true;\n                    }\n                  }\n              });\n            }\n          });\n        }\n\n        return perms;\n      });\n    }\n    /**\n     * Determine if the current user can submit a form.\n     * @return {*}\n     */\n\n  }, {\n    key: \"canSubmit\",\n    value: function canSubmit() {\n      var _this8 = this;\n\n      return this.userPermissions().then(function (perms) {\n        // If there is user and they cannot create, then check anonymous user permissions.\n        if (!perms.create && Formio.getUser()) {\n          return _this8.userPermissions(null).then(function (anonPerms) {\n            if (anonPerms.create) {\n              Formio.setUser(null);\n              return true;\n            }\n\n            return false;\n          });\n        }\n\n        return perms.create;\n      });\n    }\n  }, {\n    key: \"getUrlParts\",\n    value: function getUrlParts(url) {\n      return Formio.getUrlParts(url, this);\n    }\n  }], [{\n    key: \"loadProjects\",\n    value: function loadProjects(query, opts) {\n      query = query || '';\n\n      if (isObject(query)) {\n        query = \"?\".concat(Formio.serialize(query.params));\n      }\n\n      return Formio.makeStaticRequest(\"\".concat(Formio.baseUrl, \"/project\").concat(query), 'GET', null, opts);\n    }\n  }, {\n    key: \"getUrlParts\",\n    value: function getUrlParts(url, formio) {\n      var base = formio && formio.base ? formio.base : Formio.baseUrl;\n      var regex = '^(http[s]?:\\\\/\\\\/)';\n\n      if (base && url.indexOf(base) === 0) {\n        regex += \"(\".concat(base.replace(/^http[s]?:\\/\\//, ''), \")\");\n      } else {\n        regex += '([^/]+)';\n      }\n\n      regex += '($|\\\\/.*)';\n      return url.match(new RegExp(regex));\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize(obj, _interpolate) {\n      var str = [];\n\n      var interpolate = function interpolate(item) {\n        return _interpolate ? _interpolate(item) : item;\n      };\n\n      for (var p in obj) {\n        if (obj.hasOwnProperty(p)) {\n          str.push(\"\".concat(encodeURIComponent(p), \"=\").concat(encodeURIComponent(interpolate(obj[p]))));\n        }\n      }\n\n      return str.join('&');\n    }\n  }, {\n    key: \"getRequestArgs\",\n    value: function getRequestArgs(formio, type, url, method, data, opts) {\n      method = (method || 'GET').toUpperCase();\n\n      if (!opts || !isObject(opts)) {\n        opts = {};\n      }\n\n      var requestArgs = {\n        url: url,\n        method: method,\n        data: data || null,\n        opts: opts\n      };\n\n      if (type) {\n        requestArgs.type = type;\n      }\n\n      if (formio) {\n        requestArgs.formio = formio;\n      }\n\n      return requestArgs;\n    }\n  }, {\n    key: \"makeStaticRequest\",\n    value: function makeStaticRequest(url, method, data, opts) {\n      var requestArgs = Formio.getRequestArgs(null, '', url, method, data, opts);\n      var request = Formio.pluginWait('preRequest', requestArgs).then(function () {\n        return Formio.pluginGet('staticRequest', requestArgs).then(function (result) {\n          if (isNil(result)) {\n            return Formio.request(requestArgs.url, requestArgs.method, requestArgs.data, requestArgs.opts.header, requestArgs.opts);\n          }\n\n          return result;\n        });\n      });\n      return Formio.pluginAlter('wrapStaticRequestPromise', request, requestArgs);\n    }\n  }, {\n    key: \"makeRequest\",\n    value: function makeRequest(formio, type, url, method, data, opts) {\n      if (!formio) {\n        return Formio.makeStaticRequest(url, method, data, opts);\n      }\n\n      var requestArgs = Formio.getRequestArgs(formio, type, url, method, data, opts);\n      requestArgs.opts = requestArgs.opts || {};\n      requestArgs.opts.formio = formio; //for Formio requests default Accept and Content-type headers\n\n      if (!requestArgs.opts.headers) {\n        requestArgs.opts.headers = {};\n      }\n\n      requestArgs.opts.headers = (0, _defaults2.default)(requestArgs.opts.headers, {\n        'Accept': 'application/json',\n        'Content-type': 'application/json'\n      });\n      var request = Formio.pluginWait('preRequest', requestArgs).then(function () {\n        return Formio.pluginGet('request', requestArgs).then(function (result) {\n          if (isNil(result)) {\n            return Formio.request(requestArgs.url, requestArgs.method, requestArgs.data, requestArgs.opts.header, requestArgs.opts);\n          }\n\n          return result;\n        });\n      });\n      return Formio.pluginAlter('wrapRequestPromise', request, requestArgs);\n    }\n  }, {\n    key: \"request\",\n    value: function request(url, method, data, header, opts) {\n      if (!url) {\n        return _nativePromiseOnly.default.reject('No url provided');\n      }\n\n      var _Formio = Formio;\n      method = (method || 'GET').toUpperCase(); // For reverse compatibility, if they provided the ignoreCache parameter,\n      // then change it back to the options format where that is a parameter.\n\n      if (isBoolean(opts)) {\n        opts = {\n          ignoreCache: opts\n        };\n      }\n\n      if (!opts || !isObject(opts)) {\n        opts = {};\n      } // Generate a cachekey.\n\n\n      var cacheKey = btoa(encodeURI(url)); // Get the cached promise to save multiple loads.\n\n      if (!opts.ignoreCache && method === 'GET' && _Formio.cache.hasOwnProperty(cacheKey)) {\n        return _nativePromiseOnly.default.resolve(cloneResponse(_Formio.cache[cacheKey]));\n      } // Set up and fetch request\n\n\n      var headers = header || new Headers(opts.headers || {\n        'Accept': 'application/json',\n        'Content-type': 'application/json'\n      });\n\n      var token = _Formio.getToken(opts);\n\n      if (token && !opts.noToken) {\n        headers.append('x-jwt-token', token);\n      } // The fetch-ponyfill can't handle a proper Headers class anymore. Change it back to an object.\n\n\n      var headerObj = {};\n      headers.forEach(function (value, name) {\n        headerObj[name] = value;\n      });\n      var options = {\n        method: method,\n        headers: headerObj,\n        mode: 'cors'\n      };\n\n      if (data) {\n        options.body = JSON.stringify(data);\n      } // Allow plugins to alter the options.\n\n\n      options = _Formio.pluginAlter('requestOptions', options, url);\n\n      if (options.namespace || _Formio.namespace) {\n        opts.namespace = options.namespace || _Formio.namespace;\n      }\n\n      var requestToken = options.headers['x-jwt-token'];\n\n      var result = _Formio.pluginAlter('wrapFetchRequestPromise', _Formio.fetch(url, options), {\n        url: url,\n        method: method,\n        data: data,\n        opts: opts\n      }).then(function (response) {\n        // Allow plugins to respond.\n        response = _Formio.pluginAlter('requestResponse', response, _Formio, data);\n\n        if (!response.ok) {\n          if (response.status === 440) {\n            _Formio.setToken(null, opts);\n\n            _Formio.events.emit('formio.sessionExpired', response.body);\n          } else if (response.status === 401) {\n            _Formio.events.emit('formio.unauthorized', response.body);\n          } else if (response.status === 416) {\n            _Formio.events.emit('formio.rangeIsNotSatisfiable', response.body);\n          } // Parse and return the error as a rejected promise to reject this promise\n\n\n          return (response.headers.get('content-type').includes('application/json') ? response.json() : response.text()).then(function (error) {\n            return _nativePromiseOnly.default.reject(error);\n          });\n        } // Handle fetch results\n\n\n        var token = response.headers.get('x-jwt-token'); // In some strange cases, the fetch library will return an x-jwt-token without sending\n        // one to the server. This has even been debugged on the server to verify that no token\n        // was introduced with the request, but the response contains a token. This is an Invalid\n        // case where we do not send an x-jwt-token and get one in return for any GET request.\n\n        var tokenIntroduced = false;\n\n        if (method === 'GET' && !requestToken && token && !opts.external && !url.includes('token=') && !url.includes('x-jwt-token=')) {\n          console.warn('Token was introduced in request.');\n          tokenIntroduced = true;\n        }\n\n        if (response.status >= 200 && response.status < 300 && token && token !== '' && !tokenIntroduced) {\n          _Formio.setToken(token, opts);\n        } // 204 is no content. Don't try to .json() it.\n\n\n        if (response.status === 204) {\n          return {};\n        }\n\n        var getResult = response.headers.get('content-type').includes('application/json') ? response.json() : response.text();\n        return getResult.then(function (result) {\n          // Add some content-range metadata to the result here\n          var range = response.headers.get('content-range');\n\n          if (range && isObject(result)) {\n            range = range.split('/');\n\n            if (range[0] !== '*') {\n              var skipLimit = range[0].split('-');\n              result.skip = Number(skipLimit[0]);\n              result.limit = skipLimit[1] - skipLimit[0] + 1;\n            }\n\n            result.serverCount = range[1] === '*' ? range[1] : Number(range[1]);\n          }\n\n          if (!opts.getHeaders) {\n            return result;\n          }\n\n          var headers = {};\n          response.headers.forEach(function (item, key) {\n            headers[key] = item;\n          }); // Return the result with the headers.\n\n          return {\n            result: result,\n            headers: headers\n          };\n        });\n      }).then(function (result) {\n        if (opts.getHeaders) {\n          return result;\n        } // Cache the response.\n\n\n        if (method === 'GET') {\n          _Formio.cache[cacheKey] = result;\n        }\n\n        return cloneResponse(result);\n      }).catch(function (err) {\n        if (err === 'Bad Token') {\n          _Formio.setToken(null, opts);\n\n          _Formio.events.emit('formio.badToken', err);\n        }\n\n        if (err.message) {\n          err.message = \"Could not connect to API server (\".concat(err.message, \")\");\n          err.networkError = true;\n        }\n\n        if (method === 'GET') {\n          delete _Formio.cache[cacheKey];\n        }\n\n        return _nativePromiseOnly.default.reject(err);\n      });\n\n      return result;\n    } // Needed to maintain reverse compatability...\n\n  }, {\n    key: \"token\",\n    get: function get() {\n      if (!Formio.tokens) {\n        Formio.tokens = {};\n      }\n\n      return Formio.tokens.formioToken || '';\n    } // Needed to maintain reverse compatability...\n    ,\n    set: function set(token) {\n      if (!Formio.tokens) {\n        Formio.tokens = {};\n      }\n\n      Formio.tokens.formioToken = token || '';\n    }\n  }, {\n    key: \"setToken\",\n    value: function setToken() {\n      var token = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      var opts = arguments.length > 1 ? arguments[1] : undefined;\n      token = token || '';\n      opts = typeof opts === 'string' ? {\n        namespace: opts\n      } : opts || {};\n      var tokenName = \"\".concat(opts.namespace || Formio.namespace || 'formio', \"Token\");\n\n      if (!Formio.tokens) {\n        Formio.tokens = {};\n      }\n\n      if (!token) {\n        if (!opts.fromUser) {\n          opts.fromToken = true;\n          Formio.setUser(null, opts);\n        } // iOS in private browse mode will throw an error but we can't detect ahead of time that we are in private mode.\n\n\n        try {\n          localStorage.removeItem(tokenName);\n        } catch (err) {\n          _browserCookies.default.erase(tokenName, {\n            path: '/'\n          });\n        }\n\n        Formio.tokens[tokenName] = token;\n        return _nativePromiseOnly.default.resolve(null);\n      }\n\n      if (Formio.tokens[tokenName] !== token) {\n        Formio.tokens[tokenName] = token; // iOS in private browse mode will throw an error but we can't detect ahead of time that we are in private mode.\n\n        try {\n          localStorage.setItem(tokenName, token);\n        } catch (err) {\n          _browserCookies.default.set(tokenName, token, {\n            path: '/'\n          });\n        }\n      } // Return or updates the current user\n\n\n      return this.currentUserResolved ? Formio.currentUser(opts.formio, opts) : _nativePromiseOnly.default.resolve(null);\n    }\n  }, {\n    key: \"getToken\",\n    value: function getToken(options) {\n      options = typeof options === 'string' ? {\n        namespace: options\n      } : options || {};\n      var tokenName = \"\".concat(options.namespace || Formio.namespace || 'formio', \"Token\");\n      var decodedTokenName = options.decode ? \"\".concat(tokenName, \"Decoded\") : tokenName;\n\n      if (!Formio.tokens) {\n        Formio.tokens = {};\n      }\n\n      if (Formio.tokens[decodedTokenName]) {\n        return Formio.tokens[decodedTokenName];\n      }\n\n      try {\n        Formio.tokens[tokenName] = localStorage.getItem(tokenName) || '';\n\n        if (options.decode) {\n          Formio.tokens[decodedTokenName] = Formio.tokens[tokenName] ? (0, _jwtDecode.default)(Formio.tokens[tokenName]) : {};\n          return Formio.tokens[decodedTokenName];\n        }\n\n        return Formio.tokens[tokenName];\n      } catch (e) {\n        Formio.tokens[tokenName] = _browserCookies.default.get(tokenName);\n        return Formio.tokens[tokenName];\n      }\n    }\n  }, {\n    key: \"setUser\",\n    value: function setUser(user) {\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var userName = \"\".concat(opts.namespace || Formio.namespace || 'formio', \"User\");\n\n      if (!user) {\n        if (!opts.fromToken) {\n          opts.fromUser = true;\n          Formio.setToken(null, opts);\n        } // Emit an event on the cleared user.\n\n\n        Formio.events.emit('formio.user', null); // iOS in private browse mode will throw an error but we can't detect ahead of time that we are in private mode.\n\n        try {\n          return localStorage.removeItem(userName);\n        } catch (err) {\n          return _browserCookies.default.erase(userName, {\n            path: '/'\n          });\n        }\n      } // iOS in private browse mode will throw an error but we can't detect ahead of time that we are in private mode.\n\n\n      try {\n        localStorage.setItem(userName, JSON.stringify(user));\n      } catch (err) {\n        _browserCookies.default.set(userName, JSON.stringify(user), {\n          path: '/'\n        });\n      } // Emit an event on the authenticated user.\n\n\n      Formio.events.emit('formio.user', user);\n    }\n  }, {\n    key: \"getUser\",\n    value: function getUser(options) {\n      options = options || {};\n      var userName = \"\".concat(options.namespace || Formio.namespace || 'formio', \"User\");\n\n      try {\n        return JSON.parse(localStorage.getItem(userName) || null);\n      } catch (e) {\n        return JSON.parse(_browserCookies.default.get(userName));\n      }\n    }\n  }, {\n    key: \"setBaseUrl\",\n    value: function setBaseUrl(url) {\n      Formio.baseUrl = url;\n\n      if (!Formio.projectUrlSet) {\n        Formio.projectUrl = url;\n      }\n    }\n  }, {\n    key: \"getBaseUrl\",\n    value: function getBaseUrl() {\n      return Formio.baseUrl;\n    }\n  }, {\n    key: \"setApiUrl\",\n    value: function setApiUrl(url) {\n      return Formio.setBaseUrl(url);\n    }\n  }, {\n    key: \"getApiUrl\",\n    value: function getApiUrl() {\n      return Formio.getBaseUrl();\n    }\n  }, {\n    key: \"setAppUrl\",\n    value: function setAppUrl(url) {\n      console.warn('Formio.setAppUrl() is deprecated. Use Formio.setProjectUrl instead.');\n      Formio.projectUrl = url;\n      Formio.projectUrlSet = true;\n    }\n  }, {\n    key: \"setProjectUrl\",\n    value: function setProjectUrl(url) {\n      Formio.projectUrl = url;\n      Formio.projectUrlSet = true;\n    }\n  }, {\n    key: \"setAuthUrl\",\n    value: function setAuthUrl(url) {\n      Formio.authUrl = url;\n    }\n  }, {\n    key: \"getAppUrl\",\n    value: function getAppUrl() {\n      console.warn('Formio.getAppUrl() is deprecated. Use Formio.getProjectUrl instead.');\n      return Formio.projectUrl;\n    }\n  }, {\n    key: \"getProjectUrl\",\n    value: function getProjectUrl() {\n      return Formio.projectUrl;\n    }\n  }, {\n    key: \"clearCache\",\n    value: function clearCache() {\n      Formio.cache = {};\n    }\n  }, {\n    key: \"noop\",\n    value: function noop() {}\n  }, {\n    key: \"identity\",\n    value: function identity(value) {\n      return value;\n    }\n  }, {\n    key: \"deregisterPlugin\",\n    value: function deregisterPlugin(plugin) {\n      var beforeLength = Formio.plugins.length;\n      Formio.plugins = Formio.plugins.filter(function (p) {\n        if (p !== plugin && p.__name !== plugin) {\n          return true;\n        }\n\n        (p.deregister || Formio.noop).call(plugin, Formio);\n        return false;\n      });\n      return beforeLength !== Formio.plugins.length;\n    }\n  }, {\n    key: \"registerPlugin\",\n    value: function registerPlugin(plugin, name) {\n      var __Formio = Formio;\n\n      __Formio.plugins.push(plugin);\n\n      __Formio.plugins.sort(function (a, b) {\n        return (b.priority || 0) - (a.priority || 0);\n      });\n\n      plugin.__name = name;\n\n      (plugin.init || __Formio.noop).call(plugin, __Formio);\n    }\n  }, {\n    key: \"getPlugin\",\n    value: function getPlugin(name) {\n      var _iterator = _createForOfIteratorHelper(Formio.plugins),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var plugin = _step.value;\n\n          if (plugin.__name === name) {\n            return plugin;\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      return null;\n    }\n  }, {\n    key: \"pluginWait\",\n    value: function pluginWait(pluginFn) {\n      for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n        args[_key2 - 1] = arguments[_key2];\n      }\n\n      return _nativePromiseOnly.default.all(Formio.plugins.map(function (plugin) {\n        var _ref;\n\n        return (_ref = plugin[pluginFn] || Formio.noop).call.apply(_ref, [plugin].concat(args));\n      }));\n    }\n  }, {\n    key: \"pluginGet\",\n    value: function pluginGet(pluginFn) {\n      for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n        args[_key3 - 1] = arguments[_key3];\n      }\n\n      var callPlugin = function callPlugin(index) {\n        var _ref2;\n\n        var plugin = Formio.plugins[index];\n\n        if (!plugin) {\n          return _nativePromiseOnly.default.resolve(null);\n        }\n\n        return _nativePromiseOnly.default.resolve((_ref2 = plugin[pluginFn] || Formio.noop).call.apply(_ref2, [plugin].concat(args))).then(function (result) {\n          if (!isNil(result)) {\n            return result;\n          }\n\n          return callPlugin(index + 1);\n        });\n      };\n\n      return callPlugin(0);\n    }\n  }, {\n    key: \"pluginAlter\",\n    value: function pluginAlter(pluginFn, value) {\n      for (var _len4 = arguments.length, args = new Array(_len4 > 2 ? _len4 - 2 : 0), _key4 = 2; _key4 < _len4; _key4++) {\n        args[_key4 - 2] = arguments[_key4];\n      }\n\n      return Formio.plugins.reduce(function (value, plugin) {\n        return (plugin[pluginFn] || Formio.identity).apply(void 0, [value].concat(args));\n      }, value);\n    }\n  }, {\n    key: \"accessInfo\",\n    value: function accessInfo(formio) {\n      var projectUrl = formio ? formio.projectUrl : Formio.projectUrl;\n      return Formio.makeRequest(formio, 'accessInfo', \"\".concat(projectUrl, \"/access\"));\n    }\n  }, {\n    key: \"projectRoles\",\n    value: function projectRoles(formio) {\n      var projectUrl = formio ? formio.projectUrl : Formio.projectUrl;\n      return Formio.makeRequest(formio, 'projectRoles', \"\".concat(projectUrl, \"/role\"));\n    }\n  }, {\n    key: \"currentUser\",\n    value: function currentUser(formio, options) {\n      var _this9 = this;\n\n      var authUrl = Formio.authUrl;\n\n      if (!authUrl) {\n        authUrl = formio ? formio.projectUrl : Formio.projectUrl || Formio.baseUrl;\n      }\n\n      authUrl += '/current';\n      var user = Formio.getUser(options);\n\n      if (user) {\n        return Formio.pluginAlter('wrapStaticRequestPromise', _nativePromiseOnly.default.resolve(user), {\n          url: authUrl,\n          method: 'GET',\n          options: options\n        });\n      }\n\n      var token = Formio.getToken(options);\n\n      if ((!options || !options.external) && !token) {\n        return Formio.pluginAlter('wrapStaticRequestPromise', _nativePromiseOnly.default.resolve(null), {\n          url: authUrl,\n          method: 'GET',\n          options: options\n        });\n      }\n\n      this.currentUserResolved = false;\n      return Formio.makeRequest(formio, 'currentUser', authUrl, 'GET', null, options).then(function (response) {\n        _this9.currentUserResolved = true;\n        Formio.setUser(response, options);\n        return response;\n      });\n    }\n  }, {\n    key: \"logout\",\n    value: function logout(formio, options) {\n      options = options || {};\n      options.formio = formio;\n      var projectUrl = Formio.authUrl ? Formio.authUrl : formio ? formio.projectUrl : Formio.baseUrl;\n      return Formio.makeRequest(formio, 'logout', \"\".concat(projectUrl, \"/logout\")).then(function (result) {\n        Formio.setToken(null, options);\n        Formio.setUser(null, options);\n        Formio.clearCache();\n        return result;\n      }).catch(function (err) {\n        Formio.setToken(null, options);\n        Formio.setUser(null, options);\n        Formio.clearCache();\n        throw err;\n      });\n    }\n  }, {\n    key: \"pageQuery\",\n    value: function pageQuery() {\n      var pageQuery = {};\n      pageQuery.paths = [];\n      var hashes = location.hash.substr(1).replace(/\\?/g, '&').split('&');\n      var parts = [];\n      location.search.substr(1).split('&').forEach(function (item) {\n        parts = item.split('=');\n\n        if (parts.length > 1) {\n          pageQuery[parts[0]] = parts[1] && decodeURIComponent(parts[1]);\n        }\n      });\n      hashes.forEach(function (item) {\n        parts = item.split('=');\n\n        if (parts.length > 1) {\n          pageQuery[parts[0]] = parts[1] && decodeURIComponent(parts[1]);\n        } else if (item.indexOf('/') === 0) {\n          pageQuery.paths = item.substr(1).split('/');\n        }\n      });\n      return pageQuery;\n    }\n  }, {\n    key: \"oAuthCurrentUser\",\n    value: function oAuthCurrentUser(formio, token) {\n      return Formio.currentUser(formio, {\n        external: true,\n        headers: {\n          Authorization: \"Bearer \".concat(token)\n        }\n      });\n    }\n  }, {\n    key: \"samlInit\",\n    value: function samlInit(options) {\n      options = options || {};\n      var query = Formio.pageQuery();\n\n      if (query.saml) {\n        Formio.setUser(null);\n        var retVal = Formio.setToken(query.saml);\n        var uri = window.location.toString();\n        uri = uri.substring(0, uri.indexOf('?'));\n\n        if (window.location.hash) {\n          uri += window.location.hash;\n        }\n\n        window.history.replaceState({}, document.title, uri);\n        return retVal;\n      } // Set the relay if not provided.\n\n\n      if (!options.relay) {\n        options.relay = window.location.href;\n      } // go to the saml sso endpoint for this project.\n\n\n      var authUrl = Formio.authUrl || Formio.projectUrl;\n      window.location.href = \"\".concat(authUrl, \"/saml/sso?relay=\").concat(encodeURI(options.relay));\n      return false;\n    }\n  }, {\n    key: \"oktaInit\",\n    value: function oktaInit(options) {\n      options = options || {};\n\n      if ((typeof OktaAuth === \"undefined\" ? \"undefined\" : _typeof(OktaAuth)) !== undefined) {\n        options.OktaAuth = OktaAuth;\n      }\n\n      if (_typeof(options.OktaAuth) === undefined) {\n        var errorMessage = 'Cannot find OktaAuth. Please include the Okta JavaScript SDK within your application. See https://developer.okta.com/code/javascript/okta_auth_sdk for an example.';\n        console.warn(errorMessage);\n        return _nativePromiseOnly.default.reject(errorMessage);\n      }\n\n      return new _nativePromiseOnly.default(function (resolve, reject) {\n        var Okta = options.OktaAuth;\n        delete options.OktaAuth;\n        var authClient = new Okta(options);\n        authClient.tokenManager.get('accessToken').then(function (accessToken) {\n          if (accessToken) {\n            resolve(Formio.oAuthCurrentUser(options.formio, accessToken.accessToken));\n          } else if (location.hash) {\n            authClient.token.parseFromUrl().then(function (token) {\n              authClient.tokenManager.add('accessToken', token);\n              resolve(Formio.oAuthCurrentUser(options.formio, token.accessToken));\n            }).catch(function (err) {\n              console.warn(err);\n              reject(err);\n            });\n          } else {\n            authClient.token.getWithRedirect({\n              responseType: 'token',\n              scopes: options.scopes\n            });\n            resolve(false);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    }\n  }, {\n    key: \"ssoInit\",\n    value: function ssoInit(type, options) {\n      switch (type) {\n        case 'saml':\n          return Formio.samlInit(options);\n\n        case 'okta':\n          return Formio.oktaInit(options);\n\n        default:\n          console.warn('Unknown SSO type');\n          return _nativePromiseOnly.default.reject('Unknown SSO type');\n      }\n    }\n  }, {\n    key: \"requireLibrary\",\n    value: function requireLibrary(name, property, src, polling) {\n      if (!Formio.libraries.hasOwnProperty(name)) {\n        Formio.libraries[name] = {};\n        Formio.libraries[name].ready = new _nativePromiseOnly.default(function (resolve, reject) {\n          Formio.libraries[name].resolve = resolve;\n          Formio.libraries[name].reject = reject;\n        });\n        var callbackName = \"\".concat(name, \"Callback\");\n\n        if (!polling && !window[callbackName]) {\n          window[callbackName] = function () {\n            return Formio.libraries[name].resolve();\n          };\n        } // See if the plugin already exists.\n\n\n        var plugin = (0, _get2.default)(window, property);\n\n        if (plugin) {\n          Formio.libraries[name].resolve(plugin);\n        } else {\n          src = Array.isArray(src) ? src : [src];\n          src.forEach(function (lib) {\n            var attrs = {};\n            var elementType = '';\n\n            if (typeof lib === 'string') {\n              lib = {\n                type: 'script',\n                src: lib\n              };\n            }\n\n            switch (lib.type) {\n              case 'script':\n                elementType = 'script';\n                attrs = {\n                  src: lib.src,\n                  type: 'text/javascript',\n                  defer: true,\n                  async: true,\n                  referrerpolicy: 'origin'\n                };\n                break;\n\n              case 'styles':\n                elementType = 'link';\n                attrs = {\n                  href: lib.src,\n                  rel: 'stylesheet'\n                };\n                break;\n            } // Add the script to the top of the page.\n\n\n            var element = document.createElement(elementType);\n\n            if (element.setAttribute) {\n              for (var attr in attrs) {\n                element.setAttribute(attr, attrs[attr]);\n              }\n            }\n\n            var _document = document,\n                head = _document.head;\n\n            if (head) {\n              head.appendChild(element);\n            }\n          }); // if no callback is provided, then check periodically for the script.\n\n          if (polling) {\n            var interval = setInterval(function () {\n              var plugin = (0, _get2.default)(window, property);\n\n              if (plugin) {\n                clearInterval(interval);\n                Formio.libraries[name].resolve(plugin);\n              }\n            }, 200);\n          }\n        }\n      }\n\n      return Formio.libraries[name].ready;\n    }\n  }, {\n    key: \"libraryReady\",\n    value: function libraryReady(name) {\n      if (Formio.libraries.hasOwnProperty(name) && Formio.libraries[name].ready) {\n        return Formio.libraries[name].ready;\n      }\n\n      return _nativePromiseOnly.default.reject(\"\".concat(name, \" library was not required.\"));\n    }\n  }, {\n    key: \"addToGlobal\",\n    value: function addToGlobal(global) {\n      if (_typeof(global) === 'object' && !global.Formio) {\n        global.Formio = Formio;\n      }\n    }\n  }, {\n    key: \"setPathType\",\n    value: function setPathType(type) {\n      if (typeof type === 'string') {\n        Formio.pathType = type;\n      }\n    }\n  }, {\n    key: \"getPathType\",\n    value: function getPathType() {\n      return Formio.pathType;\n    }\n  }]);\n\n  return Formio;\n}(); // Define all the static properties.\n\n\n_defineProperty(Formio, \"currentUserResolved\", true);\n\nFormio.libraries = {};\nFormio.Promise = _nativePromiseOnly.default;\nFormio.fetch = fetch;\nFormio.Headers = Headers;\nFormio.baseUrl = 'https://api.form.io';\nFormio.projectUrl = Formio.baseUrl;\nFormio.authUrl = '';\nFormio.projectUrlSet = false;\nFormio.plugins = [];\nFormio.cache = {};\nFormio.Providers = _providers.default;\nFormio.version = '4.13.3';\nFormio.pathType = '';\nFormio.events = new _EventEmitter.default();\n\nif (typeof global !== 'undefined') {\n  Formio.addToGlobal(global);\n}\n\nif (typeof window !== 'undefined') {\n  Formio.addToGlobal(window);\n}\n\nvar _default = Formio;\nexports.default = _default;","map":{"version":3,"sources":["C:/Users/ShyamLakhani/Desktop/my-app/node_modules/formiojs/Formio.js"],"names":["Object","defineProperty","exports","value","default","_nativePromiseOnly","_interopRequireDefault","require","_fetchPonyfill2","_EventEmitter","_browserCookies","_providers","_intersection2","_get2","_cloneDeep2","_defaults2","_utils","_jwtDecode","obj","__esModule","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","e","_e2","f","TypeError","normalCompletion","didErr","err","call","step","next","_e3","return","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","minLen","_arrayLikeToArray","prototype","toString","slice","constructor","name","from","test","len","arr2","_i","_arr","_n","_d","_s","_e","push","_classCallCheck","instance","Constructor","_defineProperties","target","props","descriptor","enumerable","configurable","writable","key","_createClass","protoProps","staticProps","_defineProperty","_typeof","_fetchPonyfill","Promise","fetch","Headers","isBoolean","val","isNil","undefined","isObject","cloneResponse","response","copy","skip","limit","serverCount","Formio","path","_this","options","arguments","base","projectsUrl","projectUrl","projectId","roleUrl","rolesUrl","roleId","formUrl","formsUrl","formId","submissionsUrl","submissionUrl","submissionId","actionsUrl","actionId","actionUrl","vsUrl","vId","vUrl","query","hasOwnProperty","baseUrl","window","location","href","match","concat","project","projectRegEx","isProjectUrl","search","noProject","indexOf","hostparts","getUrlParts","parts","hostName","queryparts","split","registerPath","regex","RegExp","registerItems","items","staticBase","item","newBase","pathType","replace","isNotSubdomainType","pathParts","shift","join","includes","subRegEx","subs","projectUrlSet","_delete","type","opts","_id","_url","reject","cache","makeRequest","index","serialize","params","save","data","method","reqUrl","load","_len","args","_key","apply","loadProject","saveProject","deleteProject","delete","loadRole","saveRole","deleteRole","loadRoles","loadForm","_this2","then","currentForm","revisions","isNaN","parseInt","revisionForm","_vid","components","settings","assign","catch","saveForm","deleteForm","loadForms","loadSubmission","_this3","submission","_fvid","saveSubmission","deleteSubmission","loadSubmissions","loadAction","saveAction","deleteAction","loadActions","availableActions","actionInfo","isObjectId","id","checkForHexRegExp","getProjectId","resolve","getFormId","form","currentUser","accessInfo","getToken","formio","setToken","token","getTempToken","expire","allowed","authUrl","ignoreCache","header","getDownloadUrl","_this4","_form","apiUrl","download","tempToken","uploadFile","storage","file","fileName","dir","progressCallback","url","fileKey","groupPermissions","groupId","uploadStartCallback","abortCallback","_this5","requestArgs","provider","request","pluginWait","pluginGet","result","Provider","getProvider","pluginAlter","downloadFile","_this6","deleteFile","_this7","userPermissions","user","all","results","roles","access","permMap","create","read","update","perms","edit","roleName","role","admin","submissionAccess","permission","_permission$type$spli","_permission$type$spli2","perm","scope","owner","eachComponent","component","defaultPermission","groups","forEach","group","canSubmit","_this8","getUser","anonPerms","setUser","loadProjects","makeStaticRequest","_interpolate","str","interpolate","p","encodeURIComponent","getRequestArgs","toUpperCase","headers","_Formio","cacheKey","btoa","encodeURI","noToken","append","headerObj","mode","body","JSON","stringify","namespace","requestToken","ok","status","events","emit","get","json","text","error","tokenIntroduced","external","console","warn","getResult","range","skipLimit","Number","getHeaders","message","networkError","tokens","formioToken","set","tokenName","fromUser","fromToken","localStorage","removeItem","erase","setItem","currentUserResolved","decodedTokenName","decode","getItem","userName","parse","setBaseUrl","getBaseUrl","setApiUrl","getApiUrl","setAppUrl","setProjectUrl","setAuthUrl","getAppUrl","getProjectUrl","clearCache","noop","identity","deregisterPlugin","plugin","beforeLength","plugins","filter","__name","deregister","registerPlugin","__Formio","sort","a","b","priority","init","getPlugin","_iterator","_step","pluginFn","_len2","_key2","map","_ref","_len3","_key3","callPlugin","_ref2","_len4","_key4","reduce","projectRoles","_this9","logout","pageQuery","paths","hashes","hash","substr","decodeURIComponent","oAuthCurrentUser","Authorization","samlInit","saml","retVal","uri","substring","history","replaceState","document","title","relay","oktaInit","OktaAuth","errorMessage","Okta","authClient","tokenManager","accessToken","parseFromUrl","add","getWithRedirect","responseType","scopes","ssoInit","requireLibrary","property","src","polling","libraries","ready","callbackName","lib","attrs","elementType","defer","async","referrerpolicy","rel","element","createElement","setAttribute","attr","_document","head","appendChild","interval","setInterval","clearInterval","libraryReady","addToGlobal","global","setPathType","getPathType","Providers","version","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.array.slice.js\");\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nrequire(\"core-js/modules/es.array.from.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es.regexp.exec.js\");\n\nrequire(\"core-js/modules/es.string.match.js\");\n\nrequire(\"core-js/modules/es.string.search.js\");\n\nrequire(\"core-js/modules/es.string.split.js\");\n\nrequire(\"core-js/modules/es.array.concat.js\");\n\nrequire(\"core-js/modules/es.regexp.constructor.js\");\n\nrequire(\"core-js/modules/es.regexp.to-string.js\");\n\nrequire(\"core-js/modules/es.string.replace.js\");\n\nrequire(\"core-js/modules/es.array.join.js\");\n\nrequire(\"core-js/modules/es.array.includes.js\");\n\nrequire(\"core-js/modules/es.string.includes.js\");\n\nrequire(\"core-js/modules/es.object.assign.js\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\n\nrequire(\"core-js/modules/es.number.constructor.js\");\n\nrequire(\"core-js/modules/es.array.filter.js\");\n\nrequire(\"core-js/modules/es.array.sort.js\");\n\nrequire(\"core-js/modules/es.array.map.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.symbol.js\");\n\nrequire(\"core-js/modules/es.symbol.description.js\");\n\nrequire(\"core-js/modules/es.symbol.iterator.js\");\n\nrequire(\"core-js/modules/es.array.iterator.js\");\n\nrequire(\"core-js/modules/es.string.iterator.js\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nvar _fetchPonyfill2 = _interopRequireDefault(require(\"fetch-ponyfill\"));\n\nvar _EventEmitter = _interopRequireDefault(require(\"./EventEmitter\"));\n\nvar _browserCookies = _interopRequireDefault(require(\"browser-cookies\"));\n\nvar _providers = _interopRequireDefault(require(\"./providers\"));\n\nvar _intersection2 = _interopRequireDefault(require(\"lodash/intersection\"));\n\nvar _get2 = _interopRequireDefault(require(\"lodash/get\"));\n\nvar _cloneDeep2 = _interopRequireDefault(require(\"lodash/cloneDeep\"));\n\nvar _defaults2 = _interopRequireDefault(require(\"lodash/defaults\"));\n\nvar _utils = require(\"./utils/utils\");\n\nvar _jwtDecode = _interopRequireDefault(require(\"jwt-decode\"));\n\nrequire(\"./polyfills\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nvar _fetchPonyfill = (0, _fetchPonyfill2.default)({\n  Promise: _nativePromiseOnly.default\n}),\n    fetch = _fetchPonyfill.fetch,\n    Headers = _fetchPonyfill.Headers;\n\nvar isBoolean = function isBoolean(val) {\n  return _typeof(val) === _typeof(true);\n};\n\nvar isNil = function isNil(val) {\n  return val === null || val === undefined;\n};\n\nvar isObject = function isObject(val) {\n  return val && _typeof(val) === 'object';\n};\n\nfunction cloneResponse(response) {\n  var copy = (0, _cloneDeep2.default)(response);\n\n  if (Array.isArray(response)) {\n    copy.skip = response.skip;\n    copy.limit = response.limit;\n    copy.serverCount = response.serverCount;\n  }\n\n  return copy;\n}\n/**\n * The Formio interface class.\n *\n *   let formio = new Formio('https://examples.form.io/example');\n */\n\n\nvar Formio = /*#__PURE__*/function () {\n  /* eslint-disable max-statements */\n  function Formio(path) {\n    var _this = this;\n\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Formio);\n\n    // Ensure we have an instance of Formio.\n    if (!(this instanceof Formio)) {\n      return new Formio(path);\n    } // Initialize our variables.\n\n\n    this.base = '';\n    this.projectsUrl = '';\n    this.projectUrl = '';\n    this.projectId = '';\n    this.roleUrl = '';\n    this.rolesUrl = '';\n    this.roleId = '';\n    this.formUrl = '';\n    this.formsUrl = '';\n    this.formId = '';\n    this.submissionsUrl = '';\n    this.submissionUrl = '';\n    this.submissionId = '';\n    this.actionsUrl = '';\n    this.actionId = '';\n    this.actionUrl = '';\n    this.vsUrl = '';\n    this.vId = '';\n    this.vUrl = '';\n    this.query = ''; // Store the original path and options.\n\n    this.path = path;\n    this.options = options;\n\n    if (options.hasOwnProperty('base')) {\n      this.base = options.base;\n    } else if (Formio.baseUrl) {\n      this.base = Formio.baseUrl;\n    } else if (typeof window !== 'undefined') {\n      this.base = window.location.href.match(/http[s]?:\\/\\/api./)[0];\n    }\n\n    if (!path) {\n      // Allow user to create new projects if this was instantiated without\n      // a url\n      this.projectUrl = Formio.projectUrl || \"\".concat(this.base, \"/project\");\n      this.projectsUrl = \"\".concat(this.base, \"/project\");\n      this.projectId = false;\n      this.query = '';\n      return;\n    }\n\n    if (options.hasOwnProperty('project')) {\n      this.projectUrl = options.project;\n    }\n\n    var project = this.projectUrl || Formio.projectUrl;\n    var projectRegEx = /(^|\\/)(project)($|\\/[^/]+)/;\n    var isProjectUrl = path.search(projectRegEx) !== -1; // The baseURL is the same as the projectUrl, and does not contain \"/project/MONGO_ID\" in\n    // its domain. This is almost certainly against the Open Source server.\n\n    if (project && this.base === project && !isProjectUrl) {\n      this.noProject = true;\n      this.projectUrl = this.base;\n    } // Normalize to an absolute path.\n\n\n    if (path.indexOf('http') !== 0 && path.indexOf('//') !== 0) {\n      path = this.base + path;\n    }\n\n    var hostparts = this.getUrlParts(path);\n    var parts = [];\n    var hostName = hostparts[1] + hostparts[2];\n    path = hostparts.length > 3 ? hostparts[3] : '';\n    var queryparts = path.split('?');\n\n    if (queryparts.length > 1) {\n      path = queryparts[0];\n      this.query = \"?\".concat(queryparts[1]);\n    } // Register a specific path.\n\n\n    var registerPath = function registerPath(name, base) {\n      _this[\"\".concat(name, \"sUrl\")] = \"\".concat(base, \"/\").concat(name);\n      var regex = new RegExp(\"/\".concat(name, \"/([^/]+)\"));\n\n      if (path.search(regex) !== -1) {\n        parts = path.match(regex);\n        _this[\"\".concat(name, \"Url\")] = parts ? base + parts[0] : '';\n        _this[\"\".concat(name, \"Id\")] = parts.length > 1 ? parts[1] : '';\n        base += parts[0];\n      }\n\n      return base;\n    }; // Register an array of items.\n\n\n    var registerItems = function registerItems(items, base, staticBase) {\n      for (var i in items) {\n        if (items.hasOwnProperty(i)) {\n          var item = items[i];\n\n          if (Array.isArray(item)) {\n            registerItems(item, base, true);\n          } else {\n            var newBase = registerPath(item, base);\n            base = staticBase ? base : newBase;\n          }\n        }\n      }\n    };\n\n    if (!this.projectUrl || this.projectUrl === this.base) {\n      // If a project uses Subdirectories path type, we need to specify a projectUrl\n      if (!this.projectUrl && !isProjectUrl && Formio.pathType === 'Subdirectories') {\n        var regex = \"^\".concat(hostName.replace(/\\//g, '\\\\/'), \".[^/]+\");\n        var match = project.match(new RegExp(regex));\n        this.projectUrl = match ? match[0] : hostName;\n      } else {\n        this.projectUrl = hostName;\n      }\n    } // Check if we have a specified path type.\n\n\n    var isNotSubdomainType = false;\n\n    if (Formio.pathType) {\n      isNotSubdomainType = Formio.pathType !== 'Subdomains';\n    }\n\n    if (!this.noProject) {\n      // Determine the projectUrl and projectId\n      if (isProjectUrl) {\n        // Get project id as project/:projectId.\n        registerItems(['project'], hostName);\n        path = path.replace(projectRegEx, '');\n      } else if (hostName === this.base) {\n        // Get project id as first part of path (subdirectory).\n        if (hostparts.length > 3 && path.split('/').length > 1) {\n          var pathParts = path.split('/');\n          pathParts.shift(); // Throw away the first /.\n\n          this.projectId = pathParts.shift();\n          path = \"/\".concat(pathParts.join('/'));\n          this.projectUrl = \"\".concat(hostName, \"/\").concat(this.projectId);\n        }\n      } else {\n        // Get project id from subdomain.\n        if (hostparts.length > 2 && (hostparts[2].split('.').length > 2 || hostName.includes('localhost')) && !isNotSubdomainType) {\n          this.projectUrl = hostName;\n          this.projectId = hostparts[2].split('.')[0];\n        }\n      }\n\n      this.projectsUrl = this.projectsUrl || \"\".concat(this.base, \"/project\");\n    } // Configure Role urls and role ids.\n\n\n    registerItems(['role'], this.projectUrl); // Configure Form urls and form ids.\n\n    if (/(^|\\/)(form)($|\\/)/.test(path)) {\n      registerItems(['form', ['submission', 'action', 'v']], this.projectUrl);\n    } else {\n      var subRegEx = new RegExp('/(submission|action|v)($|/.*)');\n      var subs = path.match(subRegEx);\n      this.pathType = subs && subs.length > 1 ? subs[1] : '';\n      path = path.replace(subRegEx, '');\n      path = path.replace(/\\/$/, '');\n      this.formsUrl = \"\".concat(this.projectUrl, \"/form\");\n      this.formUrl = path ? this.projectUrl + path : '';\n      this.formId = path.replace(/^\\/+|\\/+$/g, '');\n      var items = ['submission', 'action', 'v'];\n\n      for (var i in items) {\n        if (items.hasOwnProperty(i)) {\n          var item = items[i];\n          this[\"\".concat(item, \"sUrl\")] = \"\".concat(this.projectUrl + path, \"/\").concat(item);\n\n          if (this.pathType === item && subs.length > 2 && subs[2]) {\n            this[\"\".concat(item, \"Id\")] = subs[2].replace(/^\\/+|\\/+$/g, '');\n            this[\"\".concat(item, \"Url\")] = this.projectUrl + path + subs[0];\n          }\n        }\n      }\n    } // Set the app url if it is not set.\n\n\n    if (!Formio.projectUrlSet) {\n      Formio.projectUrl = this.projectUrl;\n    }\n  }\n  /* eslint-enable max-statements */\n\n\n  _createClass(Formio, [{\n    key: \"delete\",\n    value: function _delete(type, opts) {\n      var _id = \"\".concat(type, \"Id\");\n\n      var _url = \"\".concat(type, \"Url\");\n\n      if (!this[_id]) {\n        return _nativePromiseOnly.default.reject('Nothing to delete');\n      }\n\n      Formio.cache = {};\n      return this.makeRequest(type, this[_url], 'delete', null, opts);\n    }\n  }, {\n    key: \"index\",\n    value: function index(type, query, opts) {\n      var _url = \"\".concat(type, \"Url\");\n\n      query = query || '';\n\n      if (query && isObject(query)) {\n        query = \"?\".concat(Formio.serialize(query.params));\n      }\n\n      return this.makeRequest(type, this[_url] + query, 'get', null, opts);\n    }\n  }, {\n    key: \"save\",\n    value: function save(type, data, opts) {\n      var _id = \"\".concat(type, \"Id\");\n\n      var _url = \"\".concat(type, \"Url\");\n\n      var method = this[_id] || data._id ? 'put' : 'post';\n      var reqUrl = this[_id] ? this[_url] : this[\"\".concat(type, \"sUrl\")];\n\n      if (!this[_id] && data._id && method === 'put' && !reqUrl.includes(data._id)) {\n        reqUrl += \"/\".concat(data._id);\n      }\n\n      Formio.cache = {};\n      return this.makeRequest(type, reqUrl + this.query, method, data, opts);\n    }\n  }, {\n    key: \"load\",\n    value: function load(type, query, opts) {\n      var _id = \"\".concat(type, \"Id\");\n\n      var _url = \"\".concat(type, \"Url\");\n\n      if (query && isObject(query)) {\n        query = Formio.serialize(query.params);\n      }\n\n      if (query) {\n        query = this.query ? \"\".concat(this.query, \"&\").concat(query) : \"?\".concat(query);\n      } else {\n        query = this.query;\n      }\n\n      if (!this[_id]) {\n        return _nativePromiseOnly.default.reject(\"Missing \".concat(_id));\n      }\n\n      return this.makeRequest(type, this[_url] + query, 'get', null, opts);\n    }\n  }, {\n    key: \"makeRequest\",\n    value: function makeRequest() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      return Formio.makeRequest.apply(Formio, [this].concat(args));\n    }\n  }, {\n    key: \"loadProject\",\n    value: function loadProject(query, opts) {\n      return this.load('project', query, opts);\n    }\n  }, {\n    key: \"saveProject\",\n    value: function saveProject(data, opts) {\n      return this.save('project', data, opts);\n    }\n  }, {\n    key: \"deleteProject\",\n    value: function deleteProject(opts) {\n      return this.delete('project', opts);\n    }\n  }, {\n    key: \"loadRole\",\n    value: function loadRole(opts) {\n      return this.load('role', null, opts);\n    }\n  }, {\n    key: \"saveRole\",\n    value: function saveRole(data, opts) {\n      return this.save('role', data, opts);\n    }\n  }, {\n    key: \"deleteRole\",\n    value: function deleteRole(opts) {\n      return this.delete('role', opts);\n    }\n  }, {\n    key: \"loadRoles\",\n    value: function loadRoles(opts) {\n      return this.index('roles', null, opts);\n    }\n  }, {\n    key: \"loadForm\",\n    value: function loadForm(query, opts) {\n      var _this2 = this;\n\n      return this.load('form', query, opts).then(function (currentForm) {\n        // Check to see if there isn't a number in vId.\n        if (!currentForm.revisions || isNaN(parseInt(_this2.vId))) {\n          return currentForm;\n        } // If a submission already exists but form is marked to load current version of form.\n\n\n        if (currentForm.revisions === 'current' && _this2.submissionId) {\n          return currentForm;\n        } // If they specified a revision form, load the revised form components.\n\n\n        if (query && isObject(query)) {\n          query = Formio.serialize(query.params);\n        }\n\n        if (query) {\n          query = _this2.query ? \"\".concat(_this2.query, \"&\").concat(query) : \"?\".concat(query);\n        } else {\n          query = _this2.query;\n        }\n\n        return _this2.makeRequest('form', _this2.vUrl + query, 'get', null, opts).then(function (revisionForm) {\n          currentForm._vid = revisionForm._vid;\n          currentForm.components = revisionForm.components;\n          currentForm.settings = revisionForm.settings; // Using object.assign so we don't cross polinate multiple form loads.\n\n          return Object.assign({}, currentForm);\n        }) // If we couldn't load the revision, just return the original form.\n        .catch(function () {\n          return Object.assign({}, currentForm);\n        });\n      });\n    }\n  }, {\n    key: \"saveForm\",\n    value: function saveForm(data, opts) {\n      return this.save('form', data, opts);\n    }\n  }, {\n    key: \"deleteForm\",\n    value: function deleteForm(opts) {\n      return this.delete('form', opts);\n    }\n  }, {\n    key: \"loadForms\",\n    value: function loadForms(query, opts) {\n      return this.index('forms', query, opts);\n    }\n  }, {\n    key: \"loadSubmission\",\n    value: function loadSubmission(query, opts) {\n      var _this3 = this;\n\n      return this.load('submission', query, opts).then(function (submission) {\n        _this3.vId = submission._fvid;\n        _this3.vUrl = \"\".concat(_this3.formUrl, \"/v/\").concat(_this3.vId);\n        return submission;\n      });\n    }\n  }, {\n    key: \"saveSubmission\",\n    value: function saveSubmission(data, opts) {\n      if (!isNaN(parseInt(this.vId))) {\n        data._fvid = this.vId;\n      }\n\n      return this.save('submission', data, opts);\n    }\n  }, {\n    key: \"deleteSubmission\",\n    value: function deleteSubmission(opts) {\n      return this.delete('submission', opts);\n    }\n  }, {\n    key: \"loadSubmissions\",\n    value: function loadSubmissions(query, opts) {\n      return this.index('submissions', query, opts);\n    }\n  }, {\n    key: \"loadAction\",\n    value: function loadAction(query, opts) {\n      return this.load('action', query, opts);\n    }\n  }, {\n    key: \"saveAction\",\n    value: function saveAction(data, opts) {\n      return this.save('action', data, opts);\n    }\n  }, {\n    key: \"deleteAction\",\n    value: function deleteAction(opts) {\n      return this.delete('action', opts);\n    }\n  }, {\n    key: \"loadActions\",\n    value: function loadActions(query, opts) {\n      return this.index('actions', query, opts);\n    }\n  }, {\n    key: \"availableActions\",\n    value: function availableActions() {\n      return this.makeRequest('availableActions', \"\".concat(this.formUrl, \"/actions\"));\n    }\n  }, {\n    key: \"actionInfo\",\n    value: function actionInfo(name) {\n      return this.makeRequest('actionInfo', \"\".concat(this.formUrl, \"/actions/\").concat(name));\n    }\n  }, {\n    key: \"isObjectId\",\n    value: function isObjectId(id) {\n      var checkForHexRegExp = new RegExp('^[0-9a-fA-F]{24}$');\n      return checkForHexRegExp.test(id);\n    }\n  }, {\n    key: \"getProjectId\",\n    value: function getProjectId() {\n      if (!this.projectId) {\n        return _nativePromiseOnly.default.resolve('');\n      }\n\n      if (this.isObjectId(this.projectId)) {\n        return _nativePromiseOnly.default.resolve(this.projectId);\n      } else {\n        return this.loadProject().then(function (project) {\n          return project._id;\n        });\n      }\n    }\n  }, {\n    key: \"getFormId\",\n    value: function getFormId() {\n      if (!this.formId) {\n        return _nativePromiseOnly.default.resolve('');\n      }\n\n      if (this.isObjectId(this.formId)) {\n        return _nativePromiseOnly.default.resolve(this.formId);\n      } else {\n        return this.loadForm().then(function (form) {\n          return form._id;\n        });\n      }\n    }\n  }, {\n    key: \"currentUser\",\n    value: function currentUser(options) {\n      return Formio.currentUser(this, options);\n    }\n  }, {\n    key: \"accessInfo\",\n    value: function accessInfo() {\n      return Formio.accessInfo(this);\n    }\n    /**\n     * Returns the JWT token for this instance.\n     *\n     * @return {*}\n     */\n\n  }, {\n    key: \"getToken\",\n    value: function getToken(options) {\n      return Formio.getToken(Object.assign({\n        formio: this\n      }, this.options, options));\n    }\n    /**\n     * Sets the JWT token for this instance.\n     *\n     * @return {*}\n     */\n\n  }, {\n    key: \"setToken\",\n    value: function setToken(token, options) {\n      return Formio.setToken(token, Object.assign({\n        formio: this\n      }, this.options, options));\n    }\n    /**\n     * Returns a temporary authentication token for single purpose token generation.\n     */\n\n  }, {\n    key: \"getTempToken\",\n    value: function getTempToken(expire, allowed, options) {\n      var token = Formio.getToken(options);\n\n      if (!token) {\n        return _nativePromiseOnly.default.reject('You must be authenticated to generate a temporary auth token.');\n      }\n\n      var authUrl = Formio.authUrl || this.projectUrl;\n      return this.makeRequest('tempToken', \"\".concat(authUrl, \"/token\"), 'GET', null, {\n        ignoreCache: true,\n        header: new Headers({\n          'x-expire': expire,\n          'x-allow': allowed\n        })\n      });\n    }\n    /**\n     * Get a download url for a submission PDF of this submission.\n     *\n     * @return {*}\n     */\n\n  }, {\n    key: \"getDownloadUrl\",\n    value: function getDownloadUrl(form) {\n      var _this4 = this;\n\n      if (!this.submissionId) {\n        return _nativePromiseOnly.default.resolve('');\n      }\n\n      if (!form) {\n        // Make sure to load the form first.\n        return this.loadForm().then(function (_form) {\n          if (!_form) {\n            return '';\n          }\n\n          return _this4.getDownloadUrl(_form);\n        });\n      }\n\n      var apiUrl = \"/project/\".concat(form.project);\n      apiUrl += \"/form/\".concat(form._id);\n      apiUrl += \"/submission/\".concat(this.submissionId);\n      apiUrl += '/download';\n      var download = this.base + apiUrl;\n      return new _nativePromiseOnly.default(function (resolve, reject) {\n        _this4.getTempToken(3600, \"GET:\".concat(apiUrl)).then(function (tempToken) {\n          download += \"?token=\".concat(tempToken.key);\n          resolve(download);\n        }, function () {\n          resolve(download);\n        }).catch(reject);\n      });\n    }\n  }, {\n    key: \"uploadFile\",\n    value: function uploadFile(storage, file, fileName, dir, progressCallback, url, options, fileKey, groupPermissions, groupId, uploadStartCallback, abortCallback) {\n      var _this5 = this;\n\n      var requestArgs = {\n        provider: storage,\n        method: 'upload',\n        file: file,\n        fileName: fileName,\n        dir: dir\n      };\n      fileKey = fileKey || 'file';\n      var request = Formio.pluginWait('preRequest', requestArgs).then(function () {\n        return Formio.pluginGet('fileRequest', requestArgs).then(function (result) {\n          if (storage && isNil(result)) {\n            var Provider = _providers.default.getProvider('storage', storage);\n\n            if (Provider) {\n              var provider = new Provider(_this5);\n\n              if (uploadStartCallback) {\n                uploadStartCallback();\n              }\n\n              return provider.uploadFile(file, fileName, dir, progressCallback, url, options, fileKey, groupPermissions, groupId, abortCallback);\n            } else {\n              throw 'Storage provider not found';\n            }\n          }\n\n          return result || {\n            url: ''\n          };\n        });\n      });\n      return Formio.pluginAlter('wrapFileRequestPromise', request, requestArgs);\n    }\n  }, {\n    key: \"downloadFile\",\n    value: function downloadFile(file, options) {\n      var _this6 = this;\n\n      var requestArgs = {\n        method: 'download',\n        file: file\n      };\n      var request = Formio.pluginWait('preRequest', requestArgs).then(function () {\n        return Formio.pluginGet('fileRequest', requestArgs).then(function (result) {\n          if (file.storage && isNil(result)) {\n            var Provider = _providers.default.getProvider('storage', file.storage);\n\n            if (Provider) {\n              var provider = new Provider(_this6);\n              return provider.downloadFile(file, options);\n            } else {\n              throw 'Storage provider not found';\n            }\n          }\n\n          return result || {\n            url: ''\n          };\n        });\n      });\n      return Formio.pluginAlter('wrapFileRequestPromise', request, requestArgs);\n    }\n  }, {\n    key: \"deleteFile\",\n    value: function deleteFile(file, options) {\n      var _this7 = this;\n\n      var requestArgs = {\n        method: 'delete',\n        file: file\n      };\n      var request = Formio.pluginWait('preRequest', requestArgs).then(function () {\n        return Formio.pluginGet('fileRequest', requestArgs).then(function (result) {\n          if (file.storage && isNil(result)) {\n            var Provider = _providers.default.getProvider('storage', file.storage);\n\n            if (Provider) {\n              var provider = new Provider(_this7);\n              return provider.deleteFile(file, options);\n            } else {\n              throw 'Storage provider not found';\n            }\n          }\n\n          return result || {\n            url: ''\n          };\n        });\n      });\n      return Formio.pluginAlter('wrapFileRequestPromise', request, requestArgs);\n    }\n    /**\n     * Returns the user permissions to a form and submission.\n     *\n     * @param user - The user or current user if undefined. For anonymous, use \"null\"\n     * @param form - The form or current form if undefined. For no form check, use \"null\"\n     * @param submission - The submisison or \"index\" if undefined.\n     *\n     * @return {create: boolean, read: boolean, edit: boolean, delete: boolean}\n     */\n\n  }, {\n    key: \"userPermissions\",\n    value: function userPermissions(user, form, submission) {\n      return _nativePromiseOnly.default.all([form !== undefined ? _nativePromiseOnly.default.resolve(form) : this.loadForm(), user !== undefined ? _nativePromiseOnly.default.resolve(user) : this.currentUser(), submission !== undefined || !this.submissionId ? _nativePromiseOnly.default.resolve(submission) : this.loadSubmission(), this.accessInfo()]).then(function (results) {\n        var form = results.shift();\n        var user = results.shift() || {\n          _id: false,\n          roles: []\n        };\n        var submission = results.shift();\n        var access = results.shift();\n        var permMap = {\n          create: 'create',\n          read: 'read',\n          update: 'edit',\n          delete: 'delete'\n        };\n        var perms = {\n          user: user,\n          form: form,\n          access: access,\n          create: false,\n          read: false,\n          edit: false,\n          delete: false\n        };\n\n        for (var roleName in access.roles) {\n          if (access.roles.hasOwnProperty(roleName)) {\n            var role = access.roles[roleName];\n\n            if (role.default && user._id === false) {\n              // User is anonymous. Add the anonymous role.\n              user.roles.push(role._id);\n            } else if (role.admin && user.roles.indexOf(role._id) !== -1) {\n              perms.create = true;\n              perms.read = true;\n              perms.delete = true;\n              perms.edit = true;\n              return perms;\n            }\n          }\n        }\n\n        if (form && form.submissionAccess) {\n          for (var i = 0; i < form.submissionAccess.length; i++) {\n            var permission = form.submissionAccess[i];\n\n            var _permission$type$spli = permission.type.split('_'),\n                _permission$type$spli2 = _slicedToArray(_permission$type$spli, 2),\n                perm = _permission$type$spli2[0],\n                scope = _permission$type$spli2[1];\n\n            if (['create', 'read', 'update', 'delete'].includes(perm)) {\n              if ((0, _intersection2.default)(permission.roles, user.roles).length) {\n                perms[permMap[perm]] = scope === 'all' || !submission || user._id === submission.owner;\n              }\n            }\n          }\n        } // check for Group Permissions\n\n\n        if (submission) {\n          // we would anyway need to loop through components for create permission, so we'll do that for all of them\n          (0, _utils.eachComponent)(form.components, function (component, path) {\n            if (component && component.defaultPermission) {\n              var value = (0, _get2.default)(submission.data, path); // make it work for single-select Group and multi-select Group\n\n              var groups = Array.isArray(value) ? value : [value];\n              groups.forEach(function (group) {\n                if (group && group._id && // group id is present\n                user.roles.indexOf(group._id) > -1 // user has group id in his roles\n                ) {\n                    if (component.defaultPermission === 'read') {\n                      perms[permMap.read] = true;\n                    }\n\n                    if (component.defaultPermission === 'create') {\n                      perms[permMap.create] = true;\n                      perms[permMap.read] = true;\n                    }\n\n                    if (component.defaultPermission === 'write') {\n                      perms[permMap.create] = true;\n                      perms[permMap.read] = true;\n                      perms[permMap.update] = true;\n                    }\n\n                    if (component.defaultPermission === 'admin') {\n                      perms[permMap.create] = true;\n                      perms[permMap.read] = true;\n                      perms[permMap.update] = true;\n                      perms[permMap.delete] = true;\n                    }\n                  }\n              });\n            }\n          });\n        }\n\n        return perms;\n      });\n    }\n    /**\n     * Determine if the current user can submit a form.\n     * @return {*}\n     */\n\n  }, {\n    key: \"canSubmit\",\n    value: function canSubmit() {\n      var _this8 = this;\n\n      return this.userPermissions().then(function (perms) {\n        // If there is user and they cannot create, then check anonymous user permissions.\n        if (!perms.create && Formio.getUser()) {\n          return _this8.userPermissions(null).then(function (anonPerms) {\n            if (anonPerms.create) {\n              Formio.setUser(null);\n              return true;\n            }\n\n            return false;\n          });\n        }\n\n        return perms.create;\n      });\n    }\n  }, {\n    key: \"getUrlParts\",\n    value: function getUrlParts(url) {\n      return Formio.getUrlParts(url, this);\n    }\n  }], [{\n    key: \"loadProjects\",\n    value: function loadProjects(query, opts) {\n      query = query || '';\n\n      if (isObject(query)) {\n        query = \"?\".concat(Formio.serialize(query.params));\n      }\n\n      return Formio.makeStaticRequest(\"\".concat(Formio.baseUrl, \"/project\").concat(query), 'GET', null, opts);\n    }\n  }, {\n    key: \"getUrlParts\",\n    value: function getUrlParts(url, formio) {\n      var base = formio && formio.base ? formio.base : Formio.baseUrl;\n      var regex = '^(http[s]?:\\\\/\\\\/)';\n\n      if (base && url.indexOf(base) === 0) {\n        regex += \"(\".concat(base.replace(/^http[s]?:\\/\\//, ''), \")\");\n      } else {\n        regex += '([^/]+)';\n      }\n\n      regex += '($|\\\\/.*)';\n      return url.match(new RegExp(regex));\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize(obj, _interpolate) {\n      var str = [];\n\n      var interpolate = function interpolate(item) {\n        return _interpolate ? _interpolate(item) : item;\n      };\n\n      for (var p in obj) {\n        if (obj.hasOwnProperty(p)) {\n          str.push(\"\".concat(encodeURIComponent(p), \"=\").concat(encodeURIComponent(interpolate(obj[p]))));\n        }\n      }\n\n      return str.join('&');\n    }\n  }, {\n    key: \"getRequestArgs\",\n    value: function getRequestArgs(formio, type, url, method, data, opts) {\n      method = (method || 'GET').toUpperCase();\n\n      if (!opts || !isObject(opts)) {\n        opts = {};\n      }\n\n      var requestArgs = {\n        url: url,\n        method: method,\n        data: data || null,\n        opts: opts\n      };\n\n      if (type) {\n        requestArgs.type = type;\n      }\n\n      if (formio) {\n        requestArgs.formio = formio;\n      }\n\n      return requestArgs;\n    }\n  }, {\n    key: \"makeStaticRequest\",\n    value: function makeStaticRequest(url, method, data, opts) {\n      var requestArgs = Formio.getRequestArgs(null, '', url, method, data, opts);\n      var request = Formio.pluginWait('preRequest', requestArgs).then(function () {\n        return Formio.pluginGet('staticRequest', requestArgs).then(function (result) {\n          if (isNil(result)) {\n            return Formio.request(requestArgs.url, requestArgs.method, requestArgs.data, requestArgs.opts.header, requestArgs.opts);\n          }\n\n          return result;\n        });\n      });\n      return Formio.pluginAlter('wrapStaticRequestPromise', request, requestArgs);\n    }\n  }, {\n    key: \"makeRequest\",\n    value: function makeRequest(formio, type, url, method, data, opts) {\n      if (!formio) {\n        return Formio.makeStaticRequest(url, method, data, opts);\n      }\n\n      var requestArgs = Formio.getRequestArgs(formio, type, url, method, data, opts);\n      requestArgs.opts = requestArgs.opts || {};\n      requestArgs.opts.formio = formio; //for Formio requests default Accept and Content-type headers\n\n      if (!requestArgs.opts.headers) {\n        requestArgs.opts.headers = {};\n      }\n\n      requestArgs.opts.headers = (0, _defaults2.default)(requestArgs.opts.headers, {\n        'Accept': 'application/json',\n        'Content-type': 'application/json'\n      });\n      var request = Formio.pluginWait('preRequest', requestArgs).then(function () {\n        return Formio.pluginGet('request', requestArgs).then(function (result) {\n          if (isNil(result)) {\n            return Formio.request(requestArgs.url, requestArgs.method, requestArgs.data, requestArgs.opts.header, requestArgs.opts);\n          }\n\n          return result;\n        });\n      });\n      return Formio.pluginAlter('wrapRequestPromise', request, requestArgs);\n    }\n  }, {\n    key: \"request\",\n    value: function request(url, method, data, header, opts) {\n      if (!url) {\n        return _nativePromiseOnly.default.reject('No url provided');\n      }\n\n      var _Formio = Formio;\n      method = (method || 'GET').toUpperCase(); // For reverse compatibility, if they provided the ignoreCache parameter,\n      // then change it back to the options format where that is a parameter.\n\n      if (isBoolean(opts)) {\n        opts = {\n          ignoreCache: opts\n        };\n      }\n\n      if (!opts || !isObject(opts)) {\n        opts = {};\n      } // Generate a cachekey.\n\n\n      var cacheKey = btoa(encodeURI(url)); // Get the cached promise to save multiple loads.\n\n      if (!opts.ignoreCache && method === 'GET' && _Formio.cache.hasOwnProperty(cacheKey)) {\n        return _nativePromiseOnly.default.resolve(cloneResponse(_Formio.cache[cacheKey]));\n      } // Set up and fetch request\n\n\n      var headers = header || new Headers(opts.headers || {\n        'Accept': 'application/json',\n        'Content-type': 'application/json'\n      });\n\n      var token = _Formio.getToken(opts);\n\n      if (token && !opts.noToken) {\n        headers.append('x-jwt-token', token);\n      } // The fetch-ponyfill can't handle a proper Headers class anymore. Change it back to an object.\n\n\n      var headerObj = {};\n      headers.forEach(function (value, name) {\n        headerObj[name] = value;\n      });\n      var options = {\n        method: method,\n        headers: headerObj,\n        mode: 'cors'\n      };\n\n      if (data) {\n        options.body = JSON.stringify(data);\n      } // Allow plugins to alter the options.\n\n\n      options = _Formio.pluginAlter('requestOptions', options, url);\n\n      if (options.namespace || _Formio.namespace) {\n        opts.namespace = options.namespace || _Formio.namespace;\n      }\n\n      var requestToken = options.headers['x-jwt-token'];\n\n      var result = _Formio.pluginAlter('wrapFetchRequestPromise', _Formio.fetch(url, options), {\n        url: url,\n        method: method,\n        data: data,\n        opts: opts\n      }).then(function (response) {\n        // Allow plugins to respond.\n        response = _Formio.pluginAlter('requestResponse', response, _Formio, data);\n\n        if (!response.ok) {\n          if (response.status === 440) {\n            _Formio.setToken(null, opts);\n\n            _Formio.events.emit('formio.sessionExpired', response.body);\n          } else if (response.status === 401) {\n            _Formio.events.emit('formio.unauthorized', response.body);\n          } else if (response.status === 416) {\n            _Formio.events.emit('formio.rangeIsNotSatisfiable', response.body);\n          } // Parse and return the error as a rejected promise to reject this promise\n\n\n          return (response.headers.get('content-type').includes('application/json') ? response.json() : response.text()).then(function (error) {\n            return _nativePromiseOnly.default.reject(error);\n          });\n        } // Handle fetch results\n\n\n        var token = response.headers.get('x-jwt-token'); // In some strange cases, the fetch library will return an x-jwt-token without sending\n        // one to the server. This has even been debugged on the server to verify that no token\n        // was introduced with the request, but the response contains a token. This is an Invalid\n        // case where we do not send an x-jwt-token and get one in return for any GET request.\n\n        var tokenIntroduced = false;\n\n        if (method === 'GET' && !requestToken && token && !opts.external && !url.includes('token=') && !url.includes('x-jwt-token=')) {\n          console.warn('Token was introduced in request.');\n          tokenIntroduced = true;\n        }\n\n        if (response.status >= 200 && response.status < 300 && token && token !== '' && !tokenIntroduced) {\n          _Formio.setToken(token, opts);\n        } // 204 is no content. Don't try to .json() it.\n\n\n        if (response.status === 204) {\n          return {};\n        }\n\n        var getResult = response.headers.get('content-type').includes('application/json') ? response.json() : response.text();\n        return getResult.then(function (result) {\n          // Add some content-range metadata to the result here\n          var range = response.headers.get('content-range');\n\n          if (range && isObject(result)) {\n            range = range.split('/');\n\n            if (range[0] !== '*') {\n              var skipLimit = range[0].split('-');\n              result.skip = Number(skipLimit[0]);\n              result.limit = skipLimit[1] - skipLimit[0] + 1;\n            }\n\n            result.serverCount = range[1] === '*' ? range[1] : Number(range[1]);\n          }\n\n          if (!opts.getHeaders) {\n            return result;\n          }\n\n          var headers = {};\n          response.headers.forEach(function (item, key) {\n            headers[key] = item;\n          }); // Return the result with the headers.\n\n          return {\n            result: result,\n            headers: headers\n          };\n        });\n      }).then(function (result) {\n        if (opts.getHeaders) {\n          return result;\n        } // Cache the response.\n\n\n        if (method === 'GET') {\n          _Formio.cache[cacheKey] = result;\n        }\n\n        return cloneResponse(result);\n      }).catch(function (err) {\n        if (err === 'Bad Token') {\n          _Formio.setToken(null, opts);\n\n          _Formio.events.emit('formio.badToken', err);\n        }\n\n        if (err.message) {\n          err.message = \"Could not connect to API server (\".concat(err.message, \")\");\n          err.networkError = true;\n        }\n\n        if (method === 'GET') {\n          delete _Formio.cache[cacheKey];\n        }\n\n        return _nativePromiseOnly.default.reject(err);\n      });\n\n      return result;\n    } // Needed to maintain reverse compatability...\n\n  }, {\n    key: \"token\",\n    get: function get() {\n      if (!Formio.tokens) {\n        Formio.tokens = {};\n      }\n\n      return Formio.tokens.formioToken || '';\n    } // Needed to maintain reverse compatability...\n    ,\n    set: function set(token) {\n      if (!Formio.tokens) {\n        Formio.tokens = {};\n      }\n\n      Formio.tokens.formioToken = token || '';\n    }\n  }, {\n    key: \"setToken\",\n    value: function setToken() {\n      var token = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      var opts = arguments.length > 1 ? arguments[1] : undefined;\n      token = token || '';\n      opts = typeof opts === 'string' ? {\n        namespace: opts\n      } : opts || {};\n      var tokenName = \"\".concat(opts.namespace || Formio.namespace || 'formio', \"Token\");\n\n      if (!Formio.tokens) {\n        Formio.tokens = {};\n      }\n\n      if (!token) {\n        if (!opts.fromUser) {\n          opts.fromToken = true;\n          Formio.setUser(null, opts);\n        } // iOS in private browse mode will throw an error but we can't detect ahead of time that we are in private mode.\n\n\n        try {\n          localStorage.removeItem(tokenName);\n        } catch (err) {\n          _browserCookies.default.erase(tokenName, {\n            path: '/'\n          });\n        }\n\n        Formio.tokens[tokenName] = token;\n        return _nativePromiseOnly.default.resolve(null);\n      }\n\n      if (Formio.tokens[tokenName] !== token) {\n        Formio.tokens[tokenName] = token; // iOS in private browse mode will throw an error but we can't detect ahead of time that we are in private mode.\n\n        try {\n          localStorage.setItem(tokenName, token);\n        } catch (err) {\n          _browserCookies.default.set(tokenName, token, {\n            path: '/'\n          });\n        }\n      } // Return or updates the current user\n\n\n      return this.currentUserResolved ? Formio.currentUser(opts.formio, opts) : _nativePromiseOnly.default.resolve(null);\n    }\n  }, {\n    key: \"getToken\",\n    value: function getToken(options) {\n      options = typeof options === 'string' ? {\n        namespace: options\n      } : options || {};\n      var tokenName = \"\".concat(options.namespace || Formio.namespace || 'formio', \"Token\");\n      var decodedTokenName = options.decode ? \"\".concat(tokenName, \"Decoded\") : tokenName;\n\n      if (!Formio.tokens) {\n        Formio.tokens = {};\n      }\n\n      if (Formio.tokens[decodedTokenName]) {\n        return Formio.tokens[decodedTokenName];\n      }\n\n      try {\n        Formio.tokens[tokenName] = localStorage.getItem(tokenName) || '';\n\n        if (options.decode) {\n          Formio.tokens[decodedTokenName] = Formio.tokens[tokenName] ? (0, _jwtDecode.default)(Formio.tokens[tokenName]) : {};\n          return Formio.tokens[decodedTokenName];\n        }\n\n        return Formio.tokens[tokenName];\n      } catch (e) {\n        Formio.tokens[tokenName] = _browserCookies.default.get(tokenName);\n        return Formio.tokens[tokenName];\n      }\n    }\n  }, {\n    key: \"setUser\",\n    value: function setUser(user) {\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var userName = \"\".concat(opts.namespace || Formio.namespace || 'formio', \"User\");\n\n      if (!user) {\n        if (!opts.fromToken) {\n          opts.fromUser = true;\n          Formio.setToken(null, opts);\n        } // Emit an event on the cleared user.\n\n\n        Formio.events.emit('formio.user', null); // iOS in private browse mode will throw an error but we can't detect ahead of time that we are in private mode.\n\n        try {\n          return localStorage.removeItem(userName);\n        } catch (err) {\n          return _browserCookies.default.erase(userName, {\n            path: '/'\n          });\n        }\n      } // iOS in private browse mode will throw an error but we can't detect ahead of time that we are in private mode.\n\n\n      try {\n        localStorage.setItem(userName, JSON.stringify(user));\n      } catch (err) {\n        _browserCookies.default.set(userName, JSON.stringify(user), {\n          path: '/'\n        });\n      } // Emit an event on the authenticated user.\n\n\n      Formio.events.emit('formio.user', user);\n    }\n  }, {\n    key: \"getUser\",\n    value: function getUser(options) {\n      options = options || {};\n      var userName = \"\".concat(options.namespace || Formio.namespace || 'formio', \"User\");\n\n      try {\n        return JSON.parse(localStorage.getItem(userName) || null);\n      } catch (e) {\n        return JSON.parse(_browserCookies.default.get(userName));\n      }\n    }\n  }, {\n    key: \"setBaseUrl\",\n    value: function setBaseUrl(url) {\n      Formio.baseUrl = url;\n\n      if (!Formio.projectUrlSet) {\n        Formio.projectUrl = url;\n      }\n    }\n  }, {\n    key: \"getBaseUrl\",\n    value: function getBaseUrl() {\n      return Formio.baseUrl;\n    }\n  }, {\n    key: \"setApiUrl\",\n    value: function setApiUrl(url) {\n      return Formio.setBaseUrl(url);\n    }\n  }, {\n    key: \"getApiUrl\",\n    value: function getApiUrl() {\n      return Formio.getBaseUrl();\n    }\n  }, {\n    key: \"setAppUrl\",\n    value: function setAppUrl(url) {\n      console.warn('Formio.setAppUrl() is deprecated. Use Formio.setProjectUrl instead.');\n      Formio.projectUrl = url;\n      Formio.projectUrlSet = true;\n    }\n  }, {\n    key: \"setProjectUrl\",\n    value: function setProjectUrl(url) {\n      Formio.projectUrl = url;\n      Formio.projectUrlSet = true;\n    }\n  }, {\n    key: \"setAuthUrl\",\n    value: function setAuthUrl(url) {\n      Formio.authUrl = url;\n    }\n  }, {\n    key: \"getAppUrl\",\n    value: function getAppUrl() {\n      console.warn('Formio.getAppUrl() is deprecated. Use Formio.getProjectUrl instead.');\n      return Formio.projectUrl;\n    }\n  }, {\n    key: \"getProjectUrl\",\n    value: function getProjectUrl() {\n      return Formio.projectUrl;\n    }\n  }, {\n    key: \"clearCache\",\n    value: function clearCache() {\n      Formio.cache = {};\n    }\n  }, {\n    key: \"noop\",\n    value: function noop() {}\n  }, {\n    key: \"identity\",\n    value: function identity(value) {\n      return value;\n    }\n  }, {\n    key: \"deregisterPlugin\",\n    value: function deregisterPlugin(plugin) {\n      var beforeLength = Formio.plugins.length;\n      Formio.plugins = Formio.plugins.filter(function (p) {\n        if (p !== plugin && p.__name !== plugin) {\n          return true;\n        }\n\n        (p.deregister || Formio.noop).call(plugin, Formio);\n        return false;\n      });\n      return beforeLength !== Formio.plugins.length;\n    }\n  }, {\n    key: \"registerPlugin\",\n    value: function registerPlugin(plugin, name) {\n      var __Formio = Formio;\n\n      __Formio.plugins.push(plugin);\n\n      __Formio.plugins.sort(function (a, b) {\n        return (b.priority || 0) - (a.priority || 0);\n      });\n\n      plugin.__name = name;\n\n      (plugin.init || __Formio.noop).call(plugin, __Formio);\n    }\n  }, {\n    key: \"getPlugin\",\n    value: function getPlugin(name) {\n      var _iterator = _createForOfIteratorHelper(Formio.plugins),\n          _step;\n\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var plugin = _step.value;\n\n          if (plugin.__name === name) {\n            return plugin;\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n\n      return null;\n    }\n  }, {\n    key: \"pluginWait\",\n    value: function pluginWait(pluginFn) {\n      for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n        args[_key2 - 1] = arguments[_key2];\n      }\n\n      return _nativePromiseOnly.default.all(Formio.plugins.map(function (plugin) {\n        var _ref;\n\n        return (_ref = plugin[pluginFn] || Formio.noop).call.apply(_ref, [plugin].concat(args));\n      }));\n    }\n  }, {\n    key: \"pluginGet\",\n    value: function pluginGet(pluginFn) {\n      for (var _len3 = arguments.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n        args[_key3 - 1] = arguments[_key3];\n      }\n\n      var callPlugin = function callPlugin(index) {\n        var _ref2;\n\n        var plugin = Formio.plugins[index];\n\n        if (!plugin) {\n          return _nativePromiseOnly.default.resolve(null);\n        }\n\n        return _nativePromiseOnly.default.resolve((_ref2 = plugin[pluginFn] || Formio.noop).call.apply(_ref2, [plugin].concat(args))).then(function (result) {\n          if (!isNil(result)) {\n            return result;\n          }\n\n          return callPlugin(index + 1);\n        });\n      };\n\n      return callPlugin(0);\n    }\n  }, {\n    key: \"pluginAlter\",\n    value: function pluginAlter(pluginFn, value) {\n      for (var _len4 = arguments.length, args = new Array(_len4 > 2 ? _len4 - 2 : 0), _key4 = 2; _key4 < _len4; _key4++) {\n        args[_key4 - 2] = arguments[_key4];\n      }\n\n      return Formio.plugins.reduce(function (value, plugin) {\n        return (plugin[pluginFn] || Formio.identity).apply(void 0, [value].concat(args));\n      }, value);\n    }\n  }, {\n    key: \"accessInfo\",\n    value: function accessInfo(formio) {\n      var projectUrl = formio ? formio.projectUrl : Formio.projectUrl;\n      return Formio.makeRequest(formio, 'accessInfo', \"\".concat(projectUrl, \"/access\"));\n    }\n  }, {\n    key: \"projectRoles\",\n    value: function projectRoles(formio) {\n      var projectUrl = formio ? formio.projectUrl : Formio.projectUrl;\n      return Formio.makeRequest(formio, 'projectRoles', \"\".concat(projectUrl, \"/role\"));\n    }\n  }, {\n    key: \"currentUser\",\n    value: function currentUser(formio, options) {\n      var _this9 = this;\n\n      var authUrl = Formio.authUrl;\n\n      if (!authUrl) {\n        authUrl = formio ? formio.projectUrl : Formio.projectUrl || Formio.baseUrl;\n      }\n\n      authUrl += '/current';\n      var user = Formio.getUser(options);\n\n      if (user) {\n        return Formio.pluginAlter('wrapStaticRequestPromise', _nativePromiseOnly.default.resolve(user), {\n          url: authUrl,\n          method: 'GET',\n          options: options\n        });\n      }\n\n      var token = Formio.getToken(options);\n\n      if ((!options || !options.external) && !token) {\n        return Formio.pluginAlter('wrapStaticRequestPromise', _nativePromiseOnly.default.resolve(null), {\n          url: authUrl,\n          method: 'GET',\n          options: options\n        });\n      }\n\n      this.currentUserResolved = false;\n      return Formio.makeRequest(formio, 'currentUser', authUrl, 'GET', null, options).then(function (response) {\n        _this9.currentUserResolved = true;\n        Formio.setUser(response, options);\n        return response;\n      });\n    }\n  }, {\n    key: \"logout\",\n    value: function logout(formio, options) {\n      options = options || {};\n      options.formio = formio;\n      var projectUrl = Formio.authUrl ? Formio.authUrl : formio ? formio.projectUrl : Formio.baseUrl;\n      return Formio.makeRequest(formio, 'logout', \"\".concat(projectUrl, \"/logout\")).then(function (result) {\n        Formio.setToken(null, options);\n        Formio.setUser(null, options);\n        Formio.clearCache();\n        return result;\n      }).catch(function (err) {\n        Formio.setToken(null, options);\n        Formio.setUser(null, options);\n        Formio.clearCache();\n        throw err;\n      });\n    }\n  }, {\n    key: \"pageQuery\",\n    value: function pageQuery() {\n      var pageQuery = {};\n      pageQuery.paths = [];\n      var hashes = location.hash.substr(1).replace(/\\?/g, '&').split('&');\n      var parts = [];\n      location.search.substr(1).split('&').forEach(function (item) {\n        parts = item.split('=');\n\n        if (parts.length > 1) {\n          pageQuery[parts[0]] = parts[1] && decodeURIComponent(parts[1]);\n        }\n      });\n      hashes.forEach(function (item) {\n        parts = item.split('=');\n\n        if (parts.length > 1) {\n          pageQuery[parts[0]] = parts[1] && decodeURIComponent(parts[1]);\n        } else if (item.indexOf('/') === 0) {\n          pageQuery.paths = item.substr(1).split('/');\n        }\n      });\n      return pageQuery;\n    }\n  }, {\n    key: \"oAuthCurrentUser\",\n    value: function oAuthCurrentUser(formio, token) {\n      return Formio.currentUser(formio, {\n        external: true,\n        headers: {\n          Authorization: \"Bearer \".concat(token)\n        }\n      });\n    }\n  }, {\n    key: \"samlInit\",\n    value: function samlInit(options) {\n      options = options || {};\n      var query = Formio.pageQuery();\n\n      if (query.saml) {\n        Formio.setUser(null);\n        var retVal = Formio.setToken(query.saml);\n        var uri = window.location.toString();\n        uri = uri.substring(0, uri.indexOf('?'));\n\n        if (window.location.hash) {\n          uri += window.location.hash;\n        }\n\n        window.history.replaceState({}, document.title, uri);\n        return retVal;\n      } // Set the relay if not provided.\n\n\n      if (!options.relay) {\n        options.relay = window.location.href;\n      } // go to the saml sso endpoint for this project.\n\n\n      var authUrl = Formio.authUrl || Formio.projectUrl;\n      window.location.href = \"\".concat(authUrl, \"/saml/sso?relay=\").concat(encodeURI(options.relay));\n      return false;\n    }\n  }, {\n    key: \"oktaInit\",\n    value: function oktaInit(options) {\n      options = options || {};\n\n      if ((typeof OktaAuth === \"undefined\" ? \"undefined\" : _typeof(OktaAuth)) !== undefined) {\n        options.OktaAuth = OktaAuth;\n      }\n\n      if (_typeof(options.OktaAuth) === undefined) {\n        var errorMessage = 'Cannot find OktaAuth. Please include the Okta JavaScript SDK within your application. See https://developer.okta.com/code/javascript/okta_auth_sdk for an example.';\n        console.warn(errorMessage);\n        return _nativePromiseOnly.default.reject(errorMessage);\n      }\n\n      return new _nativePromiseOnly.default(function (resolve, reject) {\n        var Okta = options.OktaAuth;\n        delete options.OktaAuth;\n        var authClient = new Okta(options);\n        authClient.tokenManager.get('accessToken').then(function (accessToken) {\n          if (accessToken) {\n            resolve(Formio.oAuthCurrentUser(options.formio, accessToken.accessToken));\n          } else if (location.hash) {\n            authClient.token.parseFromUrl().then(function (token) {\n              authClient.tokenManager.add('accessToken', token);\n              resolve(Formio.oAuthCurrentUser(options.formio, token.accessToken));\n            }).catch(function (err) {\n              console.warn(err);\n              reject(err);\n            });\n          } else {\n            authClient.token.getWithRedirect({\n              responseType: 'token',\n              scopes: options.scopes\n            });\n            resolve(false);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    }\n  }, {\n    key: \"ssoInit\",\n    value: function ssoInit(type, options) {\n      switch (type) {\n        case 'saml':\n          return Formio.samlInit(options);\n\n        case 'okta':\n          return Formio.oktaInit(options);\n\n        default:\n          console.warn('Unknown SSO type');\n          return _nativePromiseOnly.default.reject('Unknown SSO type');\n      }\n    }\n  }, {\n    key: \"requireLibrary\",\n    value: function requireLibrary(name, property, src, polling) {\n      if (!Formio.libraries.hasOwnProperty(name)) {\n        Formio.libraries[name] = {};\n        Formio.libraries[name].ready = new _nativePromiseOnly.default(function (resolve, reject) {\n          Formio.libraries[name].resolve = resolve;\n          Formio.libraries[name].reject = reject;\n        });\n        var callbackName = \"\".concat(name, \"Callback\");\n\n        if (!polling && !window[callbackName]) {\n          window[callbackName] = function () {\n            return Formio.libraries[name].resolve();\n          };\n        } // See if the plugin already exists.\n\n\n        var plugin = (0, _get2.default)(window, property);\n\n        if (plugin) {\n          Formio.libraries[name].resolve(plugin);\n        } else {\n          src = Array.isArray(src) ? src : [src];\n          src.forEach(function (lib) {\n            var attrs = {};\n            var elementType = '';\n\n            if (typeof lib === 'string') {\n              lib = {\n                type: 'script',\n                src: lib\n              };\n            }\n\n            switch (lib.type) {\n              case 'script':\n                elementType = 'script';\n                attrs = {\n                  src: lib.src,\n                  type: 'text/javascript',\n                  defer: true,\n                  async: true,\n                  referrerpolicy: 'origin'\n                };\n                break;\n\n              case 'styles':\n                elementType = 'link';\n                attrs = {\n                  href: lib.src,\n                  rel: 'stylesheet'\n                };\n                break;\n            } // Add the script to the top of the page.\n\n\n            var element = document.createElement(elementType);\n\n            if (element.setAttribute) {\n              for (var attr in attrs) {\n                element.setAttribute(attr, attrs[attr]);\n              }\n            }\n\n            var _document = document,\n                head = _document.head;\n\n            if (head) {\n              head.appendChild(element);\n            }\n          }); // if no callback is provided, then check periodically for the script.\n\n          if (polling) {\n            var interval = setInterval(function () {\n              var plugin = (0, _get2.default)(window, property);\n\n              if (plugin) {\n                clearInterval(interval);\n                Formio.libraries[name].resolve(plugin);\n              }\n            }, 200);\n          }\n        }\n      }\n\n      return Formio.libraries[name].ready;\n    }\n  }, {\n    key: \"libraryReady\",\n    value: function libraryReady(name) {\n      if (Formio.libraries.hasOwnProperty(name) && Formio.libraries[name].ready) {\n        return Formio.libraries[name].ready;\n      }\n\n      return _nativePromiseOnly.default.reject(\"\".concat(name, \" library was not required.\"));\n    }\n  }, {\n    key: \"addToGlobal\",\n    value: function addToGlobal(global) {\n      if (_typeof(global) === 'object' && !global.Formio) {\n        global.Formio = Formio;\n      }\n    }\n  }, {\n    key: \"setPathType\",\n    value: function setPathType(type) {\n      if (typeof type === 'string') {\n        Formio.pathType = type;\n      }\n    }\n  }, {\n    key: \"getPathType\",\n    value: function getPathType() {\n      return Formio.pathType;\n    }\n  }]);\n\n  return Formio;\n}(); // Define all the static properties.\n\n\n_defineProperty(Formio, \"currentUserResolved\", true);\n\nFormio.libraries = {};\nFormio.Promise = _nativePromiseOnly.default;\nFormio.fetch = fetch;\nFormio.Headers = Headers;\nFormio.baseUrl = 'https://api.form.io';\nFormio.projectUrl = Formio.baseUrl;\nFormio.authUrl = '';\nFormio.projectUrlSet = false;\nFormio.plugins = [];\nFormio.cache = {};\nFormio.Providers = _providers.default;\nFormio.version = '4.13.3';\nFormio.pathType = '';\nFormio.events = new _EventEmitter.default();\n\nif (typeof global !== 'undefined') {\n  Formio.addToGlobal(global);\n}\n\nif (typeof window !== 'undefined') {\n  Formio.addToGlobal(window);\n}\n\nvar _default = Formio;\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}