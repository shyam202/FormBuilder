{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\n\nvar _moment = _interopRequireDefault(require(\"moment\"));\n\nvar _compareVersions = _interopRequireDefault(require(\"compare-versions\"));\n\nvar _EventEmitter = _interopRequireDefault(require(\"./EventEmitter\"));\n\nvar _i18next = _interopRequireDefault(require(\"i18next\"));\n\nvar _i18n = _interopRequireDefault(require(\"./i18n\"));\n\nvar _Formio = _interopRequireDefault(require(\"./Formio\"));\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nvar _Components = _interopRequireDefault(require(\"./components/Components\"));\n\nvar _NestedDataComponent2 = _interopRequireDefault(require(\"./components/_classes/nesteddata/NestedDataComponent\"));\n\nvar _utils = require(\"./utils/utils\");\n\nvar _formUtils = require(\"./utils/formUtils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _get(target, property, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n} // Initialize the available forms.\n\n\n_Formio.default.forms = {}; // Allow people to register components.\n\n_Formio.default.registerComponent = _Components.default.setComponent;\n\nfunction getIconSet(icons) {\n  if (icons === 'fontawesome') {\n    return 'fa';\n  }\n\n  return icons || '';\n}\n\nfunction getOptions(options) {\n  options = _lodash.default.defaults(options, {\n    submitOnEnter: false,\n    iconset: getIconSet(options && options.icons ? options.icons : _Formio.default.icons),\n    i18next: _i18next.default,\n    saveDraft: false,\n    alwaysDirty: false,\n    saveDraftThrottle: 5000\n  });\n\n  if (!options.events) {\n    options.events = new _EventEmitter.default();\n  }\n\n  return options;\n}\n/**\n * Renders a Form.io form within the webpage.\n */\n\n\nvar Webform = /*#__PURE__*/function (_NestedDataComponent) {\n  _inherits(Webform, _NestedDataComponent);\n\n  var _super = _createSuper(Webform);\n  /**\n   * Creates a new Form instance.\n   *\n   * @param {Object} options - The options to create a new form instance.\n   * @param {boolean} options.saveDraft - Set this if you would like to enable the save draft feature.\n   * @param {boolean} options.saveDraftThrottle - The throttle for the save draft feature.\n   * @param {boolean} options.readOnly - Set this form to readOnly\n   * @param {boolean} options.noAlerts - Set to true to disable the alerts dialog.\n   * @param {boolean} options.i18n - The translation file for this rendering. @see https://github.com/formio/formio.js/blob/master/i18n.js\n   * @param {boolean} options.template - Provides a way to inject custom logic into the creation of every element rendered within the form.\n   */\n\n  /* eslint-disable max-statements */\n\n\n  function Webform() {\n    var _this2;\n\n    _classCallCheck(this, Webform);\n\n    var element, options;\n\n    if (arguments[0] instanceof HTMLElement || arguments[1]) {\n      element = arguments[0];\n      options = arguments[1];\n    } else {\n      options = arguments[0];\n    }\n\n    _this2 = _super.call(this, null, getOptions(options));\n\n    _defineProperty(_assertThisInitialized(_this2), \"executeShortcuts\", function (event) {\n      var target = event.target;\n\n      if (!_this2.keyboardCatchableElement(target)) {\n        return;\n      }\n\n      var ctrl = event.ctrlKey || event.metaKey;\n      var keyCode = event.keyCode;\n      var char = '';\n\n      if (65 <= keyCode && keyCode <= 90) {\n        char = String.fromCharCode(keyCode);\n      } else if (keyCode === 13) {\n        char = 'Enter';\n      } else if (keyCode === 27) {\n        char = 'Esc';\n      }\n\n      _lodash.default.each(_this2.shortcuts, function (shortcut) {\n        if (shortcut.ctrl && !ctrl) {\n          return;\n        }\n\n        if (shortcut.shortcut === char) {\n          shortcut.element.click();\n          event.preventDefault();\n        }\n      });\n    });\n\n    _this2.element = element; // Keep track of all available forms globally.\n\n    _Formio.default.forms[_this2.id] = _assertThisInitialized(_this2); // Set the base url.\n\n    if (_this2.options.baseUrl) {\n      _Formio.default.setBaseUrl(_this2.options.baseUrl);\n    }\n    /**\n     * The i18n configuration for this component.\n     */\n\n\n    var i18n = _i18n.default;\n\n    if (options && options.i18n && !options.i18nReady) {\n      // Support legacy way of doing translations.\n      if (options.i18n.resources) {\n        i18n = options.i18n;\n      } else {\n        _lodash.default.each(options.i18n, function (lang, code) {\n          if (code === 'options') {\n            _lodash.default.merge(i18n, lang);\n          } else if (!i18n.resources[code]) {\n            // extend the default translations (validations, buttons etc.) in case they are not in the options.\n            i18n.resources[code] = {\n              translation: _lodash.default.assign((0, _utils.fastCloneDeep)(_i18n.default.resources.en.translation), lang)\n            };\n          } else {\n            _lodash.default.assign(i18n.resources[code].translation, lang);\n          }\n        });\n      }\n\n      options.i18n = i18n;\n      options.i18nReady = true;\n    }\n\n    if (options && options.i18n) {\n      _this2.options.i18n = options.i18n;\n    } else {\n      _this2.options.i18n = i18n;\n    } // Set the language.\n\n\n    if (_this2.options.language) {\n      _this2.options.i18n.lng = _this2.options.language;\n    }\n    /**\n     * The type of this element.\n     * @type {string}\n     */\n\n\n    _this2.type = 'form';\n    _this2._src = '';\n    _this2._loading = false;\n    _this2._form = {};\n    _this2.draftEnabled = false;\n    _this2.savingDraft = true;\n\n    if (_this2.options.saveDraftThrottle) {\n      _this2.triggerSaveDraft = _lodash.default.throttle(_this2.saveDraft.bind(_assertThisInitialized(_this2)), _this2.options.saveDraftThrottle);\n    } else {\n      _this2.triggerSaveDraft = _this2.saveDraft.bind(_assertThisInitialized(_this2));\n    }\n\n    _this2.customErrors = [];\n    /**\n     * Determines if this form should submit the API on submit.\n     * @type {boolean}\n     */\n\n    _this2.nosubmit = false;\n    /**\n     * Determines if the form has tried to be submitted, error or not.\n     *\n     * @type {boolean}\n     */\n\n    _this2.submitted = false;\n    /**\n     * Determines if the form is being submitted at the moment.\n     *\n     * @type {boolean}\n     */\n\n    _this2.submitting = false;\n    /**\n     * The Formio instance for this form.\n     * @type {Formio}\n     */\n\n    _this2.formio = null;\n    /**\n     * The loader HTML element.\n     * @type {HTMLElement}\n     */\n\n    _this2.loader = null;\n    /**\n     * The alert HTML element\n     * @type {HTMLElement}\n     */\n\n    _this2.alert = null;\n    /**\n     * Promise that is triggered when the submission is done loading.\n     * @type {Promise}\n     */\n\n    _this2.onSubmission = null;\n    /**\n     * Determines if this submission is explicitly set.\n     * @type {boolean}\n     */\n\n    _this2.submissionSet = false;\n    /**\n     * Promise that executes when the form is ready and rendered.\n     * @type {Promise}\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.formReady.then(() => {\n     *   console.log('The form is ready!');\n     * });\n     * form.src = 'https://examples.form.io/example';\n     */\n\n    _this2.formReady = new _nativePromiseOnly.default(function (resolve, reject) {\n      /**\n       * Called when the formReady state of this form has been resolved.\n       *\n       * @type {function}\n       */\n      _this2.formReadyResolve = resolve;\n      /**\n       * Called when this form could not load and is rejected.\n       *\n       * @type {function}\n       */\n\n      _this2.formReadyReject = reject;\n    });\n    /**\n     * Promise that executes when the submission is ready and rendered.\n     * @type {Promise}\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.submissionReady.then(() => {\n     *   console.log('The submission is ready!');\n     * });\n     * form.src = 'https://examples.form.io/example/submission/234234234234234243';\n     */\n\n    _this2.submissionReady = new _nativePromiseOnly.default(function (resolve, reject) {\n      /**\n       * Called when the formReady state of this form has been resolved.\n       *\n       * @type {function}\n       */\n      _this2.submissionReadyResolve = resolve;\n      /**\n       * Called when this form could not load and is rejected.\n       *\n       * @type {function}\n       */\n\n      _this2.submissionReadyReject = reject;\n    });\n    _this2.shortcuts = []; // Set language after everything is established.\n\n    _this2.localize().then(function () {\n      _this2.language = _this2.options.language;\n    }); // See if we need to restore the draft from a user.\n\n\n    if (_this2.options.saveDraft && _Formio.default.events) {\n      _Formio.default.events.on('formio.user', function (user) {\n        _this2.formReady.then(function () {\n          // Only restore a draft if the submission isn't explicitly set.\n          if (!_this2.submissionSet) {\n            _this2.restoreDraft(user._id);\n          }\n        });\n      });\n    }\n\n    _this2.component.clearOnHide = false; // Ensure the root is set to this component.\n\n    _this2.root = _assertThisInitialized(_this2);\n    _this2.localRoot = _assertThisInitialized(_this2);\n    return _this2;\n  }\n  /* eslint-enable max-statements */\n\n\n  _createClass(Webform, [{\n    key: \"language\",\n    get: function get() {\n      return this.options.language;\n    }\n    /**\n     * Sets the language for this form.\n     *\n     * @param lang\n     * @return {Promise}\n     */\n    ,\n    set: function set(lang) {\n      var _this3 = this;\n\n      this.options.language = lang;\n\n      if (this.i18next.language === lang) {\n        return;\n      }\n\n      try {\n        this.i18next.changeLanguage(lang, function (err) {\n          if (err) {\n            return;\n          }\n\n          _this3.redraw();\n\n          _this3.emit('languageChanged');\n        });\n      } catch (err) {\n        return;\n      }\n    }\n  }, {\n    key: \"componentComponents\",\n    get: function get() {\n      return this.form.components;\n    }\n  }, {\n    key: \"shadowRoot\",\n    get: function get() {\n      return this.options.shadowRoot;\n    }\n    /**\n     * Add a language for translations\n     *\n     * @param code\n     * @param lang\n     * @param active\n     * @return {*}\n     */\n\n  }, {\n    key: \"addLanguage\",\n    value: function addLanguage(code, lang) {\n      var active = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n      var translations = _lodash.default.assign((0, _utils.fastCloneDeep)(_i18n.default.resources.en.translation), lang);\n\n      this.i18next.addResourceBundle(code, 'translation', translations, true, true);\n\n      if (active) {\n        this.language = code;\n      }\n    }\n    /**\n     * Perform the localization initialization.\n     * @returns {*}\n     */\n\n  }, {\n    key: \"localize\",\n    value: function localize() {\n      var _this4 = this;\n\n      if (this.i18next.initialized) {\n        return _nativePromiseOnly.default.resolve(this.i18next);\n      }\n\n      this.i18next.initialized = true;\n      return new _nativePromiseOnly.default(function (resolve, reject) {\n        try {\n          _this4.i18next.init(_this4.options.i18n, function (err) {\n            // Get language but remove any ;q=1 that might exist on it.\n            _this4.options.language = _this4.i18next.language.split(';')[0];\n\n            if (err) {\n              return reject(err);\n            }\n\n            resolve(_this4.i18next);\n          });\n        } catch (err) {\n          return reject(err);\n        }\n      });\n    }\n  }, {\n    key: \"keyboardCatchableElement\",\n    value: function keyboardCatchableElement(element) {\n      if (element.nodeName === 'TEXTAREA') {\n        return false;\n      }\n\n      if (element.nodeName === 'INPUT') {\n        return ['text', 'email', 'password'].indexOf(element.type) === -1;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"addShortcut\",\n    value: function addShortcut(element, shortcut) {\n      if (!shortcut || !/^([A-Z]|Enter|Esc)$/i.test(shortcut)) {\n        return;\n      }\n\n      shortcut = _lodash.default.capitalize(shortcut);\n\n      if (shortcut === 'Enter' || shortcut === 'Esc') {\n        // Restrict Enter and Esc only for buttons\n        if (element.tagName !== 'BUTTON') {\n          return;\n        }\n\n        this.shortcuts.push({\n          shortcut: shortcut,\n          element: element\n        });\n      } else {\n        this.shortcuts.push({\n          ctrl: true,\n          shortcut: shortcut,\n          element: element\n        });\n      }\n    }\n  }, {\n    key: \"removeShortcut\",\n    value: function removeShortcut(element, shortcut) {\n      if (!shortcut || !/^([A-Z]|Enter|Esc)$/i.test(shortcut)) {\n        return;\n      }\n\n      _lodash.default.remove(this.shortcuts, {\n        shortcut: shortcut,\n        element: element\n      });\n    }\n    /**\n     * Get the embed source of the form.\n     *\n     * @returns {string}\n     */\n\n  }, {\n    key: \"src\",\n    get: function get() {\n      return this._src;\n    }\n    /**\n     * Loads the submission if applicable.\n     */\n    ,\n    set:\n    /**\n     * Set the Form source, which is typically the Form.io embed URL.\n     *\n     * @param {string} value - The value of the form embed url.\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.formReady.then(() => {\n     *   console.log('The form is formReady!');\n     * });\n     * form.src = 'https://examples.form.io/example';\n     */\n    function set(value) {\n      this.setSrc(value);\n    }\n    /**\n     * Get the embed source of the form.\n     *\n     * @returns {string}\n     */\n\n  }, {\n    key: \"loadSubmission\",\n    value: function loadSubmission() {\n      var _this5 = this;\n\n      this.loadingSubmission = true;\n\n      if (this.formio.submissionId) {\n        this.onSubmission = this.formio.loadSubmission().then(function (submission) {\n          return _this5.setSubmission(submission);\n        }, function (err) {\n          return _this5.submissionReadyReject(err);\n        }).catch(function (err) {\n          return _this5.submissionReadyReject(err);\n        });\n      } else {\n        this.submissionReadyResolve();\n      }\n\n      return this.submissionReady;\n    }\n    /**\n     * Set the src of the form renderer.\n     *\n     * @param value\n     * @param options\n     */\n\n  }, {\n    key: \"setSrc\",\n    value: function setSrc(value, options) {\n      var _this6 = this;\n\n      if (this.setUrl(value, options)) {\n        this.nosubmit = false;\n        return this.formio.loadForm({\n          params: {\n            live: 1\n          }\n        }).then(function (form) {\n          var setForm = _this6.setForm(form);\n\n          _this6.loadSubmission();\n\n          return setForm;\n        }).catch(function (err) {\n          console.warn(err);\n\n          _this6.formReadyReject(err);\n        });\n      }\n\n      return _nativePromiseOnly.default.resolve();\n    }\n  }, {\n    key: \"url\",\n    get: function get() {\n      return this._src;\n    }\n    /**\n     * Sets the url of the form renderer.\n     *\n     * @param value\n     * @param options\n     */\n    ,\n    set:\n    /**\n     * Set the form source but don't initialize the form and submission from the url.\n     *\n     * @param {string} value - The value of the form embed url.\n     */\n    function set(value) {\n      this.setUrl(value);\n    }\n    /**\n     * Called when both the form and submission have been loaded.\n     *\n     * @returns {Promise} - The promise to trigger when both form and submission have loaded.\n     */\n\n  }, {\n    key: \"setUrl\",\n    value: function setUrl(value, options) {\n      if (!value || typeof value !== 'string' || value === this._src) {\n        return false;\n      }\n\n      this._src = value;\n      this.nosubmit = true;\n      this.formio = this.options.formio = new _Formio.default(value, options);\n\n      if (this.type === 'form') {\n        // Set the options source so this can be passed to other components.\n        this.options.src = value;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"ready\",\n    get: function get() {\n      var _this7 = this;\n\n      return this.formReady.then(function () {\n        return _get(_getPrototypeOf(Webform.prototype), \"ready\", _this7).then(function () {\n          return _this7.loadingSubmission ? _this7.submissionReady : true;\n        });\n      });\n    }\n    /**\n     * Returns if this form is loading.\n     *\n     * @returns {boolean} - TRUE means the form is loading, FALSE otherwise.\n     */\n\n  }, {\n    key: \"loading\",\n    get: function get() {\n      return this._loading;\n    }\n    /**\n     * Set the loading state for this form, and also show the loader spinner.\n     *\n     * @param {boolean} loading - If this form should be \"loading\" or not.\n     */\n    ,\n    set: function set(loading) {\n      if (this._loading !== loading) {\n        this._loading = loading;\n\n        if (!this.loader && loading) {\n          this.loader = this.ce('div', {\n            class: 'loader-wrapper'\n          });\n          var spinner = this.ce('div', {\n            class: 'loader text-center'\n          });\n          this.loader.appendChild(spinner);\n        }\n        /* eslint-disable max-depth */\n\n\n        if (this.loader) {\n          try {\n            if (loading) {\n              this.prependTo(this.loader, this.wrapper);\n            } else {\n              this.removeChildFrom(this.loader, this.wrapper);\n            }\n          } catch (err) {// ingore\n          }\n        }\n        /* eslint-enable max-depth */\n\n      }\n    }\n    /**\n     * Sets the JSON schema for the form to be rendered.\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.setForm({\n     *   components: [\n     *     {\n     *       type: 'textfield',\n     *       key: 'firstName',\n     *       label: 'First Name',\n     *       placeholder: 'Enter your first name.',\n     *       input: true\n     *     },\n     *     {\n     *       type: 'textfield',\n     *       key: 'lastName',\n     *       label: 'Last Name',\n     *       placeholder: 'Enter your last name',\n     *       input: true\n     *     },\n     *     {\n     *       type: 'button',\n     *       action: 'submit',\n     *       label: 'Submit',\n     *       theme: 'primary'\n     *     }\n     *   ]\n     * });\n     *\n     * @param {Object} form - The JSON schema of the form @see https://examples.form.io/example for an example JSON schema.\n     * @param flags\n     * @returns {*}\n     */\n\n  }, {\n    key: \"setForm\",\n    value: function setForm(form, flags) {\n      var _this$_form$component,\n          _this8 = this;\n\n      var isFormAlreadySet = this._form && ((_this$_form$component = this._form.components) === null || _this$_form$component === void 0 ? void 0 : _this$_form$component.length);\n\n      try {\n        var _this$parent, _this$parent$componen; // Do not set the form again if it has been already set\n\n\n        if (isFormAlreadySet && JSON.stringify(this._form) === JSON.stringify(form)) {\n          return _nativePromiseOnly.default.resolve();\n        } // Create the form.\n\n\n        this._form = flags !== null && flags !== void 0 && flags.keepAsReference ? form : _lodash.default.cloneDeep(form);\n\n        if (this.onSetForm) {\n          this.onSetForm(_lodash.default.cloneDeep(this._form), form);\n        }\n\n        if ((_this$parent = this.parent) !== null && _this$parent !== void 0 && (_this$parent$componen = _this$parent.component) !== null && _this$parent$componen !== void 0 && _this$parent$componen.modalEdit) {\n          return _nativePromiseOnly.default.resolve();\n        }\n      } catch (err) {\n        console.warn(err); // If provided form is not a valid JSON object, do not set it too\n\n        return _nativePromiseOnly.default.resolve();\n      } // Allow the form to provide component overrides.\n\n\n      if (form && form.settings && form.settings.components) {\n        this.options.components = form.settings.components;\n      }\n\n      if ('schema' in form && (0, _compareVersions.default)(form.schema, '1.x') > 0) {\n        this.ready.then(function () {\n          _this8.setAlert('alert alert-danger', 'Form schema is for a newer version, please upgrade your renderer. Some functionality may not work.');\n        });\n      } // See if they pass a module, and evaluate it if so.\n\n\n      if (form && form.module) {\n        var formModule = null;\n\n        if (typeof form.module === 'string') {\n          try {\n            formModule = this.evaluate(\"return \".concat(form.module));\n          } catch (err) {\n            console.warn(err);\n          }\n        } else {\n          formModule = form.module;\n        }\n\n        if (formModule) {\n          _Formio.default.use(formModule); // Since we got here after instantiation, we need to manually apply form options.\n\n\n          if (formModule.options && formModule.options.form) {\n            this.options = Object.assign(this.options, formModule.options.form);\n          }\n        }\n      }\n\n      this.initialized = false;\n\n      var rebuild = this.rebuild() || _nativePromiseOnly.default.resolve();\n\n      return rebuild.then(function () {\n        _this8.emit('formLoad', form);\n\n        _this8.triggerRecaptcha(); // Make sure to trigger onChange after a render event occurs to speed up form rendering.\n\n\n        setTimeout(function () {\n          _this8.onChange(flags);\n\n          _this8.formReadyResolve();\n        }, 0);\n        return _this8.formReady;\n      });\n    }\n    /**\n     * Gets the form object.\n     *\n     * @returns {Object} - The form JSON schema.\n     */\n\n  }, {\n    key: \"form\",\n    get: function get() {\n      if (!this._form) {\n        this._form = {\n          components: []\n        };\n      }\n\n      return this._form;\n    }\n    /**\n     * Sets the form value.\n     *\n     * @alias setForm\n     * @param {Object} form - The form schema object.\n     */\n    ,\n    set: function set(form) {\n      this.setForm(form);\n    }\n    /**\n     * Returns the submission object that was set within this form.\n     *\n     * @returns {Object}\n     */\n\n  }, {\n    key: \"submission\",\n    get: function get() {\n      return this.getValue();\n    }\n    /**\n     * Sets the submission of a form.\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.src = 'https://examples.form.io/example';\n     * form.submission = {data: {\n     *   firstName: 'Joe',\n     *   lastName: 'Smith',\n     *   email: 'joe@example.com'\n     * }};\n     *\n     * @param {Object} submission - The Form.io submission object.\n     */\n    ,\n    set: function set(submission) {\n      this.setSubmission(submission);\n    }\n    /**\n     * Sets a submission and returns the promise when it is ready.\n     * @param submission\n     * @param flags\n     * @return {Promise.<TResult>}\n     */\n\n  }, {\n    key: \"setSubmission\",\n    value: function setSubmission(submission) {\n      var _this9 = this;\n\n      var flags = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      flags = _objectSpread(_objectSpread({}, flags), {}, {\n        fromSubmission: _lodash.default.has(flags, 'fromSubmission') ? flags.fromSubmission : true\n      });\n      return this.onSubmission = this.formReady.then(function (resolveFlags) {\n        if (resolveFlags) {\n          flags = _objectSpread(_objectSpread({}, flags), resolveFlags);\n        }\n\n        _this9.submissionSet = true;\n\n        _this9.triggerChange(flags);\n\n        _this9.setValue(submission, flags);\n\n        _this9.setDownloadUrl();\n\n        return _this9.submissionReadyResolve(submission);\n      }, function (err) {\n        return _this9.submissionReadyReject(err);\n      }).catch(function (err) {\n        return _this9.submissionReadyReject(err);\n      });\n    }\n    /**\n     * Saves a submission draft.\n     */\n\n  }, {\n    key: \"saveDraft\",\n    value: function saveDraft() {\n      var _this10 = this;\n\n      if (!this.draftEnabled) {\n        return;\n      }\n\n      if (!this.formio) {\n        console.warn(this.t('saveDraftInstanceError'));\n        return;\n      }\n\n      if (!_Formio.default.getUser()) {\n        console.warn(this.t('saveDraftAuthError'));\n        return;\n      }\n\n      var draft = (0, _utils.fastCloneDeep)(this.submission);\n      draft.state = 'draft';\n\n      if (!this.savingDraft) {\n        this.emit('saveDraftBegin');\n        this.savingDraft = true;\n        this.formio.saveSubmission(draft).then(function (sub) {\n          // Set id to submission to avoid creating new draft submission\n          _this10.submission._id = sub._id;\n          _this10.savingDraft = false;\n\n          _this10.emit('saveDraft', sub);\n        });\n      }\n    }\n    /**\n     * Restores a draft submission based on the user who is authenticated.\n     *\n     * @param {userId} - The user id where we need to restore the draft from.\n     */\n\n  }, {\n    key: \"restoreDraft\",\n    value: function restoreDraft(userId) {\n      var _this11 = this;\n\n      if (!this.formio) {\n        console.warn(this.t('restoreDraftInstanceError'));\n        return;\n      }\n\n      this.savingDraft = true;\n      this.formio.loadSubmissions({\n        params: {\n          state: 'draft',\n          owner: userId\n        }\n      }).then(function (submissions) {\n        if (submissions.length > 0 && !_this11.options.skipDraftRestore) {\n          var draft = (0, _utils.fastCloneDeep)(submissions[0]);\n          return _this11.setSubmission(draft).then(function () {\n            _this11.draftEnabled = true;\n            _this11.savingDraft = false;\n\n            _this11.emit('restoreDraft', draft);\n          });\n        } // Enable drafts so that we can keep track of changes.\n\n\n        _this11.draftEnabled = true;\n        _this11.savingDraft = false;\n\n        _this11.emit('restoreDraft', null);\n      });\n    }\n  }, {\n    key: \"schema\",\n    get: function get() {\n      var schema = (0, _utils.fastCloneDeep)(_lodash.default.omit(this._form, ['components']));\n      schema.components = [];\n      this.eachComponent(function (component) {\n        return schema.components.push(component.schema);\n      });\n      return schema;\n    }\n  }, {\n    key: \"mergeData\",\n    value: function mergeData(_this, _that) {\n      _lodash.default.mergeWith(_this, _that, function (thisValue, thatValue) {\n        if (Array.isArray(thisValue) && Array.isArray(thatValue) && thisValue.length !== thatValue.length) {\n          return thatValue;\n        }\n      });\n    }\n  }, {\n    key: \"setValue\",\n    value: function setValue(submission) {\n      var flags = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      if (!submission || !submission.data) {\n        submission = {\n          data: {}\n        };\n      } // Metadata needs to be available before setValue\n\n\n      this._submission.metadata = submission.metadata || {};\n      this.editing = !!submission._id; // Set the timezone in the options if available.\n\n      if (!this.options.submissionTimezone && submission.metadata && submission.metadata.timezone) {\n        this.options.submissionTimezone = submission.metadata.timezone;\n      }\n\n      var changed = _get(_getPrototypeOf(Webform.prototype), \"setValue\", this).call(this, submission.data, flags);\n\n      if (!flags.sanitize) {\n        this.mergeData(this.data, submission.data);\n      }\n\n      submission.data = this.data;\n      this._submission = submission;\n      return changed;\n    }\n  }, {\n    key: \"getValue\",\n    value: function getValue() {\n      if (!this._submission.data) {\n        this._submission.data = {};\n      }\n\n      if (this.viewOnly) {\n        return this._submission;\n      }\n\n      var submission = this._submission;\n      submission.data = this.data;\n      return this._submission;\n    }\n    /**\n     * Build the form.\n     */\n\n  }, {\n    key: \"init\",\n    value: function init() {\n      var _this12 = this;\n\n      this._submission = this._submission || {\n        data: {}\n      }; // Remove any existing components.\n\n      if (this.components && this.components.length) {\n        this.destroyComponents();\n        this.components = [];\n      }\n\n      if (this.component) {\n        this.component.components = this.form ? this.form.components : [];\n      } else {\n        this.component = this.form;\n      }\n\n      this.component.type = 'form';\n      this.component.input = false;\n      this.addComponents();\n      this.on('submitButton', function (options) {\n        _this12.submit(false, options).catch(function (e) {\n          return e !== false && console.log(e);\n        });\n      }, true);\n      this.on('checkValidity', function (data) {\n        return _this12.checkValidity(data, true, data);\n      }, true);\n      this.on('requestUrl', function (args) {\n        return _this12.submitUrl(args.url, args.headers);\n      }, true);\n      this.on('resetForm', function () {\n        return _this12.resetValue();\n      }, true);\n      this.on('deleteSubmission', function () {\n        return _this12.deleteSubmission();\n      }, true);\n      this.on('refreshData', function () {\n        return _this12.updateValue();\n      }, true);\n      this.executeFormController();\n      return this.formReady;\n    }\n  }, {\n    key: \"executeFormController\",\n    value: function executeFormController() {\n      var _this13 = this; // If no controller value or\n      // hidden and set to clearOnHide (Don't calculate a value for a hidden field set to clear when hidden)\n\n\n      if (!this.form || !this.form.controller || (!this.visible || this.component.hidden) && this.component.clearOnHide && !this.rootPristine) {\n        return false;\n      }\n\n      this.formReady.then(function () {\n        _this13.evaluate(_this13.form.controller, {\n          components: _this13.components\n        });\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var deleteFromGlobal = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      this.off('submitButton');\n      this.off('checkValidity');\n      this.off('requestUrl');\n      this.off('resetForm');\n      this.off('deleteSubmission');\n      this.off('refreshData');\n\n      if (deleteFromGlobal) {\n        delete _Formio.default.forms[this.id];\n      }\n\n      return _get(_getPrototypeOf(Webform.prototype), \"destroy\", this).call(this);\n    }\n  }, {\n    key: \"build\",\n    value: function build(element) {\n      var _this14 = this;\n\n      if (element || this.element) {\n        return this.ready.then(function () {\n          element = element || _this14.element;\n\n          _get(_getPrototypeOf(Webform.prototype), \"build\", _this14).call(_this14, element);\n        });\n      }\n\n      return this.ready;\n    }\n  }, {\n    key: \"getClassName\",\n    value: function getClassName() {\n      var classes = 'formio-form';\n\n      if (this.options.readOnly) {\n        classes += ' formio-read-only';\n      }\n\n      return classes;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return _get(_getPrototypeOf(Webform.prototype), \"render\", this).call(this, this.renderTemplate('webform', {\n        classes: this.getClassName(),\n        children: this.renderComponents()\n      }), this.builderMode ? 'builder' : 'form', true);\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      // Don't bother if we have not built yet.\n      if (!this.element) {\n        return _nativePromiseOnly.default.resolve();\n      }\n\n      this.clear();\n      this.setContent(this.element, this.render());\n      return this.attach(this.element);\n    }\n  }, {\n    key: \"attach\",\n    value: function attach(element) {\n      var _this15 = this;\n\n      this.element = element;\n      this.loadRefs(element, {\n        webform: 'single'\n      });\n      var childPromise = this.attachComponents(this.refs.webform);\n      this.addEventListener(document, 'keydown', this.executeShortcuts);\n      this.currentForm = this;\n      return childPromise.then(function () {\n        _this15.emit('render', _this15.element);\n\n        return _this15.setValue(_this15._submission, {\n          noUpdateEvent: true\n        });\n      });\n    }\n  }, {\n    key: \"hasRequiredFields\",\n    value: function hasRequiredFields() {\n      var result = false;\n      (0, _formUtils.eachComponent)(this.form.components, function (component) {\n        if (component.validate.required) {\n          result = true;\n          return true;\n        }\n      }, true);\n      return result;\n    }\n  }, {\n    key: \"resetValue\",\n    value: function resetValue() {\n      _lodash.default.each(this.getComponents(), function (comp) {\n        return comp.resetValue();\n      });\n\n      this.setPristine(true);\n      this.rebuild();\n    }\n    /**\n     * Sets a new alert to display in the error dialog of the form.\n     *\n     * @param {string} type - The type of alert to display. \"danger\", \"success\", \"warning\", etc.\n     * @param {string} message - The message to show in the alert.\n     * @param {Object} options\n     */\n\n  }, {\n    key: \"setAlert\",\n    value: function setAlert(type, message, options) {\n      var _this16 = this;\n\n      if (!type && this.submitted) {\n        if (this.alert) {\n          if (this.refs.errorRef && this.refs.errorRef.length) {\n            this.refs.errorRef.forEach(function (el) {\n              _this16.removeEventListener(el, 'click');\n\n              _this16.removeEventListener(el, 'keypress');\n            });\n          }\n\n          this.removeChild(this.alert);\n          this.alert = null;\n        }\n\n        return;\n      }\n\n      if (this.options.noAlerts) {\n        if (!message) {\n          this.emit('error', false);\n        }\n\n        return;\n      }\n\n      if (this.alert) {\n        try {\n          if (this.refs.errorRef && this.refs.errorRef.length) {\n            this.refs.errorRef.forEach(function (el) {\n              _this16.removeEventListener(el, 'click');\n\n              _this16.removeEventListener(el, 'keypress');\n            });\n          }\n\n          this.removeChild(this.alert);\n          this.alert = null;\n        } catch (err) {// ignore\n        }\n      }\n\n      if (message) {\n        var attrs = {\n          class: options && options.classes || \"alert alert-\".concat(type),\n          id: \"error-list-\".concat(this.id)\n        };\n        var templateOptions = {\n          message: message instanceof HTMLElement ? message.outerHTML : message,\n          attrs: attrs,\n          type: type\n        };\n        this.alert = (0, _utils.convertStringToHTMLElement)(this.renderTemplate('alert', templateOptions), \"#\".concat(attrs.id));\n      }\n\n      if (!this.alert) {\n        return;\n      }\n\n      this.loadRefs(this.alert, {\n        errorRef: 'multiple'\n      });\n\n      if (this.refs.errorRef && this.refs.errorRef.length) {\n        this.refs.errorRef.forEach(function (el) {\n          _this16.addEventListener(el, 'click', function (e) {\n            var key = e.currentTarget.dataset.componentKey;\n\n            _this16.focusOnComponent(key);\n          });\n\n          _this16.addEventListener(el, 'keydown', function (e) {\n            if (e.keyCode === 13) {\n              e.preventDefault();\n              var key = e.currentTarget.dataset.componentKey;\n\n              _this16.focusOnComponent(key);\n            }\n          });\n        });\n      }\n\n      this.prepend(this.alert);\n    }\n    /**\n     * Focus on selected component.\n     *\n     * @param {string} key - The key of selected component.\n     * @returns {*}\n     */\n\n  }, {\n    key: \"focusOnComponent\",\n    value: function focusOnComponent(key) {\n      if (key) {\n        var component = this.getComponent(key);\n\n        if (component) {\n          component.focus();\n        }\n      }\n    }\n    /**\n     * Show the errors of this form within the alert dialog.\n     *\n     * @param {Object} error - An optional additional error to display along with the component errors.\n     * @returns {*}\n     */\n\n    /* eslint-disable no-unused-vars */\n\n  }, {\n    key: \"showErrors\",\n    value: function showErrors(error, triggerEvent, onChange) {\n      var _this17 = this;\n\n      this.loading = false;\n      var errors = this.errors;\n\n      if (error) {\n        if (Array.isArray(error)) {\n          errors = errors.concat(error);\n        } else {\n          errors.push(error);\n        }\n      } else {\n        errors = _get(_getPrototypeOf(Webform.prototype), \"errors\", this);\n      }\n\n      errors = errors.concat(this.customErrors);\n\n      if (!errors.length) {\n        this.setAlert(false);\n        return;\n      } // Mark any components as invalid if in a custom message.\n\n\n      errors.forEach(function (err) {\n        var _err$components = err.components,\n            components = _err$components === void 0 ? [] : _err$components;\n\n        if (err.component) {\n          components.push(err.component);\n        }\n\n        if (err.path) {\n          components.push(err.path);\n        }\n\n        components.forEach(function (path) {\n          var originalPath = _this17._parentPath + (0, _utils.getStringFromComponentPath)(path);\n\n          var component = _this17.getComponent(path, _lodash.default.identity, originalPath);\n\n          if (err.fromServer) {\n            if (component.serverErrors) {\n              component.serverErrors.push(err);\n            } else {\n              component.serverErrors = [err];\n            }\n          }\n\n          var components = _lodash.default.compact(Array.isArray(component) ? component : [component]);\n\n          components.forEach(function (component) {\n            return component.setCustomValidity(err.message, true);\n          });\n        });\n      });\n      var displayedErrors = [];\n      errors.forEach(function (err) {\n        if (err) {\n          var createListItem = function createListItem(message, index) {\n            var messageFromIndex = !_lodash.default.isUndefined(index) && err.messages && err.messages[index];\n            var keyOrPath = messageFromIndex && messageFromIndex.formattedKeyOrPath || messageFromIndex.path || err.component && err.component.key || err.fromServer && err.path;\n            var formattedKeyOrPath = keyOrPath ? (0, _utils.getStringFromComponentPath)(keyOrPath) : '';\n            formattedKeyOrPath = _this17._parentPath + formattedKeyOrPath;\n\n            if (!err.formattedKeyOrPath) {\n              err.formattedKeyOrPath = formattedKeyOrPath;\n            }\n\n            return {\n              message: (0, _utils.unescapeHTML)(message),\n              keyOrPath: formattedKeyOrPath\n            };\n          };\n\n          if (err.messages && err.messages.length) {\n            var component = err.component;\n            err.messages.forEach(function (_ref, index) {\n              var message = _ref.message,\n                  context = _ref.context,\n                  fromServer = _ref.fromServer;\n              var text = context !== null && context !== void 0 && context.hasLabel || fromServer ? _this17.t('alertMessage', {\n                message: _this17.t(message)\n              }) : _this17.t('alertMessageWithLabel', {\n                label: _this17.t(component.label),\n                message: _this17.t(message)\n              });\n              displayedErrors.push(createListItem(text, index));\n            });\n          } else if (err) {\n            var message = _lodash.default.isObject(err) ? _this17.t('alertMessage', {\n              message: _this17.t(err.message || '')\n            }) : _this17.t('alertMessage', {\n              message: _this17.t(err)\n            });\n            displayedErrors.push(createListItem(message));\n          }\n        }\n      });\n      var errorsList = this.renderTemplate('errorsList', {\n        errors: displayedErrors\n      });\n      this.root.setAlert('danger', errorsList);\n\n      if (triggerEvent) {\n        this.emit('error', errors);\n      }\n\n      return errors;\n    }\n    /* eslint-enable no-unused-vars */\n\n    /**\n     * Called when the submission has completed, or if the submission needs to be sent to an external library.\n     *\n     * @param {Object} submission - The submission object.\n     * @param {boolean} saved - Whether or not this submission was saved to the server.\n     * @returns {object} - The submission object.\n     */\n\n  }, {\n    key: \"onSubmit\",\n    value: function onSubmit(submission, saved) {\n      var _this$triggerSaveDraf;\n\n      this.loading = false;\n      this.submitting = false;\n      this.setPristine(true); // We want to return the submitted submission and setValue will mutate the submission so cloneDeep it here.\n\n      this.setValue((0, _utils.fastCloneDeep)(submission), {\n        noValidate: true,\n        noCheck: true\n      });\n      this.setAlert('success', \"<p>\".concat(this.t('complete'), \"</p>\")); // Cancel triggered saveDraft to prevent overriding the submitted state\n\n      if (this.draftEnabled && (_this$triggerSaveDraf = this.triggerSaveDraft) !== null && _this$triggerSaveDraf !== void 0 && _this$triggerSaveDraf.cancel) {\n        this.triggerSaveDraft.cancel();\n      }\n\n      this.emit('submit', submission, saved);\n\n      if (saved) {\n        this.emit('submitDone', submission);\n      }\n\n      return submission;\n    }\n  }, {\n    key: \"normalizeError\",\n    value: function normalizeError(error) {\n      if (error) {\n        if (_typeof(error) === 'object' && 'details' in error) {\n          error = error.details;\n        }\n\n        if (typeof error === 'string') {\n          error = {\n            message: error\n          };\n        }\n      }\n\n      return error;\n    }\n    /**\n     * Called when an error occurs during the submission.\n     *\n     * @param {Object} error - The error that occured.\n     */\n\n  }, {\n    key: \"onSubmissionError\",\n    value: function onSubmissionError(error) {\n      error = this.normalizeError(error);\n      this.submitting = false;\n      this.setPristine(false);\n      this.emit('submitError', error); // Allow for silent cancellations (no error message, no submit button error state)\n\n      if (error && error.silent) {\n        this.emit('change', {\n          isValid: true\n        }, {\n          silent: true\n        });\n        return false;\n      }\n\n      return this.showErrors(error, true);\n    }\n    /**\n     * Trigger the change event for this form.\n     *\n     * @param changed\n     * @param flags\n     */\n\n  }, {\n    key: \"onChange\",\n    value: function onChange(flags, changed, modified, changes) {\n      flags = flags || {};\n      var isChangeEventEmitted = false; // For any change events, clear any custom errors for that component.\n\n      if (changed && changed.component) {\n        this.customErrors = this.customErrors.filter(function (err) {\n          return err.component && err.component !== changed.component.key;\n        });\n      }\n\n      _get(_getPrototypeOf(Webform.prototype), \"onChange\", this).call(this, flags, true);\n\n      var value = _lodash.default.clone(this.submission);\n\n      flags.changed = value.changed = changed;\n      flags.changes = changes;\n\n      if (modified && this.pristine) {\n        this.pristine = false;\n      }\n\n      value.isValid = this.checkData(value.data, flags);\n      this.loading = false;\n\n      if (this.submitted) {\n        this.showErrors();\n      } // See if we need to save the draft of the form.\n\n\n      if (modified && this.options.saveDraft) {\n        this.triggerSaveDraft();\n      }\n\n      if (!flags || !flags.noEmit) {\n        this.emit('change', value, flags, modified);\n        isChangeEventEmitted = true;\n      } // The form is initialized after the first change event occurs.\n\n\n      if (isChangeEventEmitted && !this.initialized) {\n        this.emit('initialized');\n        this.initialized = true;\n      }\n    }\n  }, {\n    key: \"checkData\",\n    value: function checkData(data) {\n      var flags = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      var valid = _get(_getPrototypeOf(Webform.prototype), \"checkData\", this).call(this, data, flags);\n\n      if ((_lodash.default.isEmpty(flags) || flags.noValidate) && this.submitted) {\n        this.showErrors();\n      }\n\n      return valid;\n    }\n    /**\n     * Send a delete request to the server.\n     */\n\n  }, {\n    key: \"deleteSubmission\",\n    value: function deleteSubmission() {\n      var _this18 = this;\n\n      return this.formio.deleteSubmission().then(function () {\n        _this18.emit('submissionDeleted', _this18.submission);\n\n        _this18.resetValue();\n      });\n    }\n    /**\n     * Cancels the submission.\n     *\n     * @alias reset\n     */\n\n  }, {\n    key: \"cancel\",\n    value: function cancel(noconfirm) {\n      var shouldReset = this.hook('beforeCancel', true);\n\n      if (shouldReset && (noconfirm || confirm(this.t('confirmCancel')))) {\n        this.resetValue();\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }, {\n    key: \"setMetadata\",\n    value: function setMetadata(submission) {\n      // Add in metadata about client submitting the form\n      submission.metadata = submission.metadata || {};\n\n      _lodash.default.defaults(submission.metadata, {\n        timezone: _lodash.default.get(this, '_submission.metadata.timezone', (0, _utils.currentTimezone)()),\n        offset: parseInt(_lodash.default.get(this, '_submission.metadata.offset', (0, _moment.default)().utcOffset()), 10),\n        origin: document.location.origin,\n        referrer: document.referrer,\n        browserName: navigator.appName,\n        userAgent: navigator.userAgent,\n        pathName: window.location.pathname,\n        onLine: navigator.onLine\n      });\n    }\n  }, {\n    key: \"submitForm\",\n    value: function submitForm() {\n      var _this19 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      this.clearServerErrors();\n      return new _nativePromiseOnly.default(function (resolve, reject) {\n        // Read-only forms should never submit.\n        if (_this19.options.readOnly) {\n          return resolve({\n            submission: _this19.submission,\n            saved: false\n          });\n        }\n\n        var submission = (0, _utils.fastCloneDeep)(_this19.submission || {});\n\n        _this19.setMetadata(submission);\n\n        submission.state = options.state || 'submitted';\n        var isDraft = submission.state === 'draft';\n\n        _this19.hook('beforeSubmit', _objectSpread(_objectSpread({}, submission), {}, {\n          component: options.component\n        }), function (err) {\n          if (err) {\n            return reject(err);\n          }\n\n          if (!isDraft && !submission.data) {\n            return reject('Invalid Submission');\n          }\n\n          if (!isDraft && !_this19.checkValidity(submission.data, true, submission.data)) {\n            return reject();\n          }\n\n          _this19.everyComponent(function (comp) {\n            var persistent = comp.component.persistent;\n\n            if (persistent === 'client-only') {\n              _lodash.default.unset(submission.data, comp.path);\n            }\n          });\n\n          _this19.hook('customValidation', _objectSpread(_objectSpread({}, submission), {}, {\n            component: options.component\n          }), function (err) {\n            if (err) {\n              // If string is returned, cast to object.\n              if (typeof err === 'string') {\n                err = {\n                  message: err\n                };\n              } // Ensure err is an array.\n\n\n              err = Array.isArray(err) ? err : [err]; // Set as custom errors.\n\n              _this19.customErrors = err;\n              return reject();\n            }\n\n            _this19.loading = true; // Use the form action to submit the form if available.\n\n            if (_this19._form && _this19._form.action) {\n              var method = submission.data._id && _this19._form.action.includes(submission.data._id) ? 'PUT' : 'POST';\n              return _Formio.default.makeStaticRequest(_this19._form.action, method, submission, _this19.formio ? _this19.formio.options : {}).then(function (result) {\n                return resolve({\n                  submission: result,\n                  saved: true\n                });\n              }).catch(function (error) {\n                _this19.setServerErrors(error);\n\n                return reject(error);\n              });\n            }\n\n            var submitFormio = _this19.formio;\n\n            if (_this19.nosubmit || !submitFormio) {\n              return resolve({\n                submission: submission,\n                saved: false\n              });\n            } // If this is an actionUrl, then make sure to save the action and not the submission.\n\n\n            var submitMethod = submitFormio.actionUrl ? 'saveAction' : 'saveSubmission';\n            submitFormio[submitMethod](submission).then(function (result) {\n              return resolve({\n                submission: result,\n                saved: true\n              });\n            }).catch(function (error) {\n              _this19.setServerErrors(error);\n\n              return reject(error);\n            });\n          });\n        });\n      });\n    }\n  }, {\n    key: \"setServerErrors\",\n    value: function setServerErrors(error) {\n      if (error.details) {\n        this.serverErrors = error.details.filter(function (err) {\n          return err.level ? err.level === 'error' : err;\n        }).map(function (err) {\n          err.fromServer = true;\n          return err;\n        });\n      }\n    }\n  }, {\n    key: \"executeSubmit\",\n    value: function executeSubmit(options) {\n      var _this20 = this;\n\n      this.submitted = true;\n      this.submitting = true;\n      return this.submitForm(options).then(function (_ref2) {\n        var submission = _ref2.submission,\n            saved = _ref2.saved;\n        return _this20.onSubmit(submission, saved);\n      }).then(function (results) {\n        _this20.submissionInProcess = false;\n        return results;\n      }).catch(function (err) {\n        _this20.submissionInProcess = false;\n        return _nativePromiseOnly.default.reject(_this20.onSubmissionError(err));\n      });\n    }\n  }, {\n    key: \"clearServerErrors\",\n    value: function clearServerErrors() {\n      var _this$serverErrors,\n          _this21 = this;\n\n      (_this$serverErrors = this.serverErrors) === null || _this$serverErrors === void 0 ? void 0 : _this$serverErrors.forEach(function (error) {\n        if (error.path) {\n          var pathArray = (0, _utils.getArrayFromComponentPath)(error.path);\n\n          var component = _this21.getComponent(pathArray, _lodash.default.identity, error.formattedKeyOrPath);\n\n          if (component) {\n            component.serverErrors = [];\n          }\n        }\n      });\n      this.serverErrors = [];\n    }\n    /**\n     * Submits the form.\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.src = 'https://examples.form.io/example';\n     * form.submission = {data: {\n     *   firstName: 'Joe',\n     *   lastName: 'Smith',\n     *   email: 'joe@example.com'\n     * }};\n     * form.submit().then((submission) => {\n     *   console.log(submission);\n     * });\n     *\n     * @param {boolean} before - If this submission occured from the before handlers.\n     *\n     * @returns {Promise} - A promise when the form is done submitting.\n     */\n\n  }, {\n    key: \"submit\",\n    value: function submit(before, options) {\n      var _this22 = this;\n\n      this.submissionInProcess = true;\n\n      if (!before) {\n        return this.beforeSubmit(options).then(function () {\n          return _this22.executeSubmit(options);\n        });\n      } else {\n        return this.executeSubmit(options);\n      }\n    }\n  }, {\n    key: \"submitUrl\",\n    value: function submitUrl(URL, headers) {\n      var _this23 = this;\n\n      if (!URL) {\n        return console.warn('Missing URL argument');\n      }\n\n      var submission = this.submission || {};\n      var API_URL = URL;\n      var settings = {\n        method: 'POST',\n        headers: {}\n      };\n\n      if (headers && headers.length > 0) {\n        headers.map(function (e) {\n          if (e.header !== '' && e.value !== '') {\n            settings.headers[e.header] = _this23.interpolate(e.value, submission);\n          }\n        });\n      }\n\n      if (API_URL && settings) {\n        _Formio.default.makeStaticRequest(API_URL, settings.method, submission, {\n          headers: settings.headers\n        }).then(function () {\n          _this23.emit('requestDone');\n\n          _this23.setAlert('success', '<p> Success </p>');\n        }).catch(function (e) {\n          _this23.showErrors(\"\".concat(e.statusText ? e.statusText : '', \" \").concat(e.status ? e.status : e));\n\n          _this23.emit('error', \"\".concat(e.statusText ? e.statusText : '', \" \").concat(e.status ? e.status : e));\n\n          console.error(\"\".concat(e.statusText ? e.statusText : '', \" \").concat(e.status ? e.status : e));\n\n          _this23.setAlert('danger', \"<p> \".concat(e.statusText ? e.statusText : '', \" \").concat(e.status ? e.status : e, \" </p>\"));\n        });\n      } else {\n        this.emit('error', 'You should add a URL to this button.');\n        this.setAlert('warning', 'You should add a URL to this button.');\n        return console.warn('You should add a URL to this button.');\n      }\n    }\n  }, {\n    key: \"triggerRecaptcha\",\n    value: function triggerRecaptcha() {\n      if (!this || !this.components) {\n        return;\n      }\n\n      var recaptchaComponent = (0, _utils.searchComponents)(this.components, {\n        'component.type': 'recaptcha',\n        'component.eventType': 'formLoad'\n      });\n\n      if (recaptchaComponent.length > 0) {\n        recaptchaComponent[0].verify(\"\".concat(this.form.name ? this.form.name : 'form', \"Load\"));\n      }\n    }\n  }, {\n    key: \"setDownloadUrl\",\n    value: function setDownloadUrl() {\n      var _this24 = this;\n\n      if (this.formio && _lodash.default.get(this, 'form.settings.showPdfIcon', false)) {\n        this.formio.getDownloadUrl().then(function (url) {\n          // Add a download button if it has a download url.\n          if (!url) {\n            return;\n          }\n\n          if (!_this24.downloadButton) {\n            if (_this24.options.primaryProject) {\n              url += \"&project=\".concat(_this24.options.primaryProject);\n            }\n\n            _this24.downloadButton = _this24.ce('a', {\n              href: url,\n              target: '_blank',\n              style: 'position:absolute;right:10px;top:110px;cursor:pointer;'\n            }, _this24.ce('img', {\n              src: require('./pdf.image'),\n              style: 'width:3em;'\n            }));\n\n            _this24.element.insertBefore(_this24.downloadButton, _this24.iframe);\n          }\n        });\n      }\n    }\n  }, {\n    key: \"nosubmit\",\n    get: function get() {\n      return this._nosubmit || false;\n    },\n    set: function set(value) {\n      this._nosubmit = !!value;\n      this.emit('nosubmit', this._nosubmit);\n    }\n  }]);\n\n  return Webform;\n}(_NestedDataComponent2.default);\n\nexports.default = Webform;\nWebform.setBaseUrl = _Formio.default.setBaseUrl;\nWebform.setApiUrl = _Formio.default.setApiUrl;\nWebform.setAppUrl = _Formio.default.setAppUrl;","map":{"version":3,"sources":["C:/Users/ShyamLakhani/Desktop/my-app/node_modules/formiojs/Webform.js"],"names":["Object","defineProperty","exports","value","default","_lodash","_interopRequireDefault","require","_moment","_compareVersions","_EventEmitter","_i18next","_i18n","_Formio","_nativePromiseOnly","_Components","_NestedDataComponent2","_utils","_formUtils","obj","__esModule","_typeof","Symbol","iterator","constructor","prototype","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","configurable","writable","_createClass","protoProps","staticProps","_get","property","receiver","Reflect","get","base","_superPropBase","desc","call","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","forms","registerComponent","setComponent","getIconSet","icons","getOptions","options","defaults","submitOnEnter","iconset","i18next","saveDraft","alwaysDirty","saveDraftThrottle","events","Webform","_NestedDataComponent","_super","_this2","element","HTMLElement","event","keyboardCatchableElement","ctrl","ctrlKey","metaKey","keyCode","char","String","fromCharCode","each","shortcuts","shortcut","click","preventDefault","id","baseUrl","setBaseUrl","i18n","i18nReady","resources","lang","code","merge","translation","assign","fastCloneDeep","en","language","lng","type","_src","_loading","_form","draftEnabled","savingDraft","triggerSaveDraft","throttle","bind","customErrors","nosubmit","submitted","submitting","formio","loader","alert","onSubmission","submissionSet","formReady","resolve","reject","formReadyResolve","formReadyReject","submissionReady","submissionReadyResolve","submissionReadyReject","localize","then","on","user","restoreDraft","_id","component","clearOnHide","root","localRoot","set","_this3","changeLanguage","err","redraw","emit","form","components","shadowRoot","addLanguage","active","undefined","translations","addResourceBundle","_this4","initialized","init","split","nodeName","indexOf","addShortcut","test","capitalize","tagName","removeShortcut","remove","setSrc","loadSubmission","_this5","loadingSubmission","submissionId","submission","setSubmission","catch","_this6","setUrl","loadForm","params","live","setForm","console","warn","src","_this7","loading","ce","class","spinner","appendChild","prependTo","wrapper","removeChildFrom","flags","_this$_form$component","_this8","isFormAlreadySet","_this$parent","_this$parent$componen","JSON","stringify","keepAsReference","cloneDeep","onSetForm","parent","modalEdit","settings","schema","ready","setAlert","module","formModule","evaluate","concat","use","rebuild","triggerRecaptcha","setTimeout","onChange","getValue","_this9","fromSubmission","has","resolveFlags","triggerChange","setValue","setDownloadUrl","_this10","t","getUser","draft","state","saveSubmission","sub","userId","_this11","loadSubmissions","owner","submissions","skipDraftRestore","omit","eachComponent","mergeData","_this","_that","mergeWith","thisValue","thatValue","Array","isArray","data","_submission","metadata","editing","submissionTimezone","timezone","changed","sanitize","viewOnly","_this12","destroyComponents","input","addComponents","submit","log","checkValidity","args","submitUrl","url","headers","resetValue","deleteSubmission","updateValue","executeFormController","_this13","controller","visible","hidden","rootPristine","destroy","deleteFromGlobal","off","build","_this14","getClassName","classes","readOnly","render","renderTemplate","children","renderComponents","builderMode","clear","setContent","attach","_this15","loadRefs","webform","childPromise","attachComponents","refs","addEventListener","document","executeShortcuts","currentForm","noUpdateEvent","hasRequiredFields","validate","required","getComponents","comp","setPristine","message","_this16","errorRef","el","removeEventListener","removeChild","noAlerts","attrs","templateOptions","outerHTML","convertStringToHTMLElement","currentTarget","dataset","componentKey","focusOnComponent","prepend","getComponent","focus","showErrors","error","triggerEvent","_this17","errors","_err$components","path","originalPath","_parentPath","getStringFromComponentPath","identity","fromServer","serverErrors","compact","setCustomValidity","displayedErrors","createListItem","index","messageFromIndex","isUndefined","messages","keyOrPath","formattedKeyOrPath","unescapeHTML","_ref","context","text","hasLabel","label","isObject","errorsList","onSubmit","saved","_this$triggerSaveDraf","noValidate","noCheck","cancel","normalizeError","details","onSubmissionError","silent","isValid","modified","changes","isChangeEventEmitted","clone","pristine","checkData","noEmit","valid","isEmpty","_this18","noconfirm","shouldReset","hook","confirm","setMetadata","currentTimezone","offset","parseInt","utcOffset","origin","location","referrer","browserName","navigator","appName","userAgent","pathName","window","pathname","onLine","submitForm","_this19","clearServerErrors","isDraft","everyComponent","persistent","unset","action","method","includes","makeStaticRequest","setServerErrors","submitFormio","submitMethod","actionUrl","level","map","executeSubmit","_this20","_ref2","results","submissionInProcess","_this$serverErrors","_this21","pathArray","getArrayFromComponentPath","before","_this22","beforeSubmit","URL","_this23","API_URL","header","interpolate","statusText","status","recaptchaComponent","searchComponents","verify","name","_this24","getDownloadUrl","downloadButton","primaryProject","href","style","insertBefore","iframe","_nosubmit","setApiUrl","setAppUrl"],"mappings":"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","sourcesContent":["\"use strict\";\n\nrequire(\"core-js/modules/es.object.get-prototype-of.js\");\n\nrequire(\"core-js/modules/es.reflect.construct.js\");\n\nrequire(\"core-js/modules/es.reflect.get.js\");\n\nrequire(\"core-js/modules/es.object.get-own-property-descriptor.js\");\n\nrequire(\"core-js/modules/es.object.keys.js\");\n\nrequire(\"core-js/modules/es.symbol.js\");\n\nrequire(\"core-js/modules/es.object.get-own-property-descriptors.js\");\n\nrequire(\"core-js/modules/es.symbol.description.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.symbol.iterator.js\");\n\nrequire(\"core-js/modules/es.array.iterator.js\");\n\nrequire(\"core-js/modules/es.string.iterator.js\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es.regexp.exec.js\");\n\nrequire(\"core-js/modules/es.string.split.js\");\n\nrequire(\"core-js/modules/es.object.assign.js\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\n\nrequire(\"core-js/modules/es.array.concat.js\");\n\nrequire(\"core-js/modules/es.array.filter.js\");\n\nrequire(\"core-js/modules/es.array.includes.js\");\n\nrequire(\"core-js/modules/es.string.includes.js\");\n\nrequire(\"core-js/modules/es.array.map.js\");\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\n\nvar _moment = _interopRequireDefault(require(\"moment\"));\n\nvar _compareVersions = _interopRequireDefault(require(\"compare-versions\"));\n\nvar _EventEmitter = _interopRequireDefault(require(\"./EventEmitter\"));\n\nvar _i18next = _interopRequireDefault(require(\"i18next\"));\n\nvar _i18n = _interopRequireDefault(require(\"./i18n\"));\n\nvar _Formio = _interopRequireDefault(require(\"./Formio\"));\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nvar _Components = _interopRequireDefault(require(\"./components/Components\"));\n\nvar _NestedDataComponent2 = _interopRequireDefault(require(\"./components/_classes/nesteddata/NestedDataComponent\"));\n\nvar _utils = require(\"./utils/utils\");\n\nvar _formUtils = require(\"./utils/formUtils\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// Initialize the available forms.\n_Formio.default.forms = {}; // Allow people to register components.\n\n_Formio.default.registerComponent = _Components.default.setComponent;\n\nfunction getIconSet(icons) {\n  if (icons === 'fontawesome') {\n    return 'fa';\n  }\n\n  return icons || '';\n}\n\nfunction getOptions(options) {\n  options = _lodash.default.defaults(options, {\n    submitOnEnter: false,\n    iconset: getIconSet(options && options.icons ? options.icons : _Formio.default.icons),\n    i18next: _i18next.default,\n    saveDraft: false,\n    alwaysDirty: false,\n    saveDraftThrottle: 5000\n  });\n\n  if (!options.events) {\n    options.events = new _EventEmitter.default();\n  }\n\n  return options;\n}\n/**\n * Renders a Form.io form within the webpage.\n */\n\n\nvar Webform = /*#__PURE__*/function (_NestedDataComponent) {\n  _inherits(Webform, _NestedDataComponent);\n\n  var _super = _createSuper(Webform);\n\n  /**\n   * Creates a new Form instance.\n   *\n   * @param {Object} options - The options to create a new form instance.\n   * @param {boolean} options.saveDraft - Set this if you would like to enable the save draft feature.\n   * @param {boolean} options.saveDraftThrottle - The throttle for the save draft feature.\n   * @param {boolean} options.readOnly - Set this form to readOnly\n   * @param {boolean} options.noAlerts - Set to true to disable the alerts dialog.\n   * @param {boolean} options.i18n - The translation file for this rendering. @see https://github.com/formio/formio.js/blob/master/i18n.js\n   * @param {boolean} options.template - Provides a way to inject custom logic into the creation of every element rendered within the form.\n   */\n\n  /* eslint-disable max-statements */\n  function Webform() {\n    var _this2;\n\n    _classCallCheck(this, Webform);\n\n    var element, options;\n\n    if (arguments[0] instanceof HTMLElement || arguments[1]) {\n      element = arguments[0];\n      options = arguments[1];\n    } else {\n      options = arguments[0];\n    }\n\n    _this2 = _super.call(this, null, getOptions(options));\n\n    _defineProperty(_assertThisInitialized(_this2), \"executeShortcuts\", function (event) {\n      var target = event.target;\n\n      if (!_this2.keyboardCatchableElement(target)) {\n        return;\n      }\n\n      var ctrl = event.ctrlKey || event.metaKey;\n      var keyCode = event.keyCode;\n      var char = '';\n\n      if (65 <= keyCode && keyCode <= 90) {\n        char = String.fromCharCode(keyCode);\n      } else if (keyCode === 13) {\n        char = 'Enter';\n      } else if (keyCode === 27) {\n        char = 'Esc';\n      }\n\n      _lodash.default.each(_this2.shortcuts, function (shortcut) {\n        if (shortcut.ctrl && !ctrl) {\n          return;\n        }\n\n        if (shortcut.shortcut === char) {\n          shortcut.element.click();\n          event.preventDefault();\n        }\n      });\n    });\n\n    _this2.element = element; // Keep track of all available forms globally.\n\n    _Formio.default.forms[_this2.id] = _assertThisInitialized(_this2); // Set the base url.\n\n    if (_this2.options.baseUrl) {\n      _Formio.default.setBaseUrl(_this2.options.baseUrl);\n    }\n    /**\n     * The i18n configuration for this component.\n     */\n\n\n    var i18n = _i18n.default;\n\n    if (options && options.i18n && !options.i18nReady) {\n      // Support legacy way of doing translations.\n      if (options.i18n.resources) {\n        i18n = options.i18n;\n      } else {\n        _lodash.default.each(options.i18n, function (lang, code) {\n          if (code === 'options') {\n            _lodash.default.merge(i18n, lang);\n          } else if (!i18n.resources[code]) {\n            // extend the default translations (validations, buttons etc.) in case they are not in the options.\n            i18n.resources[code] = {\n              translation: _lodash.default.assign((0, _utils.fastCloneDeep)(_i18n.default.resources.en.translation), lang)\n            };\n          } else {\n            _lodash.default.assign(i18n.resources[code].translation, lang);\n          }\n        });\n      }\n\n      options.i18n = i18n;\n      options.i18nReady = true;\n    }\n\n    if (options && options.i18n) {\n      _this2.options.i18n = options.i18n;\n    } else {\n      _this2.options.i18n = i18n;\n    } // Set the language.\n\n\n    if (_this2.options.language) {\n      _this2.options.i18n.lng = _this2.options.language;\n    }\n    /**\n     * The type of this element.\n     * @type {string}\n     */\n\n\n    _this2.type = 'form';\n    _this2._src = '';\n    _this2._loading = false;\n    _this2._form = {};\n    _this2.draftEnabled = false;\n    _this2.savingDraft = true;\n\n    if (_this2.options.saveDraftThrottle) {\n      _this2.triggerSaveDraft = _lodash.default.throttle(_this2.saveDraft.bind(_assertThisInitialized(_this2)), _this2.options.saveDraftThrottle);\n    } else {\n      _this2.triggerSaveDraft = _this2.saveDraft.bind(_assertThisInitialized(_this2));\n    }\n\n    _this2.customErrors = [];\n    /**\n     * Determines if this form should submit the API on submit.\n     * @type {boolean}\n     */\n\n    _this2.nosubmit = false;\n    /**\n     * Determines if the form has tried to be submitted, error or not.\n     *\n     * @type {boolean}\n     */\n\n    _this2.submitted = false;\n    /**\n     * Determines if the form is being submitted at the moment.\n     *\n     * @type {boolean}\n     */\n\n    _this2.submitting = false;\n    /**\n     * The Formio instance for this form.\n     * @type {Formio}\n     */\n\n    _this2.formio = null;\n    /**\n     * The loader HTML element.\n     * @type {HTMLElement}\n     */\n\n    _this2.loader = null;\n    /**\n     * The alert HTML element\n     * @type {HTMLElement}\n     */\n\n    _this2.alert = null;\n    /**\n     * Promise that is triggered when the submission is done loading.\n     * @type {Promise}\n     */\n\n    _this2.onSubmission = null;\n    /**\n     * Determines if this submission is explicitly set.\n     * @type {boolean}\n     */\n\n    _this2.submissionSet = false;\n    /**\n     * Promise that executes when the form is ready and rendered.\n     * @type {Promise}\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.formReady.then(() => {\n     *   console.log('The form is ready!');\n     * });\n     * form.src = 'https://examples.form.io/example';\n     */\n\n    _this2.formReady = new _nativePromiseOnly.default(function (resolve, reject) {\n      /**\n       * Called when the formReady state of this form has been resolved.\n       *\n       * @type {function}\n       */\n      _this2.formReadyResolve = resolve;\n      /**\n       * Called when this form could not load and is rejected.\n       *\n       * @type {function}\n       */\n\n      _this2.formReadyReject = reject;\n    });\n    /**\n     * Promise that executes when the submission is ready and rendered.\n     * @type {Promise}\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.submissionReady.then(() => {\n     *   console.log('The submission is ready!');\n     * });\n     * form.src = 'https://examples.form.io/example/submission/234234234234234243';\n     */\n\n    _this2.submissionReady = new _nativePromiseOnly.default(function (resolve, reject) {\n      /**\n       * Called when the formReady state of this form has been resolved.\n       *\n       * @type {function}\n       */\n      _this2.submissionReadyResolve = resolve;\n      /**\n       * Called when this form could not load and is rejected.\n       *\n       * @type {function}\n       */\n\n      _this2.submissionReadyReject = reject;\n    });\n    _this2.shortcuts = []; // Set language after everything is established.\n\n    _this2.localize().then(function () {\n      _this2.language = _this2.options.language;\n    }); // See if we need to restore the draft from a user.\n\n\n    if (_this2.options.saveDraft && _Formio.default.events) {\n      _Formio.default.events.on('formio.user', function (user) {\n        _this2.formReady.then(function () {\n          // Only restore a draft if the submission isn't explicitly set.\n          if (!_this2.submissionSet) {\n            _this2.restoreDraft(user._id);\n          }\n        });\n      });\n    }\n\n    _this2.component.clearOnHide = false; // Ensure the root is set to this component.\n\n    _this2.root = _assertThisInitialized(_this2);\n    _this2.localRoot = _assertThisInitialized(_this2);\n    return _this2;\n  }\n  /* eslint-enable max-statements */\n\n\n  _createClass(Webform, [{\n    key: \"language\",\n    get: function get() {\n      return this.options.language;\n    }\n    /**\n     * Sets the language for this form.\n     *\n     * @param lang\n     * @return {Promise}\n     */\n    ,\n    set: function set(lang) {\n      var _this3 = this;\n\n      this.options.language = lang;\n\n      if (this.i18next.language === lang) {\n        return;\n      }\n\n      try {\n        this.i18next.changeLanguage(lang, function (err) {\n          if (err) {\n            return;\n          }\n\n          _this3.redraw();\n\n          _this3.emit('languageChanged');\n        });\n      } catch (err) {\n        return;\n      }\n    }\n  }, {\n    key: \"componentComponents\",\n    get: function get() {\n      return this.form.components;\n    }\n  }, {\n    key: \"shadowRoot\",\n    get: function get() {\n      return this.options.shadowRoot;\n    }\n    /**\n     * Add a language for translations\n     *\n     * @param code\n     * @param lang\n     * @param active\n     * @return {*}\n     */\n\n  }, {\n    key: \"addLanguage\",\n    value: function addLanguage(code, lang) {\n      var active = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n      var translations = _lodash.default.assign((0, _utils.fastCloneDeep)(_i18n.default.resources.en.translation), lang);\n\n      this.i18next.addResourceBundle(code, 'translation', translations, true, true);\n\n      if (active) {\n        this.language = code;\n      }\n    }\n    /**\n     * Perform the localization initialization.\n     * @returns {*}\n     */\n\n  }, {\n    key: \"localize\",\n    value: function localize() {\n      var _this4 = this;\n\n      if (this.i18next.initialized) {\n        return _nativePromiseOnly.default.resolve(this.i18next);\n      }\n\n      this.i18next.initialized = true;\n      return new _nativePromiseOnly.default(function (resolve, reject) {\n        try {\n          _this4.i18next.init(_this4.options.i18n, function (err) {\n            // Get language but remove any ;q=1 that might exist on it.\n            _this4.options.language = _this4.i18next.language.split(';')[0];\n\n            if (err) {\n              return reject(err);\n            }\n\n            resolve(_this4.i18next);\n          });\n        } catch (err) {\n          return reject(err);\n        }\n      });\n    }\n  }, {\n    key: \"keyboardCatchableElement\",\n    value: function keyboardCatchableElement(element) {\n      if (element.nodeName === 'TEXTAREA') {\n        return false;\n      }\n\n      if (element.nodeName === 'INPUT') {\n        return ['text', 'email', 'password'].indexOf(element.type) === -1;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"addShortcut\",\n    value: function addShortcut(element, shortcut) {\n      if (!shortcut || !/^([A-Z]|Enter|Esc)$/i.test(shortcut)) {\n        return;\n      }\n\n      shortcut = _lodash.default.capitalize(shortcut);\n\n      if (shortcut === 'Enter' || shortcut === 'Esc') {\n        // Restrict Enter and Esc only for buttons\n        if (element.tagName !== 'BUTTON') {\n          return;\n        }\n\n        this.shortcuts.push({\n          shortcut: shortcut,\n          element: element\n        });\n      } else {\n        this.shortcuts.push({\n          ctrl: true,\n          shortcut: shortcut,\n          element: element\n        });\n      }\n    }\n  }, {\n    key: \"removeShortcut\",\n    value: function removeShortcut(element, shortcut) {\n      if (!shortcut || !/^([A-Z]|Enter|Esc)$/i.test(shortcut)) {\n        return;\n      }\n\n      _lodash.default.remove(this.shortcuts, {\n        shortcut: shortcut,\n        element: element\n      });\n    }\n    /**\n     * Get the embed source of the form.\n     *\n     * @returns {string}\n     */\n\n  }, {\n    key: \"src\",\n    get: function get() {\n      return this._src;\n    }\n    /**\n     * Loads the submission if applicable.\n     */\n    ,\n    set:\n    /**\n     * Set the Form source, which is typically the Form.io embed URL.\n     *\n     * @param {string} value - The value of the form embed url.\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.formReady.then(() => {\n     *   console.log('The form is formReady!');\n     * });\n     * form.src = 'https://examples.form.io/example';\n     */\n    function set(value) {\n      this.setSrc(value);\n    }\n    /**\n     * Get the embed source of the form.\n     *\n     * @returns {string}\n     */\n\n  }, {\n    key: \"loadSubmission\",\n    value: function loadSubmission() {\n      var _this5 = this;\n\n      this.loadingSubmission = true;\n\n      if (this.formio.submissionId) {\n        this.onSubmission = this.formio.loadSubmission().then(function (submission) {\n          return _this5.setSubmission(submission);\n        }, function (err) {\n          return _this5.submissionReadyReject(err);\n        }).catch(function (err) {\n          return _this5.submissionReadyReject(err);\n        });\n      } else {\n        this.submissionReadyResolve();\n      }\n\n      return this.submissionReady;\n    }\n    /**\n     * Set the src of the form renderer.\n     *\n     * @param value\n     * @param options\n     */\n\n  }, {\n    key: \"setSrc\",\n    value: function setSrc(value, options) {\n      var _this6 = this;\n\n      if (this.setUrl(value, options)) {\n        this.nosubmit = false;\n        return this.formio.loadForm({\n          params: {\n            live: 1\n          }\n        }).then(function (form) {\n          var setForm = _this6.setForm(form);\n\n          _this6.loadSubmission();\n\n          return setForm;\n        }).catch(function (err) {\n          console.warn(err);\n\n          _this6.formReadyReject(err);\n        });\n      }\n\n      return _nativePromiseOnly.default.resolve();\n    }\n  }, {\n    key: \"url\",\n    get: function get() {\n      return this._src;\n    }\n    /**\n     * Sets the url of the form renderer.\n     *\n     * @param value\n     * @param options\n     */\n    ,\n    set:\n    /**\n     * Set the form source but don't initialize the form and submission from the url.\n     *\n     * @param {string} value - The value of the form embed url.\n     */\n    function set(value) {\n      this.setUrl(value);\n    }\n    /**\n     * Called when both the form and submission have been loaded.\n     *\n     * @returns {Promise} - The promise to trigger when both form and submission have loaded.\n     */\n\n  }, {\n    key: \"setUrl\",\n    value: function setUrl(value, options) {\n      if (!value || typeof value !== 'string' || value === this._src) {\n        return false;\n      }\n\n      this._src = value;\n      this.nosubmit = true;\n      this.formio = this.options.formio = new _Formio.default(value, options);\n\n      if (this.type === 'form') {\n        // Set the options source so this can be passed to other components.\n        this.options.src = value;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"ready\",\n    get: function get() {\n      var _this7 = this;\n\n      return this.formReady.then(function () {\n        return _get(_getPrototypeOf(Webform.prototype), \"ready\", _this7).then(function () {\n          return _this7.loadingSubmission ? _this7.submissionReady : true;\n        });\n      });\n    }\n    /**\n     * Returns if this form is loading.\n     *\n     * @returns {boolean} - TRUE means the form is loading, FALSE otherwise.\n     */\n\n  }, {\n    key: \"loading\",\n    get: function get() {\n      return this._loading;\n    }\n    /**\n     * Set the loading state for this form, and also show the loader spinner.\n     *\n     * @param {boolean} loading - If this form should be \"loading\" or not.\n     */\n    ,\n    set: function set(loading) {\n      if (this._loading !== loading) {\n        this._loading = loading;\n\n        if (!this.loader && loading) {\n          this.loader = this.ce('div', {\n            class: 'loader-wrapper'\n          });\n          var spinner = this.ce('div', {\n            class: 'loader text-center'\n          });\n          this.loader.appendChild(spinner);\n        }\n        /* eslint-disable max-depth */\n\n\n        if (this.loader) {\n          try {\n            if (loading) {\n              this.prependTo(this.loader, this.wrapper);\n            } else {\n              this.removeChildFrom(this.loader, this.wrapper);\n            }\n          } catch (err) {// ingore\n          }\n        }\n        /* eslint-enable max-depth */\n\n      }\n    }\n    /**\n     * Sets the JSON schema for the form to be rendered.\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.setForm({\n     *   components: [\n     *     {\n     *       type: 'textfield',\n     *       key: 'firstName',\n     *       label: 'First Name',\n     *       placeholder: 'Enter your first name.',\n     *       input: true\n     *     },\n     *     {\n     *       type: 'textfield',\n     *       key: 'lastName',\n     *       label: 'Last Name',\n     *       placeholder: 'Enter your last name',\n     *       input: true\n     *     },\n     *     {\n     *       type: 'button',\n     *       action: 'submit',\n     *       label: 'Submit',\n     *       theme: 'primary'\n     *     }\n     *   ]\n     * });\n     *\n     * @param {Object} form - The JSON schema of the form @see https://examples.form.io/example for an example JSON schema.\n     * @param flags\n     * @returns {*}\n     */\n\n  }, {\n    key: \"setForm\",\n    value: function setForm(form, flags) {\n      var _this$_form$component,\n          _this8 = this;\n\n      var isFormAlreadySet = this._form && ((_this$_form$component = this._form.components) === null || _this$_form$component === void 0 ? void 0 : _this$_form$component.length);\n\n      try {\n        var _this$parent, _this$parent$componen;\n\n        // Do not set the form again if it has been already set\n        if (isFormAlreadySet && JSON.stringify(this._form) === JSON.stringify(form)) {\n          return _nativePromiseOnly.default.resolve();\n        } // Create the form.\n\n\n        this._form = flags !== null && flags !== void 0 && flags.keepAsReference ? form : _lodash.default.cloneDeep(form);\n\n        if (this.onSetForm) {\n          this.onSetForm(_lodash.default.cloneDeep(this._form), form);\n        }\n\n        if ((_this$parent = this.parent) !== null && _this$parent !== void 0 && (_this$parent$componen = _this$parent.component) !== null && _this$parent$componen !== void 0 && _this$parent$componen.modalEdit) {\n          return _nativePromiseOnly.default.resolve();\n        }\n      } catch (err) {\n        console.warn(err); // If provided form is not a valid JSON object, do not set it too\n\n        return _nativePromiseOnly.default.resolve();\n      } // Allow the form to provide component overrides.\n\n\n      if (form && form.settings && form.settings.components) {\n        this.options.components = form.settings.components;\n      }\n\n      if ('schema' in form && (0, _compareVersions.default)(form.schema, '1.x') > 0) {\n        this.ready.then(function () {\n          _this8.setAlert('alert alert-danger', 'Form schema is for a newer version, please upgrade your renderer. Some functionality may not work.');\n        });\n      } // See if they pass a module, and evaluate it if so.\n\n\n      if (form && form.module) {\n        var formModule = null;\n\n        if (typeof form.module === 'string') {\n          try {\n            formModule = this.evaluate(\"return \".concat(form.module));\n          } catch (err) {\n            console.warn(err);\n          }\n        } else {\n          formModule = form.module;\n        }\n\n        if (formModule) {\n          _Formio.default.use(formModule); // Since we got here after instantiation, we need to manually apply form options.\n\n\n          if (formModule.options && formModule.options.form) {\n            this.options = Object.assign(this.options, formModule.options.form);\n          }\n        }\n      }\n\n      this.initialized = false;\n\n      var rebuild = this.rebuild() || _nativePromiseOnly.default.resolve();\n\n      return rebuild.then(function () {\n        _this8.emit('formLoad', form);\n\n        _this8.triggerRecaptcha(); // Make sure to trigger onChange after a render event occurs to speed up form rendering.\n\n\n        setTimeout(function () {\n          _this8.onChange(flags);\n\n          _this8.formReadyResolve();\n        }, 0);\n        return _this8.formReady;\n      });\n    }\n    /**\n     * Gets the form object.\n     *\n     * @returns {Object} - The form JSON schema.\n     */\n\n  }, {\n    key: \"form\",\n    get: function get() {\n      if (!this._form) {\n        this._form = {\n          components: []\n        };\n      }\n\n      return this._form;\n    }\n    /**\n     * Sets the form value.\n     *\n     * @alias setForm\n     * @param {Object} form - The form schema object.\n     */\n    ,\n    set: function set(form) {\n      this.setForm(form);\n    }\n    /**\n     * Returns the submission object that was set within this form.\n     *\n     * @returns {Object}\n     */\n\n  }, {\n    key: \"submission\",\n    get: function get() {\n      return this.getValue();\n    }\n    /**\n     * Sets the submission of a form.\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.src = 'https://examples.form.io/example';\n     * form.submission = {data: {\n     *   firstName: 'Joe',\n     *   lastName: 'Smith',\n     *   email: 'joe@example.com'\n     * }};\n     *\n     * @param {Object} submission - The Form.io submission object.\n     */\n    ,\n    set: function set(submission) {\n      this.setSubmission(submission);\n    }\n    /**\n     * Sets a submission and returns the promise when it is ready.\n     * @param submission\n     * @param flags\n     * @return {Promise.<TResult>}\n     */\n\n  }, {\n    key: \"setSubmission\",\n    value: function setSubmission(submission) {\n      var _this9 = this;\n\n      var flags = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      flags = _objectSpread(_objectSpread({}, flags), {}, {\n        fromSubmission: _lodash.default.has(flags, 'fromSubmission') ? flags.fromSubmission : true\n      });\n      return this.onSubmission = this.formReady.then(function (resolveFlags) {\n        if (resolveFlags) {\n          flags = _objectSpread(_objectSpread({}, flags), resolveFlags);\n        }\n\n        _this9.submissionSet = true;\n\n        _this9.triggerChange(flags);\n\n        _this9.setValue(submission, flags);\n\n        _this9.setDownloadUrl();\n\n        return _this9.submissionReadyResolve(submission);\n      }, function (err) {\n        return _this9.submissionReadyReject(err);\n      }).catch(function (err) {\n        return _this9.submissionReadyReject(err);\n      });\n    }\n    /**\n     * Saves a submission draft.\n     */\n\n  }, {\n    key: \"saveDraft\",\n    value: function saveDraft() {\n      var _this10 = this;\n\n      if (!this.draftEnabled) {\n        return;\n      }\n\n      if (!this.formio) {\n        console.warn(this.t('saveDraftInstanceError'));\n        return;\n      }\n\n      if (!_Formio.default.getUser()) {\n        console.warn(this.t('saveDraftAuthError'));\n        return;\n      }\n\n      var draft = (0, _utils.fastCloneDeep)(this.submission);\n      draft.state = 'draft';\n\n      if (!this.savingDraft) {\n        this.emit('saveDraftBegin');\n        this.savingDraft = true;\n        this.formio.saveSubmission(draft).then(function (sub) {\n          // Set id to submission to avoid creating new draft submission\n          _this10.submission._id = sub._id;\n          _this10.savingDraft = false;\n\n          _this10.emit('saveDraft', sub);\n        });\n      }\n    }\n    /**\n     * Restores a draft submission based on the user who is authenticated.\n     *\n     * @param {userId} - The user id where we need to restore the draft from.\n     */\n\n  }, {\n    key: \"restoreDraft\",\n    value: function restoreDraft(userId) {\n      var _this11 = this;\n\n      if (!this.formio) {\n        console.warn(this.t('restoreDraftInstanceError'));\n        return;\n      }\n\n      this.savingDraft = true;\n      this.formio.loadSubmissions({\n        params: {\n          state: 'draft',\n          owner: userId\n        }\n      }).then(function (submissions) {\n        if (submissions.length > 0 && !_this11.options.skipDraftRestore) {\n          var draft = (0, _utils.fastCloneDeep)(submissions[0]);\n          return _this11.setSubmission(draft).then(function () {\n            _this11.draftEnabled = true;\n            _this11.savingDraft = false;\n\n            _this11.emit('restoreDraft', draft);\n          });\n        } // Enable drafts so that we can keep track of changes.\n\n\n        _this11.draftEnabled = true;\n        _this11.savingDraft = false;\n\n        _this11.emit('restoreDraft', null);\n      });\n    }\n  }, {\n    key: \"schema\",\n    get: function get() {\n      var schema = (0, _utils.fastCloneDeep)(_lodash.default.omit(this._form, ['components']));\n      schema.components = [];\n      this.eachComponent(function (component) {\n        return schema.components.push(component.schema);\n      });\n      return schema;\n    }\n  }, {\n    key: \"mergeData\",\n    value: function mergeData(_this, _that) {\n      _lodash.default.mergeWith(_this, _that, function (thisValue, thatValue) {\n        if (Array.isArray(thisValue) && Array.isArray(thatValue) && thisValue.length !== thatValue.length) {\n          return thatValue;\n        }\n      });\n    }\n  }, {\n    key: \"setValue\",\n    value: function setValue(submission) {\n      var flags = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      if (!submission || !submission.data) {\n        submission = {\n          data: {}\n        };\n      } // Metadata needs to be available before setValue\n\n\n      this._submission.metadata = submission.metadata || {};\n      this.editing = !!submission._id; // Set the timezone in the options if available.\n\n      if (!this.options.submissionTimezone && submission.metadata && submission.metadata.timezone) {\n        this.options.submissionTimezone = submission.metadata.timezone;\n      }\n\n      var changed = _get(_getPrototypeOf(Webform.prototype), \"setValue\", this).call(this, submission.data, flags);\n\n      if (!flags.sanitize) {\n        this.mergeData(this.data, submission.data);\n      }\n\n      submission.data = this.data;\n      this._submission = submission;\n      return changed;\n    }\n  }, {\n    key: \"getValue\",\n    value: function getValue() {\n      if (!this._submission.data) {\n        this._submission.data = {};\n      }\n\n      if (this.viewOnly) {\n        return this._submission;\n      }\n\n      var submission = this._submission;\n      submission.data = this.data;\n      return this._submission;\n    }\n    /**\n     * Build the form.\n     */\n\n  }, {\n    key: \"init\",\n    value: function init() {\n      var _this12 = this;\n\n      this._submission = this._submission || {\n        data: {}\n      }; // Remove any existing components.\n\n      if (this.components && this.components.length) {\n        this.destroyComponents();\n        this.components = [];\n      }\n\n      if (this.component) {\n        this.component.components = this.form ? this.form.components : [];\n      } else {\n        this.component = this.form;\n      }\n\n      this.component.type = 'form';\n      this.component.input = false;\n      this.addComponents();\n      this.on('submitButton', function (options) {\n        _this12.submit(false, options).catch(function (e) {\n          return e !== false && console.log(e);\n        });\n      }, true);\n      this.on('checkValidity', function (data) {\n        return _this12.checkValidity(data, true, data);\n      }, true);\n      this.on('requestUrl', function (args) {\n        return _this12.submitUrl(args.url, args.headers);\n      }, true);\n      this.on('resetForm', function () {\n        return _this12.resetValue();\n      }, true);\n      this.on('deleteSubmission', function () {\n        return _this12.deleteSubmission();\n      }, true);\n      this.on('refreshData', function () {\n        return _this12.updateValue();\n      }, true);\n      this.executeFormController();\n      return this.formReady;\n    }\n  }, {\n    key: \"executeFormController\",\n    value: function executeFormController() {\n      var _this13 = this;\n\n      // If no controller value or\n      // hidden and set to clearOnHide (Don't calculate a value for a hidden field set to clear when hidden)\n      if (!this.form || !this.form.controller || (!this.visible || this.component.hidden) && this.component.clearOnHide && !this.rootPristine) {\n        return false;\n      }\n\n      this.formReady.then(function () {\n        _this13.evaluate(_this13.form.controller, {\n          components: _this13.components\n        });\n      });\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var deleteFromGlobal = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      this.off('submitButton');\n      this.off('checkValidity');\n      this.off('requestUrl');\n      this.off('resetForm');\n      this.off('deleteSubmission');\n      this.off('refreshData');\n\n      if (deleteFromGlobal) {\n        delete _Formio.default.forms[this.id];\n      }\n\n      return _get(_getPrototypeOf(Webform.prototype), \"destroy\", this).call(this);\n    }\n  }, {\n    key: \"build\",\n    value: function build(element) {\n      var _this14 = this;\n\n      if (element || this.element) {\n        return this.ready.then(function () {\n          element = element || _this14.element;\n\n          _get(_getPrototypeOf(Webform.prototype), \"build\", _this14).call(_this14, element);\n        });\n      }\n\n      return this.ready;\n    }\n  }, {\n    key: \"getClassName\",\n    value: function getClassName() {\n      var classes = 'formio-form';\n\n      if (this.options.readOnly) {\n        classes += ' formio-read-only';\n      }\n\n      return classes;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return _get(_getPrototypeOf(Webform.prototype), \"render\", this).call(this, this.renderTemplate('webform', {\n        classes: this.getClassName(),\n        children: this.renderComponents()\n      }), this.builderMode ? 'builder' : 'form', true);\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      // Don't bother if we have not built yet.\n      if (!this.element) {\n        return _nativePromiseOnly.default.resolve();\n      }\n\n      this.clear();\n      this.setContent(this.element, this.render());\n      return this.attach(this.element);\n    }\n  }, {\n    key: \"attach\",\n    value: function attach(element) {\n      var _this15 = this;\n\n      this.element = element;\n      this.loadRefs(element, {\n        webform: 'single'\n      });\n      var childPromise = this.attachComponents(this.refs.webform);\n      this.addEventListener(document, 'keydown', this.executeShortcuts);\n      this.currentForm = this;\n      return childPromise.then(function () {\n        _this15.emit('render', _this15.element);\n\n        return _this15.setValue(_this15._submission, {\n          noUpdateEvent: true\n        });\n      });\n    }\n  }, {\n    key: \"hasRequiredFields\",\n    value: function hasRequiredFields() {\n      var result = false;\n      (0, _formUtils.eachComponent)(this.form.components, function (component) {\n        if (component.validate.required) {\n          result = true;\n          return true;\n        }\n      }, true);\n      return result;\n    }\n  }, {\n    key: \"resetValue\",\n    value: function resetValue() {\n      _lodash.default.each(this.getComponents(), function (comp) {\n        return comp.resetValue();\n      });\n\n      this.setPristine(true);\n      this.rebuild();\n    }\n    /**\n     * Sets a new alert to display in the error dialog of the form.\n     *\n     * @param {string} type - The type of alert to display. \"danger\", \"success\", \"warning\", etc.\n     * @param {string} message - The message to show in the alert.\n     * @param {Object} options\n     */\n\n  }, {\n    key: \"setAlert\",\n    value: function setAlert(type, message, options) {\n      var _this16 = this;\n\n      if (!type && this.submitted) {\n        if (this.alert) {\n          if (this.refs.errorRef && this.refs.errorRef.length) {\n            this.refs.errorRef.forEach(function (el) {\n              _this16.removeEventListener(el, 'click');\n\n              _this16.removeEventListener(el, 'keypress');\n            });\n          }\n\n          this.removeChild(this.alert);\n          this.alert = null;\n        }\n\n        return;\n      }\n\n      if (this.options.noAlerts) {\n        if (!message) {\n          this.emit('error', false);\n        }\n\n        return;\n      }\n\n      if (this.alert) {\n        try {\n          if (this.refs.errorRef && this.refs.errorRef.length) {\n            this.refs.errorRef.forEach(function (el) {\n              _this16.removeEventListener(el, 'click');\n\n              _this16.removeEventListener(el, 'keypress');\n            });\n          }\n\n          this.removeChild(this.alert);\n          this.alert = null;\n        } catch (err) {// ignore\n        }\n      }\n\n      if (message) {\n        var attrs = {\n          class: options && options.classes || \"alert alert-\".concat(type),\n          id: \"error-list-\".concat(this.id)\n        };\n        var templateOptions = {\n          message: message instanceof HTMLElement ? message.outerHTML : message,\n          attrs: attrs,\n          type: type\n        };\n        this.alert = (0, _utils.convertStringToHTMLElement)(this.renderTemplate('alert', templateOptions), \"#\".concat(attrs.id));\n      }\n\n      if (!this.alert) {\n        return;\n      }\n\n      this.loadRefs(this.alert, {\n        errorRef: 'multiple'\n      });\n\n      if (this.refs.errorRef && this.refs.errorRef.length) {\n        this.refs.errorRef.forEach(function (el) {\n          _this16.addEventListener(el, 'click', function (e) {\n            var key = e.currentTarget.dataset.componentKey;\n\n            _this16.focusOnComponent(key);\n          });\n\n          _this16.addEventListener(el, 'keydown', function (e) {\n            if (e.keyCode === 13) {\n              e.preventDefault();\n              var key = e.currentTarget.dataset.componentKey;\n\n              _this16.focusOnComponent(key);\n            }\n          });\n        });\n      }\n\n      this.prepend(this.alert);\n    }\n    /**\n     * Focus on selected component.\n     *\n     * @param {string} key - The key of selected component.\n     * @returns {*}\n     */\n\n  }, {\n    key: \"focusOnComponent\",\n    value: function focusOnComponent(key) {\n      if (key) {\n        var component = this.getComponent(key);\n\n        if (component) {\n          component.focus();\n        }\n      }\n    }\n    /**\n     * Show the errors of this form within the alert dialog.\n     *\n     * @param {Object} error - An optional additional error to display along with the component errors.\n     * @returns {*}\n     */\n\n    /* eslint-disable no-unused-vars */\n\n  }, {\n    key: \"showErrors\",\n    value: function showErrors(error, triggerEvent, onChange) {\n      var _this17 = this;\n\n      this.loading = false;\n      var errors = this.errors;\n\n      if (error) {\n        if (Array.isArray(error)) {\n          errors = errors.concat(error);\n        } else {\n          errors.push(error);\n        }\n      } else {\n        errors = _get(_getPrototypeOf(Webform.prototype), \"errors\", this);\n      }\n\n      errors = errors.concat(this.customErrors);\n\n      if (!errors.length) {\n        this.setAlert(false);\n        return;\n      } // Mark any components as invalid if in a custom message.\n\n\n      errors.forEach(function (err) {\n        var _err$components = err.components,\n            components = _err$components === void 0 ? [] : _err$components;\n\n        if (err.component) {\n          components.push(err.component);\n        }\n\n        if (err.path) {\n          components.push(err.path);\n        }\n\n        components.forEach(function (path) {\n          var originalPath = _this17._parentPath + (0, _utils.getStringFromComponentPath)(path);\n\n          var component = _this17.getComponent(path, _lodash.default.identity, originalPath);\n\n          if (err.fromServer) {\n            if (component.serverErrors) {\n              component.serverErrors.push(err);\n            } else {\n              component.serverErrors = [err];\n            }\n          }\n\n          var components = _lodash.default.compact(Array.isArray(component) ? component : [component]);\n\n          components.forEach(function (component) {\n            return component.setCustomValidity(err.message, true);\n          });\n        });\n      });\n      var displayedErrors = [];\n      errors.forEach(function (err) {\n        if (err) {\n          var createListItem = function createListItem(message, index) {\n            var messageFromIndex = !_lodash.default.isUndefined(index) && err.messages && err.messages[index];\n            var keyOrPath = messageFromIndex && messageFromIndex.formattedKeyOrPath || messageFromIndex.path || err.component && err.component.key || err.fromServer && err.path;\n            var formattedKeyOrPath = keyOrPath ? (0, _utils.getStringFromComponentPath)(keyOrPath) : '';\n            formattedKeyOrPath = _this17._parentPath + formattedKeyOrPath;\n\n            if (!err.formattedKeyOrPath) {\n              err.formattedKeyOrPath = formattedKeyOrPath;\n            }\n\n            return {\n              message: (0, _utils.unescapeHTML)(message),\n              keyOrPath: formattedKeyOrPath\n            };\n          };\n\n          if (err.messages && err.messages.length) {\n            var component = err.component;\n            err.messages.forEach(function (_ref, index) {\n              var message = _ref.message,\n                  context = _ref.context,\n                  fromServer = _ref.fromServer;\n              var text = context !== null && context !== void 0 && context.hasLabel || fromServer ? _this17.t('alertMessage', {\n                message: _this17.t(message)\n              }) : _this17.t('alertMessageWithLabel', {\n                label: _this17.t(component.label),\n                message: _this17.t(message)\n              });\n              displayedErrors.push(createListItem(text, index));\n            });\n          } else if (err) {\n            var message = _lodash.default.isObject(err) ? _this17.t('alertMessage', {\n              message: _this17.t(err.message || '')\n            }) : _this17.t('alertMessage', {\n              message: _this17.t(err)\n            });\n            displayedErrors.push(createListItem(message));\n          }\n        }\n      });\n      var errorsList = this.renderTemplate('errorsList', {\n        errors: displayedErrors\n      });\n      this.root.setAlert('danger', errorsList);\n\n      if (triggerEvent) {\n        this.emit('error', errors);\n      }\n\n      return errors;\n    }\n    /* eslint-enable no-unused-vars */\n\n    /**\n     * Called when the submission has completed, or if the submission needs to be sent to an external library.\n     *\n     * @param {Object} submission - The submission object.\n     * @param {boolean} saved - Whether or not this submission was saved to the server.\n     * @returns {object} - The submission object.\n     */\n\n  }, {\n    key: \"onSubmit\",\n    value: function onSubmit(submission, saved) {\n      var _this$triggerSaveDraf;\n\n      this.loading = false;\n      this.submitting = false;\n      this.setPristine(true); // We want to return the submitted submission and setValue will mutate the submission so cloneDeep it here.\n\n      this.setValue((0, _utils.fastCloneDeep)(submission), {\n        noValidate: true,\n        noCheck: true\n      });\n      this.setAlert('success', \"<p>\".concat(this.t('complete'), \"</p>\")); // Cancel triggered saveDraft to prevent overriding the submitted state\n\n      if (this.draftEnabled && (_this$triggerSaveDraf = this.triggerSaveDraft) !== null && _this$triggerSaveDraf !== void 0 && _this$triggerSaveDraf.cancel) {\n        this.triggerSaveDraft.cancel();\n      }\n\n      this.emit('submit', submission, saved);\n\n      if (saved) {\n        this.emit('submitDone', submission);\n      }\n\n      return submission;\n    }\n  }, {\n    key: \"normalizeError\",\n    value: function normalizeError(error) {\n      if (error) {\n        if (_typeof(error) === 'object' && 'details' in error) {\n          error = error.details;\n        }\n\n        if (typeof error === 'string') {\n          error = {\n            message: error\n          };\n        }\n      }\n\n      return error;\n    }\n    /**\n     * Called when an error occurs during the submission.\n     *\n     * @param {Object} error - The error that occured.\n     */\n\n  }, {\n    key: \"onSubmissionError\",\n    value: function onSubmissionError(error) {\n      error = this.normalizeError(error);\n      this.submitting = false;\n      this.setPristine(false);\n      this.emit('submitError', error); // Allow for silent cancellations (no error message, no submit button error state)\n\n      if (error && error.silent) {\n        this.emit('change', {\n          isValid: true\n        }, {\n          silent: true\n        });\n        return false;\n      }\n\n      return this.showErrors(error, true);\n    }\n    /**\n     * Trigger the change event for this form.\n     *\n     * @param changed\n     * @param flags\n     */\n\n  }, {\n    key: \"onChange\",\n    value: function onChange(flags, changed, modified, changes) {\n      flags = flags || {};\n      var isChangeEventEmitted = false; // For any change events, clear any custom errors for that component.\n\n      if (changed && changed.component) {\n        this.customErrors = this.customErrors.filter(function (err) {\n          return err.component && err.component !== changed.component.key;\n        });\n      }\n\n      _get(_getPrototypeOf(Webform.prototype), \"onChange\", this).call(this, flags, true);\n\n      var value = _lodash.default.clone(this.submission);\n\n      flags.changed = value.changed = changed;\n      flags.changes = changes;\n\n      if (modified && this.pristine) {\n        this.pristine = false;\n      }\n\n      value.isValid = this.checkData(value.data, flags);\n      this.loading = false;\n\n      if (this.submitted) {\n        this.showErrors();\n      } // See if we need to save the draft of the form.\n\n\n      if (modified && this.options.saveDraft) {\n        this.triggerSaveDraft();\n      }\n\n      if (!flags || !flags.noEmit) {\n        this.emit('change', value, flags, modified);\n        isChangeEventEmitted = true;\n      } // The form is initialized after the first change event occurs.\n\n\n      if (isChangeEventEmitted && !this.initialized) {\n        this.emit('initialized');\n        this.initialized = true;\n      }\n    }\n  }, {\n    key: \"checkData\",\n    value: function checkData(data) {\n      var flags = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n      var valid = _get(_getPrototypeOf(Webform.prototype), \"checkData\", this).call(this, data, flags);\n\n      if ((_lodash.default.isEmpty(flags) || flags.noValidate) && this.submitted) {\n        this.showErrors();\n      }\n\n      return valid;\n    }\n    /**\n     * Send a delete request to the server.\n     */\n\n  }, {\n    key: \"deleteSubmission\",\n    value: function deleteSubmission() {\n      var _this18 = this;\n\n      return this.formio.deleteSubmission().then(function () {\n        _this18.emit('submissionDeleted', _this18.submission);\n\n        _this18.resetValue();\n      });\n    }\n    /**\n     * Cancels the submission.\n     *\n     * @alias reset\n     */\n\n  }, {\n    key: \"cancel\",\n    value: function cancel(noconfirm) {\n      var shouldReset = this.hook('beforeCancel', true);\n\n      if (shouldReset && (noconfirm || confirm(this.t('confirmCancel')))) {\n        this.resetValue();\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }, {\n    key: \"setMetadata\",\n    value: function setMetadata(submission) {\n      // Add in metadata about client submitting the form\n      submission.metadata = submission.metadata || {};\n\n      _lodash.default.defaults(submission.metadata, {\n        timezone: _lodash.default.get(this, '_submission.metadata.timezone', (0, _utils.currentTimezone)()),\n        offset: parseInt(_lodash.default.get(this, '_submission.metadata.offset', (0, _moment.default)().utcOffset()), 10),\n        origin: document.location.origin,\n        referrer: document.referrer,\n        browserName: navigator.appName,\n        userAgent: navigator.userAgent,\n        pathName: window.location.pathname,\n        onLine: navigator.onLine\n      });\n    }\n  }, {\n    key: \"submitForm\",\n    value: function submitForm() {\n      var _this19 = this;\n\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      this.clearServerErrors();\n      return new _nativePromiseOnly.default(function (resolve, reject) {\n        // Read-only forms should never submit.\n        if (_this19.options.readOnly) {\n          return resolve({\n            submission: _this19.submission,\n            saved: false\n          });\n        }\n\n        var submission = (0, _utils.fastCloneDeep)(_this19.submission || {});\n\n        _this19.setMetadata(submission);\n\n        submission.state = options.state || 'submitted';\n        var isDraft = submission.state === 'draft';\n\n        _this19.hook('beforeSubmit', _objectSpread(_objectSpread({}, submission), {}, {\n          component: options.component\n        }), function (err) {\n          if (err) {\n            return reject(err);\n          }\n\n          if (!isDraft && !submission.data) {\n            return reject('Invalid Submission');\n          }\n\n          if (!isDraft && !_this19.checkValidity(submission.data, true, submission.data)) {\n            return reject();\n          }\n\n          _this19.everyComponent(function (comp) {\n            var persistent = comp.component.persistent;\n\n            if (persistent === 'client-only') {\n              _lodash.default.unset(submission.data, comp.path);\n            }\n          });\n\n          _this19.hook('customValidation', _objectSpread(_objectSpread({}, submission), {}, {\n            component: options.component\n          }), function (err) {\n            if (err) {\n              // If string is returned, cast to object.\n              if (typeof err === 'string') {\n                err = {\n                  message: err\n                };\n              } // Ensure err is an array.\n\n\n              err = Array.isArray(err) ? err : [err]; // Set as custom errors.\n\n              _this19.customErrors = err;\n              return reject();\n            }\n\n            _this19.loading = true; // Use the form action to submit the form if available.\n\n            if (_this19._form && _this19._form.action) {\n              var method = submission.data._id && _this19._form.action.includes(submission.data._id) ? 'PUT' : 'POST';\n              return _Formio.default.makeStaticRequest(_this19._form.action, method, submission, _this19.formio ? _this19.formio.options : {}).then(function (result) {\n                return resolve({\n                  submission: result,\n                  saved: true\n                });\n              }).catch(function (error) {\n                _this19.setServerErrors(error);\n\n                return reject(error);\n              });\n            }\n\n            var submitFormio = _this19.formio;\n\n            if (_this19.nosubmit || !submitFormio) {\n              return resolve({\n                submission: submission,\n                saved: false\n              });\n            } // If this is an actionUrl, then make sure to save the action and not the submission.\n\n\n            var submitMethod = submitFormio.actionUrl ? 'saveAction' : 'saveSubmission';\n            submitFormio[submitMethod](submission).then(function (result) {\n              return resolve({\n                submission: result,\n                saved: true\n              });\n            }).catch(function (error) {\n              _this19.setServerErrors(error);\n\n              return reject(error);\n            });\n          });\n        });\n      });\n    }\n  }, {\n    key: \"setServerErrors\",\n    value: function setServerErrors(error) {\n      if (error.details) {\n        this.serverErrors = error.details.filter(function (err) {\n          return err.level ? err.level === 'error' : err;\n        }).map(function (err) {\n          err.fromServer = true;\n          return err;\n        });\n      }\n    }\n  }, {\n    key: \"executeSubmit\",\n    value: function executeSubmit(options) {\n      var _this20 = this;\n\n      this.submitted = true;\n      this.submitting = true;\n      return this.submitForm(options).then(function (_ref2) {\n        var submission = _ref2.submission,\n            saved = _ref2.saved;\n        return _this20.onSubmit(submission, saved);\n      }).then(function (results) {\n        _this20.submissionInProcess = false;\n        return results;\n      }).catch(function (err) {\n        _this20.submissionInProcess = false;\n        return _nativePromiseOnly.default.reject(_this20.onSubmissionError(err));\n      });\n    }\n  }, {\n    key: \"clearServerErrors\",\n    value: function clearServerErrors() {\n      var _this$serverErrors,\n          _this21 = this;\n\n      (_this$serverErrors = this.serverErrors) === null || _this$serverErrors === void 0 ? void 0 : _this$serverErrors.forEach(function (error) {\n        if (error.path) {\n          var pathArray = (0, _utils.getArrayFromComponentPath)(error.path);\n\n          var component = _this21.getComponent(pathArray, _lodash.default.identity, error.formattedKeyOrPath);\n\n          if (component) {\n            component.serverErrors = [];\n          }\n        }\n      });\n      this.serverErrors = [];\n    }\n    /**\n     * Submits the form.\n     *\n     * @example\n     * import Webform from 'formiojs/Webform';\n     * let form = new Webform(document.getElementById('formio'));\n     * form.src = 'https://examples.form.io/example';\n     * form.submission = {data: {\n     *   firstName: 'Joe',\n     *   lastName: 'Smith',\n     *   email: 'joe@example.com'\n     * }};\n     * form.submit().then((submission) => {\n     *   console.log(submission);\n     * });\n     *\n     * @param {boolean} before - If this submission occured from the before handlers.\n     *\n     * @returns {Promise} - A promise when the form is done submitting.\n     */\n\n  }, {\n    key: \"submit\",\n    value: function submit(before, options) {\n      var _this22 = this;\n\n      this.submissionInProcess = true;\n\n      if (!before) {\n        return this.beforeSubmit(options).then(function () {\n          return _this22.executeSubmit(options);\n        });\n      } else {\n        return this.executeSubmit(options);\n      }\n    }\n  }, {\n    key: \"submitUrl\",\n    value: function submitUrl(URL, headers) {\n      var _this23 = this;\n\n      if (!URL) {\n        return console.warn('Missing URL argument');\n      }\n\n      var submission = this.submission || {};\n      var API_URL = URL;\n      var settings = {\n        method: 'POST',\n        headers: {}\n      };\n\n      if (headers && headers.length > 0) {\n        headers.map(function (e) {\n          if (e.header !== '' && e.value !== '') {\n            settings.headers[e.header] = _this23.interpolate(e.value, submission);\n          }\n        });\n      }\n\n      if (API_URL && settings) {\n        _Formio.default.makeStaticRequest(API_URL, settings.method, submission, {\n          headers: settings.headers\n        }).then(function () {\n          _this23.emit('requestDone');\n\n          _this23.setAlert('success', '<p> Success </p>');\n        }).catch(function (e) {\n          _this23.showErrors(\"\".concat(e.statusText ? e.statusText : '', \" \").concat(e.status ? e.status : e));\n\n          _this23.emit('error', \"\".concat(e.statusText ? e.statusText : '', \" \").concat(e.status ? e.status : e));\n\n          console.error(\"\".concat(e.statusText ? e.statusText : '', \" \").concat(e.status ? e.status : e));\n\n          _this23.setAlert('danger', \"<p> \".concat(e.statusText ? e.statusText : '', \" \").concat(e.status ? e.status : e, \" </p>\"));\n        });\n      } else {\n        this.emit('error', 'You should add a URL to this button.');\n        this.setAlert('warning', 'You should add a URL to this button.');\n        return console.warn('You should add a URL to this button.');\n      }\n    }\n  }, {\n    key: \"triggerRecaptcha\",\n    value: function triggerRecaptcha() {\n      if (!this || !this.components) {\n        return;\n      }\n\n      var recaptchaComponent = (0, _utils.searchComponents)(this.components, {\n        'component.type': 'recaptcha',\n        'component.eventType': 'formLoad'\n      });\n\n      if (recaptchaComponent.length > 0) {\n        recaptchaComponent[0].verify(\"\".concat(this.form.name ? this.form.name : 'form', \"Load\"));\n      }\n    }\n  }, {\n    key: \"setDownloadUrl\",\n    value: function setDownloadUrl() {\n      var _this24 = this;\n\n      if (this.formio && _lodash.default.get(this, 'form.settings.showPdfIcon', false)) {\n        this.formio.getDownloadUrl().then(function (url) {\n          // Add a download button if it has a download url.\n          if (!url) {\n            return;\n          }\n\n          if (!_this24.downloadButton) {\n            if (_this24.options.primaryProject) {\n              url += \"&project=\".concat(_this24.options.primaryProject);\n            }\n\n            _this24.downloadButton = _this24.ce('a', {\n              href: url,\n              target: '_blank',\n              style: 'position:absolute;right:10px;top:110px;cursor:pointer;'\n            }, _this24.ce('img', {\n              src: require('./pdf.image'),\n              style: 'width:3em;'\n            }));\n\n            _this24.element.insertBefore(_this24.downloadButton, _this24.iframe);\n          }\n        });\n      }\n    }\n  }, {\n    key: \"nosubmit\",\n    get: function get() {\n      return this._nosubmit || false;\n    },\n    set: function set(value) {\n      this._nosubmit = !!value;\n      this.emit('nosubmit', this._nosubmit);\n    }\n  }]);\n\n  return Webform;\n}(_NestedDataComponent2.default);\n\nexports.default = Webform;\nWebform.setBaseUrl = _Formio.default.setBaseUrl;\nWebform.setApiUrl = _Formio.default.setApiUrl;\nWebform.setAppUrl = _Formio.default.setAppUrl;"]},"metadata":{},"sourceType":"script"}