{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*!\n * https://github.com/Starcounter-Jack/JSON-Patch\n * (c) 2017 Joachim Wester\n * MIT license\n */\n\nvar helpers_1 = require(\"./helpers\");\n\nvar core_1 = require(\"./core\");\n/* export all core functions and types */\n\n\nvar core_2 = require(\"./core\");\n\nexports.applyOperation = core_2.applyOperation;\nexports.applyPatch = core_2.applyPatch;\nexports.applyReducer = core_2.applyReducer;\nexports.getValueByPointer = core_2.getValueByPointer;\nexports.validate = core_2.validate;\nexports.validator = core_2.validator;\n/* export some helpers */\n\nvar helpers_2 = require(\"./helpers\");\n\nexports.JsonPatchError = helpers_2.PatchError;\nexports.deepClone = helpers_2._deepClone;\nexports.escapePathComponent = helpers_2.escapePathComponent;\nexports.unescapePathComponent = helpers_2.unescapePathComponent;\nvar beforeDict = new WeakMap();\n\nvar Mirror =\n/** @class */\nfunction () {\n  function Mirror(obj) {\n    this.observers = new Map();\n    this.obj = obj;\n  }\n\n  return Mirror;\n}();\n\nvar ObserverInfo =\n/** @class */\nfunction () {\n  function ObserverInfo(callback, observer) {\n    this.callback = callback;\n    this.observer = observer;\n  }\n\n  return ObserverInfo;\n}();\n\nfunction getMirror(obj) {\n  return beforeDict.get(obj);\n}\n\nfunction getObserverFromMirror(mirror, callback) {\n  return mirror.observers.get(callback);\n}\n\nfunction removeObserverFromMirror(mirror, observer) {\n  mirror.observers.delete(observer.callback);\n}\n/**\n * Detach an observer from an object\n */\n\n\nfunction unobserve(root, observer) {\n  observer.unobserve();\n}\n\nexports.unobserve = unobserve;\n/**\n * Observes changes made to an object, which can then be retrieved using generate\n */\n\nfunction observe(obj, callback) {\n  var patches = [];\n  var observer;\n  var mirror = getMirror(obj);\n\n  if (!mirror) {\n    mirror = new Mirror(obj);\n    beforeDict.set(obj, mirror);\n  } else {\n    var observerInfo = getObserverFromMirror(mirror, callback);\n    observer = observerInfo && observerInfo.observer;\n  }\n\n  if (observer) {\n    return observer;\n  }\n\n  observer = {};\n  mirror.value = helpers_1._deepClone(obj);\n\n  if (callback) {\n    observer.callback = callback;\n    observer.next = null;\n\n    var dirtyCheck = function () {\n      generate(observer);\n    };\n\n    var fastCheck = function () {\n      clearTimeout(observer.next);\n      observer.next = setTimeout(dirtyCheck);\n    };\n\n    if (typeof window !== 'undefined') {\n      //not Node\n      window.addEventListener('mouseup', fastCheck);\n      window.addEventListener('keyup', fastCheck);\n      window.addEventListener('mousedown', fastCheck);\n      window.addEventListener('keydown', fastCheck);\n      window.addEventListener('change', fastCheck);\n    }\n  }\n\n  observer.patches = patches;\n  observer.object = obj;\n\n  observer.unobserve = function () {\n    generate(observer);\n    clearTimeout(observer.next);\n    removeObserverFromMirror(mirror, observer);\n\n    if (typeof window !== 'undefined') {\n      window.removeEventListener('mouseup', fastCheck);\n      window.removeEventListener('keyup', fastCheck);\n      window.removeEventListener('mousedown', fastCheck);\n      window.removeEventListener('keydown', fastCheck);\n      window.removeEventListener('change', fastCheck);\n    }\n  };\n\n  mirror.observers.set(callback, new ObserverInfo(callback, observer));\n  return observer;\n}\n\nexports.observe = observe;\n/**\n * Generate an array of patches from an observer\n */\n\nfunction generate(observer, invertible) {\n  if (invertible === void 0) {\n    invertible = false;\n  }\n\n  var mirror = beforeDict.get(observer.object);\n\n  _generate(mirror.value, observer.object, observer.patches, \"\", invertible);\n\n  if (observer.patches.length) {\n    core_1.applyPatch(mirror.value, observer.patches);\n  }\n\n  var temp = observer.patches;\n\n  if (temp.length > 0) {\n    observer.patches = [];\n\n    if (observer.callback) {\n      observer.callback(temp);\n    }\n  }\n\n  return temp;\n}\n\nexports.generate = generate; // Dirty check if obj is different from mirror, generate patches and update mirror\n\nfunction _generate(mirror, obj, patches, path, invertible) {\n  if (obj === mirror) {\n    return;\n  }\n\n  if (typeof obj.toJSON === \"function\") {\n    obj = obj.toJSON();\n  }\n\n  var newKeys = helpers_1._objectKeys(obj);\n\n  var oldKeys = helpers_1._objectKeys(mirror);\n\n  var changed = false;\n  var deleted = false; //if ever \"move\" operation is implemented here, make sure this test runs OK: \"should not generate the same patch twice (move)\"\n\n  for (var t = oldKeys.length - 1; t >= 0; t--) {\n    var key = oldKeys[t];\n    var oldVal = mirror[key];\n\n    if (helpers_1.hasOwnProperty(obj, key) && !(obj[key] === undefined && oldVal !== undefined && Array.isArray(obj) === false)) {\n      var newVal = obj[key];\n\n      if (typeof oldVal == \"object\" && oldVal != null && typeof newVal == \"object\" && newVal != null) {\n        _generate(oldVal, newVal, patches, path + \"/\" + helpers_1.escapePathComponent(key), invertible);\n      } else {\n        if (oldVal !== newVal) {\n          changed = true;\n\n          if (invertible) {\n            patches.push({\n              op: \"test\",\n              path: path + \"/\" + helpers_1.escapePathComponent(key),\n              value: helpers_1._deepClone(oldVal)\n            });\n          }\n\n          patches.push({\n            op: \"replace\",\n            path: path + \"/\" + helpers_1.escapePathComponent(key),\n            value: helpers_1._deepClone(newVal)\n          });\n        }\n      }\n    } else if (Array.isArray(mirror) === Array.isArray(obj)) {\n      if (invertible) {\n        patches.push({\n          op: \"test\",\n          path: path + \"/\" + helpers_1.escapePathComponent(key),\n          value: helpers_1._deepClone(oldVal)\n        });\n      }\n\n      patches.push({\n        op: \"remove\",\n        path: path + \"/\" + helpers_1.escapePathComponent(key)\n      });\n      deleted = true; // property has been deleted\n    } else {\n      if (invertible) {\n        patches.push({\n          op: \"test\",\n          path: path,\n          value: mirror\n        });\n      }\n\n      patches.push({\n        op: \"replace\",\n        path: path,\n        value: obj\n      });\n      changed = true;\n    }\n  }\n\n  if (!deleted && newKeys.length == oldKeys.length) {\n    return;\n  }\n\n  for (var t = 0; t < newKeys.length; t++) {\n    var key = newKeys[t];\n\n    if (!helpers_1.hasOwnProperty(mirror, key) && obj[key] !== undefined) {\n      patches.push({\n        op: \"add\",\n        path: path + \"/\" + helpers_1.escapePathComponent(key),\n        value: helpers_1._deepClone(obj[key])\n      });\n    }\n  }\n}\n/**\n * Create an array of patches from the differences in two objects\n */\n\n\nfunction compare(tree1, tree2, invertible) {\n  if (invertible === void 0) {\n    invertible = false;\n  }\n\n  var patches = [];\n\n  _generate(tree1, tree2, patches, '', invertible);\n\n  return patches;\n}\n\nexports.compare = compare;\n/**\n * Default export for backwards compat\n */\n// import just to re-export as default\n\nvar core = require(\"./core\");\n\nvar helpers_3 = require(\"./helpers\");\n\nexports.default = __assign({}, core, {\n  // duplex\n  unobserve: unobserve,\n  observe: observe,\n  generate: generate,\n  compare: compare,\n  // helpers\n  JsonPatchError: helpers_3.PatchError,\n  deepClone: helpers_1._deepClone,\n  escapePathComponent: helpers_1.escapePathComponent,\n  unescapePathComponent: helpers_3.unescapePathComponent\n});","map":{"version":3,"sources":["C:/Users/ShyamLakhani/Desktop/my-app/node_modules/fast-json-patch/lib/duplex.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","defineProperty","exports","value","helpers_1","require","core_1","core_2","applyOperation","applyPatch","applyReducer","getValueByPointer","validate","validator","helpers_2","JsonPatchError","PatchError","deepClone","_deepClone","escapePathComponent","unescapePathComponent","beforeDict","WeakMap","Mirror","obj","observers","Map","ObserverInfo","callback","observer","getMirror","get","getObserverFromMirror","mirror","removeObserverFromMirror","delete","unobserve","root","observe","patches","set","observerInfo","next","dirtyCheck","generate","fastCheck","clearTimeout","setTimeout","window","addEventListener","object","removeEventListener","invertible","_generate","temp","path","toJSON","newKeys","_objectKeys","oldKeys","changed","deleted","key","oldVal","undefined","Array","isArray","newVal","push","op","compare","tree1","tree2","core","helpers_3","default"],"mappings":"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","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*!\n * https://github.com/Starcounter-Jack/JSON-Patch\n * (c) 2017 Joachim Wester\n * MIT license\n */\nvar helpers_1 = require(\"./helpers\");\nvar core_1 = require(\"./core\");\n/* export all core functions and types */\nvar core_2 = require(\"./core\");\nexports.applyOperation = core_2.applyOperation;\nexports.applyPatch = core_2.applyPatch;\nexports.applyReducer = core_2.applyReducer;\nexports.getValueByPointer = core_2.getValueByPointer;\nexports.validate = core_2.validate;\nexports.validator = core_2.validator;\n/* export some helpers */\nvar helpers_2 = require(\"./helpers\");\nexports.JsonPatchError = helpers_2.PatchError;\nexports.deepClone = helpers_2._deepClone;\nexports.escapePathComponent = helpers_2.escapePathComponent;\nexports.unescapePathComponent = helpers_2.unescapePathComponent;\nvar beforeDict = new WeakMap();\nvar Mirror = /** @class */ (function () {\n    function Mirror(obj) {\n        this.observers = new Map();\n        this.obj = obj;\n    }\n    return Mirror;\n}());\nvar ObserverInfo = /** @class */ (function () {\n    function ObserverInfo(callback, observer) {\n        this.callback = callback;\n        this.observer = observer;\n    }\n    return ObserverInfo;\n}());\nfunction getMirror(obj) {\n    return beforeDict.get(obj);\n}\nfunction getObserverFromMirror(mirror, callback) {\n    return mirror.observers.get(callback);\n}\nfunction removeObserverFromMirror(mirror, observer) {\n    mirror.observers.delete(observer.callback);\n}\n/**\n * Detach an observer from an object\n */\nfunction unobserve(root, observer) {\n    observer.unobserve();\n}\nexports.unobserve = unobserve;\n/**\n * Observes changes made to an object, which can then be retrieved using generate\n */\nfunction observe(obj, callback) {\n    var patches = [];\n    var observer;\n    var mirror = getMirror(obj);\n    if (!mirror) {\n        mirror = new Mirror(obj);\n        beforeDict.set(obj, mirror);\n    }\n    else {\n        var observerInfo = getObserverFromMirror(mirror, callback);\n        observer = observerInfo && observerInfo.observer;\n    }\n    if (observer) {\n        return observer;\n    }\n    observer = {};\n    mirror.value = helpers_1._deepClone(obj);\n    if (callback) {\n        observer.callback = callback;\n        observer.next = null;\n        var dirtyCheck = function () {\n            generate(observer);\n        };\n        var fastCheck = function () {\n            clearTimeout(observer.next);\n            observer.next = setTimeout(dirtyCheck);\n        };\n        if (typeof window !== 'undefined') { //not Node\n            window.addEventListener('mouseup', fastCheck);\n            window.addEventListener('keyup', fastCheck);\n            window.addEventListener('mousedown', fastCheck);\n            window.addEventListener('keydown', fastCheck);\n            window.addEventListener('change', fastCheck);\n        }\n    }\n    observer.patches = patches;\n    observer.object = obj;\n    observer.unobserve = function () {\n        generate(observer);\n        clearTimeout(observer.next);\n        removeObserverFromMirror(mirror, observer);\n        if (typeof window !== 'undefined') {\n            window.removeEventListener('mouseup', fastCheck);\n            window.removeEventListener('keyup', fastCheck);\n            window.removeEventListener('mousedown', fastCheck);\n            window.removeEventListener('keydown', fastCheck);\n            window.removeEventListener('change', fastCheck);\n        }\n    };\n    mirror.observers.set(callback, new ObserverInfo(callback, observer));\n    return observer;\n}\nexports.observe = observe;\n/**\n * Generate an array of patches from an observer\n */\nfunction generate(observer, invertible) {\n    if (invertible === void 0) { invertible = false; }\n    var mirror = beforeDict.get(observer.object);\n    _generate(mirror.value, observer.object, observer.patches, \"\", invertible);\n    if (observer.patches.length) {\n        core_1.applyPatch(mirror.value, observer.patches);\n    }\n    var temp = observer.patches;\n    if (temp.length > 0) {\n        observer.patches = [];\n        if (observer.callback) {\n            observer.callback(temp);\n        }\n    }\n    return temp;\n}\nexports.generate = generate;\n// Dirty check if obj is different from mirror, generate patches and update mirror\nfunction _generate(mirror, obj, patches, path, invertible) {\n    if (obj === mirror) {\n        return;\n    }\n    if (typeof obj.toJSON === \"function\") {\n        obj = obj.toJSON();\n    }\n    var newKeys = helpers_1._objectKeys(obj);\n    var oldKeys = helpers_1._objectKeys(mirror);\n    var changed = false;\n    var deleted = false;\n    //if ever \"move\" operation is implemented here, make sure this test runs OK: \"should not generate the same patch twice (move)\"\n    for (var t = oldKeys.length - 1; t >= 0; t--) {\n        var key = oldKeys[t];\n        var oldVal = mirror[key];\n        if (helpers_1.hasOwnProperty(obj, key) && !(obj[key] === undefined && oldVal !== undefined && Array.isArray(obj) === false)) {\n            var newVal = obj[key];\n            if (typeof oldVal == \"object\" && oldVal != null && typeof newVal == \"object\" && newVal != null) {\n                _generate(oldVal, newVal, patches, path + \"/\" + helpers_1.escapePathComponent(key), invertible);\n            }\n            else {\n                if (oldVal !== newVal) {\n                    changed = true;\n                    if (invertible) {\n                        patches.push({ op: \"test\", path: path + \"/\" + helpers_1.escapePathComponent(key), value: helpers_1._deepClone(oldVal) });\n                    }\n                    patches.push({ op: \"replace\", path: path + \"/\" + helpers_1.escapePathComponent(key), value: helpers_1._deepClone(newVal) });\n                }\n            }\n        }\n        else if (Array.isArray(mirror) === Array.isArray(obj)) {\n            if (invertible) {\n                patches.push({ op: \"test\", path: path + \"/\" + helpers_1.escapePathComponent(key), value: helpers_1._deepClone(oldVal) });\n            }\n            patches.push({ op: \"remove\", path: path + \"/\" + helpers_1.escapePathComponent(key) });\n            deleted = true; // property has been deleted\n        }\n        else {\n            if (invertible) {\n                patches.push({ op: \"test\", path: path, value: mirror });\n            }\n            patches.push({ op: \"replace\", path: path, value: obj });\n            changed = true;\n        }\n    }\n    if (!deleted && newKeys.length == oldKeys.length) {\n        return;\n    }\n    for (var t = 0; t < newKeys.length; t++) {\n        var key = newKeys[t];\n        if (!helpers_1.hasOwnProperty(mirror, key) && obj[key] !== undefined) {\n            patches.push({ op: \"add\", path: path + \"/\" + helpers_1.escapePathComponent(key), value: helpers_1._deepClone(obj[key]) });\n        }\n    }\n}\n/**\n * Create an array of patches from the differences in two objects\n */\nfunction compare(tree1, tree2, invertible) {\n    if (invertible === void 0) { invertible = false; }\n    var patches = [];\n    _generate(tree1, tree2, patches, '', invertible);\n    return patches;\n}\nexports.compare = compare;\n/**\n * Default export for backwards compat\n */\n// import just to re-export as default\nvar core = require(\"./core\");\nvar helpers_3 = require(\"./helpers\");\nexports.default = __assign({}, core, { \n    // duplex\n    unobserve: unobserve,\n    observe: observe,\n    generate: generate,\n    compare: compare,\n    // helpers\n    JsonPatchError: helpers_3.PatchError, deepClone: helpers_1._deepClone, escapePathComponent: helpers_1.escapePathComponent,\n    unescapePathComponent: helpers_3.unescapePathComponent });\n"]},"metadata":{},"sourceType":"script"}