{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _Webform = _interopRequireDefault(require(\"./Webform\"));\n\nvar _Component2 = _interopRequireDefault(require(\"./components/_classes/component/Component\"));\n\nvar _tooltip = _interopRequireDefault(require(\"tooltip.js\"));\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nvar _Components = _interopRequireDefault(require(\"./components/Components\"));\n\nvar _Formio = _interopRequireDefault(require(\"./Formio\"));\n\nvar _utils = require(\"./utils/utils\");\n\nvar _formUtils = require(\"./utils/formUtils\");\n\nvar _builder = _interopRequireDefault(require(\"./utils/builder\"));\n\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\n\nvar _Templates = _interopRequireDefault(require(\"./templates/Templates\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _get(target, property, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nrequire('./components/builder');\n\nvar dragula;\n\nif (typeof window !== 'undefined') {\n  // Import from \"dist\" because it would require and \"global\" would not be defined in Angular apps.\n  dragula = require('dragula/dist/dragula');\n}\n\nvar WebformBuilder = /*#__PURE__*/function (_Component) {\n  _inherits(WebformBuilder, _Component);\n\n  var _super = _createSuper(WebformBuilder); // eslint-disable-next-line max-statements\n\n\n  function WebformBuilder() {\n    var _this;\n\n    _classCallCheck(this, WebformBuilder);\n\n    var element, options;\n\n    if (arguments[0] instanceof HTMLElement || arguments[1]) {\n      element = arguments[0];\n      options = arguments[1];\n    } else {\n      options = arguments[0];\n    } // Reset skipInit in case PDFBuilder has set it.\n\n\n    options.skipInit = false;\n    _this = _super.call(this, null, options);\n    _this.element = element;\n    _this.builderHeight = 0;\n    _this.schemas = {};\n    _this.repeatablePaths = [];\n    _this.sideBarScroll = _lodash.default.get(_this.options, 'sideBarScroll', true);\n    _this.sideBarScrollOffset = _lodash.default.get(_this.options, 'sideBarScrollOffset', 0);\n    _this.dragDropEnabled = true; // Setup the builder options.\n\n    _this.builder = _lodash.default.defaultsDeep({}, _this.options.builder, _this.defaultGroups); // Turn off if explicitely said to do so...\n\n    _lodash.default.each(_this.defaultGroups, function (config, key) {\n      if (config === false) {\n        _this.builder[key] = false;\n      }\n    }); // Add the groups.\n\n\n    _this.groups = {};\n    _this.groupOrder = [];\n\n    var _loop = function _loop(group) {\n      if (_this.builder[group]) {\n        _this.builder[group].key = group;\n        _this.groups[group] = _this.builder[group];\n        _this.groups[group].components = _this.groups[group].components || {};\n        _this.groups[group].componentOrder = _this.groups[group].componentOrder || [];\n        _this.groups[group].subgroups = Object.keys(_this.groups[group].groups || {}).map(function (groupKey) {\n          _this.groups[group].groups[groupKey].componentOrder = Object.keys(_this.groups[group].groups[groupKey].components).map(function (key) {\n            return key;\n          });\n          return _this.groups[group].groups[groupKey];\n        });\n\n        _this.groupOrder.push(_this.groups[group]);\n      }\n    };\n\n    for (var group in _this.builder) {\n      _loop(group);\n    }\n\n    _this.groupOrder = _this.groupOrder.filter(function (group) {\n      return group && !group.ignore;\n    }).sort(function (a, b) {\n      return a.weight - b.weight;\n    }).map(function (group) {\n      return group.key;\n    });\n\n    for (var type in _Components.default.components) {\n      var component = _Components.default.components[type];\n\n      if (component.builderInfo && component.builderInfo.schema) {\n        _this.schemas[type] = component.builderInfo.schema;\n        component.type = type;\n        var builderInfo = component.builderInfo;\n        builderInfo.key = component.type;\n\n        _this.addBuilderComponentInfo(builderInfo);\n      }\n    } // Filter out any extra components.\n    // Add the components in each group.\n\n\n    for (var _group in _this.groups) {\n      var info = _this.groups[_group];\n\n      for (var key in info.components) {\n        var comp = info.components[key];\n\n        if (comp === true && _Components.default.components[key] && _Components.default.components[key].builderInfo) {\n          comp = _Components.default.components[key].builderInfo;\n        }\n\n        if (comp && comp.schema) {\n          _this.schemas[key] = comp.schema;\n          info.components[key] = comp;\n          info.components[key].key = key;\n        } else {\n          // Do not include this component in the components array.\n          delete info.components[key];\n        }\n      } // Order the components.\n\n\n      _this.orderComponents(info);\n    }\n\n    _this.options.hooks = _this.options.hooks || {};\n\n    _this.options.hooks.renderComponent = function (html, _ref) {\n      var _self$component;\n\n      var component = _ref.component,\n          self = _ref.self;\n\n      if (self.type === 'form' && !self.key) {\n        // The main webform shouldn't have this class as it adds extra styles.\n        return html.replace('formio-component-form', '');\n      }\n\n      if (_this.options.disabled && _this.options.disabled.includes(self.key) || self.parent.noDragDrop) {\n        return html;\n      }\n\n      return _this.renderTemplate('builderComponent', {\n        html: html,\n        disableBuilderActions: self === null || self === void 0 ? void 0 : (_self$component = self.component) === null || _self$component === void 0 ? void 0 : _self$component.disableBuilderActions,\n        childComponent: component\n      });\n    };\n\n    _this.options.hooks.renderComponents = function (html, _ref2) {\n      var components = _ref2.components,\n          self = _ref2.self; // if Datagrid and already has a component, don't make it droppable.\n\n      if (self.type === 'datagrid' && components.length > 0 || self.noDragDrop) {\n        return html;\n      }\n\n      if (!components || !components.length && !components.nodrop || self.type === 'form' && components.length <= 1 && (components.length === 0 || components[0].type === 'button')) {\n        html = _this.renderTemplate('builderPlaceholder', {\n          position: 0\n        }) + html;\n      }\n\n      return _this.renderTemplate('builderComponents', {\n        key: self.key,\n        type: self.type,\n        html: html\n      });\n    };\n\n    _this.options.hooks.renderInput = function (html, _ref3) {\n      var self = _ref3.self;\n\n      if (self.type === 'hidden') {\n        return html + self.name;\n      }\n\n      return html;\n    };\n\n    _this.options.hooks.renderLoading = function (html, _ref4) {\n      var self = _ref4.self;\n\n      if (self.type === 'form' && self.key) {\n        return self.name;\n      }\n\n      return html;\n    };\n\n    _this.options.hooks.attachComponents = function (element, components, container, component) {\n      // Don't attach if no element was found or component doesn't participate in drag'n'drop.\n      if (!element) {\n        return;\n      }\n\n      if (component.noDragDrop) {\n        return element;\n      } // Attach container and component to element for later reference.\n\n\n      var containerElement = element.querySelector(\"[ref=\\\"\".concat(component.component.key, \"-container\\\"]\")) || element;\n      containerElement.formioContainer = container;\n      containerElement.formioComponent = component; // Add container to draggable list.\n\n      if (_this.dragula && _this.allowDrop(element)) {\n        _this.dragula.containers.push(containerElement);\n      } // If this is an existing datagrid element, don't make it draggable.\n\n\n      if ((component.type === 'datagrid' || component.type === 'datamap') && components.length > 0) {\n        return element;\n      } // Since we added a wrapper, need to return the original element so that we can find the components inside it.\n\n\n      return element.children[0];\n    };\n\n    _this.options.hooks.attachDatagrid = function (element, component) {\n      component.loadRefs(element, _defineProperty({}, \"\".concat(component.key, \"-container\"), 'single'));\n      var dataGridContainer = component.refs[\"\".concat(component.key, \"-container\")];\n\n      if (dataGridContainer) {\n        component.attachComponents(dataGridContainer.parentNode, [], component.component.components);\n      } // Need to set up horizontal rearrangement of fields.\n\n    };\n\n    _this.options.hooks.attachComponent = _this.attachComponent.bind(_assertThisInitialized(_this)); // Load resources tagged as 'builder'\n\n    var query = {\n      params: {\n        type: 'resource',\n        limit: 4294967295,\n        select: '_id,title,name,components'\n      }\n    };\n\n    if (_this.options && _this.options.resourceTag) {\n      query.params.tags = [_this.options.resourceTag];\n    } else if (!_this.options || !_this.options.hasOwnProperty('resourceTag')) {\n      query.params.tags = ['builder'];\n    }\n\n    var formio = new _Formio.default(_Formio.default.projectUrl);\n    var isResourcesDisabled = _this.options.builder && _this.options.builder.resource === false;\n    formio.loadProject().then(function (project) {\n      if (project && _lodash.default.get(project, 'settings.addConfigToForms', false)) {\n        _this.options.formConfig = project.config || {};\n      }\n    });\n\n    if (!formio.noProject && !isResourcesDisabled) {\n      var resourceOptions = _this.options.builder && _this.options.builder.resource;\n      formio.loadForms(query).then(function (resources) {\n        if (resources.length) {\n          _this.builder.resource = {\n            title: resourceOptions ? resourceOptions.title : 'Existing Resource Fields',\n            key: 'resource',\n            weight: resourceOptions ? resourceOptions.weight : 50,\n            subgroups: [],\n            components: [],\n            componentOrder: []\n          };\n          _this.groups.resource = {\n            title: resourceOptions ? resourceOptions.title : 'Existing Resource Fields',\n            key: 'resource',\n            weight: resourceOptions ? resourceOptions.weight : 50,\n            subgroups: [],\n            components: [],\n            componentOrder: []\n          };\n\n          if (!_this.groupOrder.includes('resource')) {\n            _this.groupOrder.push('resource');\n          }\n\n          _this.addExistingResourceFields(resources);\n        }\n      });\n    } // Notify components if they need to modify their render.\n\n\n    _this.options.attachMode = 'builder';\n    _this.webform = _this.webform || _this.createForm(_this.options);\n    return _this;\n  }\n\n  _createClass(WebformBuilder, [{\n    key: \"allowDrop\",\n    value: function allowDrop() {\n      return true;\n    }\n  }, {\n    key: \"addExistingResourceFields\",\n    value: function addExistingResourceFields(resources) {\n      var _this2 = this;\n\n      _lodash.default.each(resources, function (resource, index) {\n        var resourceKey = \"resource-\".concat(resource.name);\n        var subgroup = {\n          key: resourceKey,\n          title: resource.title,\n          components: [],\n          componentOrder: [],\n          default: index === 0\n        };\n        (0, _formUtils.eachComponent)(resource.components, function (component) {\n          if (component.type === 'button') return;\n          if (_this2.options && _this2.options.resourceFilter && (!component.tags || component.tags.indexOf(_this2.options.resourceFilter) === -1)) return;\n          var componentName = component.label;\n\n          if (!componentName && component.key) {\n            componentName = _lodash.default.upperFirst(component.key);\n          }\n\n          subgroup.componentOrder.push(component.key);\n          subgroup.components[component.key] = _lodash.default.merge((0, _utils.fastCloneDeep)(_Components.default.components[component.type] ? _Components.default.components[component.type].builderInfo : _Components.default.components['unknown'].builderInfo), {\n            key: component.key,\n            title: componentName,\n            group: 'resource',\n            subgroup: resourceKey\n          }, {\n            schema: _objectSpread(_objectSpread({}, component), {}, {\n              label: component.label,\n              key: component.key,\n              lockKey: true,\n              source: !_this2.options.noSource ? resource._id : undefined,\n              isNew: true\n            })\n          });\n        }, true);\n\n        _this2.groups.resource.subgroups.push(subgroup);\n      });\n\n      this.triggerRedraw();\n    }\n  }, {\n    key: \"attachTooltip\",\n    value: function attachTooltip(component, title) {\n      return new _tooltip.default(component, {\n        trigger: 'hover focus',\n        placement: 'top',\n        title: title\n      });\n    }\n  }, {\n    key: \"attachComponent\",\n    value: function attachComponent(element, component) {\n      var _this3 = this; // Add component to element for later reference.\n\n\n      element.formioComponent = component;\n      component.loadRefs(element, {\n        removeComponent: 'single',\n        editComponent: 'single',\n        moveComponent: 'single',\n        copyComponent: 'single',\n        pasteComponent: 'single',\n        editJson: 'single'\n      });\n\n      if (component.refs.copyComponent) {\n        this.attachTooltip(component.refs.copyComponent, this.t('Copy'));\n        component.addEventListener(component.refs.copyComponent, 'click', function () {\n          return _this3.copyComponent(component);\n        });\n      }\n\n      if (component.refs.pasteComponent) {\n        var pasteToolTip = this.attachTooltip(component.refs.pasteComponent, this.t('Paste below'));\n        component.addEventListener(component.refs.pasteComponent, 'click', function () {\n          pasteToolTip.hide();\n\n          _this3.pasteComponent(component);\n        });\n      }\n\n      if (component.refs.moveComponent) {\n        this.attachTooltip(component.refs.moveComponent, this.t('Move'));\n      }\n\n      var parent = this.getParentElement(element);\n\n      if (component.refs.editComponent) {\n        this.attachTooltip(component.refs.editComponent, this.t('Edit'));\n        component.addEventListener(component.refs.editComponent, 'click', function () {\n          return _this3.editComponent(component.schema, parent, false, false, component.component, {\n            inDataGrid: component.isInDataGrid\n          });\n        });\n      }\n\n      if (component.refs.editJson) {\n        this.attachTooltip(component.refs.editJson, this.t('Edit JSON'));\n        component.addEventListener(component.refs.editJson, 'click', function () {\n          return _this3.editComponent(component.schema, parent, false, true, component.component);\n        });\n      }\n\n      if (component.refs.removeComponent) {\n        this.attachTooltip(component.refs.removeComponent, this.t('Remove'));\n        component.addEventListener(component.refs.removeComponent, 'click', function () {\n          return _this3.removeComponent(component.schema, parent, component.component);\n        });\n      }\n\n      return element;\n    }\n  }, {\n    key: \"createForm\",\n    value: function createForm(options) {\n      this.webform = new _Webform.default(this.element, options);\n\n      if (this.element) {\n        this.loadRefs(this.element, {\n          form: 'single'\n        });\n\n        if (this.refs.form) {\n          this.webform.element = this.refs.form;\n        }\n      }\n\n      return this.webform;\n    }\n    /**\n     * Called when everything is ready.\n     *\n     * @returns {Promise} - Wait for webform to be ready.\n     */\n\n  }, {\n    key: \"ready\",\n    get: function get() {\n      return this.webform.ready;\n    }\n  }, {\n    key: \"defaultGroups\",\n    get: function get() {\n      return {\n        basic: {\n          title: 'Basic',\n          weight: 0,\n          default: true\n        },\n        advanced: {\n          title: 'Advanced',\n          weight: 10\n        },\n        layout: {\n          title: 'Layout',\n          weight: 20\n        },\n        data: {\n          title: 'Data',\n          weight: 30\n        },\n        premium: {\n          title: 'Premium',\n          weight: 40\n        }\n      };\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      return _Webform.default.prototype.redraw.call(this);\n    }\n  }, {\n    key: \"form\",\n    get: function get() {\n      return this.webform.form;\n    },\n    set: function set(value) {\n      this.setForm(value);\n    }\n  }, {\n    key: \"schema\",\n    get: function get() {\n      return this.webform.schema;\n    }\n  }, {\n    key: \"container\",\n    get: function get() {\n      return this.webform.form.components;\n    }\n    /**\n     * When a component sets its api key, we need to check if it is unique within its namespace. Find the namespace root\n     * so we can calculate this correctly.\n     * @param component\n     */\n\n  }, {\n    key: \"findNamespaceRoot\",\n    value: function findNamespaceRoot(component) {\n      var path = (0, _utils.getArrayFromComponentPath)(component.path); // First get the component with nested parents.\n\n      var comp = this.webform.getComponent(path);\n      comp = Array.isArray(comp) ? comp[0] : comp;\n      var namespaceKey = this.recurseNamespace(comp); // If there is no key, it is the root form.\n\n      if (!namespaceKey || this.form.key === namespaceKey) {\n        return this.form.components;\n      }\n\n      var componentSchema = component.component; // If the current component is the namespace, we don't need to find it again.\n\n      if (namespaceKey === component.key) {\n        return [].concat(_toConsumableArray(componentSchema.components), [componentSchema]);\n      } // Get the namespace component so we have the original object.\n\n\n      var namespaceComponent = (0, _formUtils.getComponent)(this.form.components, namespaceKey, true);\n      return namespaceComponent.components;\n    }\n  }, {\n    key: \"recurseNamespace\",\n    value: function recurseNamespace(component) {\n      // If there is no parent, we are at the root level.\n      if (!component) {\n        return null;\n      } // Some components are their own namespace.\n\n\n      if (['address', 'container', 'datagrid', 'editgrid', 'dynamicWizard', 'tree'].includes(component.type) || component.tree || component.arrayTree) {\n        return component.key;\n      } // Anything else, keep going up.\n\n\n      return this.recurseNamespace(component.parent);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return this.renderTemplate('builder', {\n        sidebar: this.renderTemplate('builderSidebar', {\n          scrollEnabled: this.sideBarScroll,\n          groupOrder: this.groupOrder,\n          groupId: \"builder-sidebar-\".concat(this.id),\n          groups: this.groupOrder.map(function (groupKey) {\n            return _this4.renderTemplate('builderSidebarGroup', {\n              group: _this4.groups[groupKey],\n              groupKey: groupKey,\n              groupId: \"builder-sidebar-\".concat(_this4.id),\n              subgroups: _this4.groups[groupKey].subgroups.map(function (group) {\n                return _this4.renderTemplate('builderSidebarGroup', {\n                  group: group,\n                  groupKey: group.key,\n                  groupId: \"group-container-\".concat(groupKey),\n                  subgroups: []\n                });\n              })\n            });\n          })\n        }),\n        form: this.webform.render()\n      });\n    }\n  }, {\n    key: \"attach\",\n    value: function attach(element) {\n      var _this5 = this;\n\n      this.on('change', function (form) {\n        _this5.populateRecaptchaSettings(form);\n      });\n      return _get(_getPrototypeOf(WebformBuilder.prototype), \"attach\", this).call(this, element).then(function () {\n        _this5.loadRefs(element, {\n          form: 'single',\n          sidebar: 'single',\n          'sidebar-search': 'single',\n          'sidebar-groups': 'single',\n          'container': 'multiple',\n          'sidebar-anchor': 'multiple',\n          'sidebar-group': 'multiple',\n          'sidebar-container': 'multiple'\n        });\n\n        if (_this5.sideBarScroll && _Templates.default.current.handleBuilderSidebarScroll) {\n          _Templates.default.current.handleBuilderSidebarScroll.call(_this5, _this5);\n        } // Add the paste status in form\n\n\n        if (typeof window !== 'undefined' && window.sessionStorage) {\n          var data = window.sessionStorage.getItem('formio.clipboard');\n\n          if (data) {\n            _this5.addClass(_this5.refs.form, 'builder-paste-mode');\n          }\n        }\n\n        if (!(0, _utils.bootstrapVersion)(_this5.options)) {\n          // Initialize\n          _this5.refs['sidebar-group'].forEach(function (group) {\n            group.style.display = group.getAttribute('data-default') === 'true' ? 'inherit' : 'none';\n          }); // Click event\n\n\n          _this5.refs['sidebar-anchor'].forEach(function (anchor, index) {\n            _this5.addEventListener(anchor, 'click', function () {\n              var clickedParentId = anchor.getAttribute('data-parent').slice('#builder-sidebar-'.length);\n              var clickedId = anchor.getAttribute('data-target').slice('#group-'.length);\n\n              _this5.refs['sidebar-group'].forEach(function (group, groupIndex) {\n                var openByDefault = group.getAttribute('data-default') === 'true';\n                var groupId = group.getAttribute('id').slice('group-'.length);\n                var groupParent = group.getAttribute('data-parent').slice('#builder-sidebar-'.length);\n                group.style.display = openByDefault && groupParent === clickedId || groupId === clickedParentId || groupIndex === index ? 'inherit' : 'none';\n              });\n            }, true);\n          });\n        }\n\n        _this5.addEventListener(_this5.refs['sidebar-search'], 'input', _lodash.default.debounce(function (e) {\n          var searchString = e.target.value;\n\n          _this5.searchFields(searchString);\n        }, 300));\n\n        if (_this5.dragDropEnabled) {\n          _this5.initDragula();\n        }\n\n        if (_this5.refs.form) {\n          return _this5.webform.attach(_this5.refs.form);\n        }\n      });\n    }\n  }, {\n    key: \"searchFields\",\n    value: function searchFields() {\n      var _this6 = this;\n\n      var searchString = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      var searchValue = searchString.toLowerCase();\n      var sidebar = this.refs['sidebar'];\n      var sidebarGroups = this.refs['sidebar-groups'];\n\n      if (!sidebar || !sidebarGroups) {\n        return;\n      }\n\n      var filterGroupBy = function filterGroupBy(group) {\n        var searchValue = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n        var result = _lodash.default.toPlainObject(group);\n\n        var _result$subgroups = result.subgroups,\n            subgroups = _result$subgroups === void 0 ? [] : _result$subgroups,\n            components = result.components;\n        var filteredComponents = [];\n\n        for (var key in components) {\n          var isMatchedToTitle = components[key].title.toLowerCase().match(searchValue);\n          var isMatchedToKey = components[key].key.toLowerCase().match(searchValue);\n\n          if (isMatchedToTitle || isMatchedToKey) {\n            filteredComponents.push(components[key]);\n          }\n        }\n\n        _this6.orderComponents(result, filteredComponents);\n\n        if (searchValue) {\n          result.default = true;\n        }\n\n        if (result.componentOrder.length || subgroups.length) {\n          return result;\n        }\n\n        return null;\n      };\n\n      var filterGroupOrder = function filterGroupOrder(groupOrder, searchValue) {\n        var result = _lodash.default.cloneDeep(groupOrder);\n\n        return result.filter(function (key) {\n          return filterGroupBy(_this6.groups[key], searchValue);\n        });\n      };\n\n      var filterSubgroups = function filterSubgroups(groups, searchValue) {\n        var result = _lodash.default.clone(groups);\n\n        return result.map(function (subgroup) {\n          return filterGroupBy(subgroup, searchValue);\n        }).filter(function (subgroup) {\n          return !_lodash.default.isNull(subgroup);\n        });\n      };\n\n      var toTemplate = function toTemplate(groupKey) {\n        return {\n          group: filterGroupBy(_this6.groups[groupKey], searchValue),\n          groupKey: groupKey,\n          groupId: sidebar.id || sidebarGroups.id,\n          subgroups: filterSubgroups(_this6.groups[groupKey].subgroups, searchValue).map(function (group) {\n            return _this6.renderTemplate('builderSidebarGroup', {\n              group: group,\n              groupKey: group.key,\n              groupId: \"group-container-\".concat(groupKey),\n              subgroups: []\n            });\n          })\n        };\n      };\n\n      sidebarGroups.innerHTML = filterGroupOrder(this.groupOrder, searchValue).map(function (groupKey) {\n        return _this6.renderTemplate('builderSidebarGroup', toTemplate(groupKey));\n      }).join('');\n      this.loadRefs(this.element, {\n        'sidebar-groups': 'single',\n        'sidebar-anchor': 'multiple',\n        'sidebar-group': 'multiple',\n        'sidebar-container': 'multiple'\n      });\n      this.updateDragAndDrop();\n    }\n  }, {\n    key: \"orderComponents\",\n    value: function orderComponents(groupInfo, foundComponents) {\n      var components = foundComponents || groupInfo.components;\n\n      if (components) {\n        groupInfo.componentOrder = Object.keys(components).map(function (key) {\n          return components[key];\n        }).filter(function (component) {\n          return component && !component.ignore && !component.ignoreForForm;\n        }).sort(function (a, b) {\n          return a.weight - b.weight;\n        }).map(function (component) {\n          return component.key;\n        });\n      }\n    }\n  }, {\n    key: \"updateDragAndDrop\",\n    value: function updateDragAndDrop() {\n      if (this.dragDropEnabled) {\n        this.initDragula();\n      }\n\n      if (this.refs.form) {\n        return this.webform.attach(this.refs.form);\n      }\n    }\n  }, {\n    key: \"initDragula\",\n    value: function initDragula() {\n      var _this7 = this;\n\n      var options = this.options;\n\n      if (this.dragula) {\n        this.dragula.destroy();\n      }\n\n      var containersArray = Array.prototype.slice.call(this.refs['sidebar-container']).filter(function (item) {\n        return item.id !== 'group-container-resource';\n      });\n\n      if (!dragula) {\n        return;\n      }\n\n      this.dragula = dragula(containersArray, {\n        moves: function moves(el) {\n          var moves = true;\n          var list = Array.from(el.classList).filter(function (item) {\n            return item.indexOf('formio-component-') === 0;\n          });\n          list.forEach(function (item) {\n            var key = item.slice('formio-component-'.length);\n\n            if (options.disabled && options.disabled.includes(key)) {\n              moves = false;\n            }\n          });\n\n          if (el.classList.contains('no-drag')) {\n            moves = false;\n          }\n\n          return moves;\n        },\n        copy: function copy(el) {\n          return el.classList.contains('drag-copy');\n        },\n        accepts: function accepts(el, target) {\n          return !el.contains(target) && !target.classList.contains('no-drop');\n        }\n      }).on('drop', function (element, target, source, sibling) {\n        return _this7.onDrop(element, target, source, sibling);\n      });\n    }\n  }, {\n    key: \"detach\",\n    value: function detach() {\n      if (this.dragula) {\n        this.dragula.destroy();\n      }\n\n      this.dragula = null;\n\n      if (this.sideBarScroll && _Templates.default.current.clearBuilderSidebarScroll) {\n        _Templates.default.current.clearBuilderSidebarScroll.call(this, this);\n      }\n\n      _get(_getPrototypeOf(WebformBuilder.prototype), \"detach\", this).call(this);\n    }\n  }, {\n    key: \"getComponentInfo\",\n    value: function getComponentInfo(key, group) {\n      var info; // This is a new component\n\n      if (this.schemas.hasOwnProperty(key)) {\n        info = (0, _utils.fastCloneDeep)(this.schemas[key]);\n      } else if (this.groups.hasOwnProperty(group)) {\n        var groupComponents = this.groups[group].components;\n\n        if (groupComponents.hasOwnProperty(key)) {\n          info = (0, _utils.fastCloneDeep)(groupComponents[key].schema);\n        }\n      } else if (group.slice(0, group.indexOf('-')) === 'resource') {\n        // This is an existing resource field.\n        var resourceGroups = this.groups.resource.subgroups;\n\n        var resourceGroup = _lodash.default.find(resourceGroups, {\n          key: group\n        });\n\n        if (resourceGroup && resourceGroup.components.hasOwnProperty(key)) {\n          info = (0, _utils.fastCloneDeep)(resourceGroup.components[key].schema);\n        }\n      } else if (group === 'searchFields') {\n        //Search components go into this group\n        var _resourceGroups = this.groups.resource.subgroups;\n\n        for (var ix = 0; ix < _resourceGroups.length; ix++) {\n          var _resourceGroup = _resourceGroups[ix];\n\n          if (_resourceGroup.components.hasOwnProperty(key)) {\n            info = (0, _utils.fastCloneDeep)(_resourceGroup.components[key].schema);\n            break;\n          }\n        }\n      }\n\n      if (info) {\n        if (!info.key) {\n          info.key = _lodash.default.camelCase(info.key || info.title || info.label || info.placeholder || info.type);\n        }\n      }\n\n      return info;\n    }\n  }, {\n    key: \"getComponentsPath\",\n    value: function getComponentsPath(component, parent) {\n      // Get path to the component in the parent component.\n      var path = 'components';\n      var columnIndex = 0;\n      var tableRowIndex = 0;\n      var tableColumnIndex = 0;\n      var tabIndex = 0;\n\n      switch (parent.type) {\n        case 'table':\n          tableRowIndex = _lodash.default.findIndex(parent.rows, function (row) {\n            return row.some(function (column) {\n              return column.components.some(function (comp) {\n                return comp.key === component.key;\n              });\n            });\n          });\n          tableColumnIndex = _lodash.default.findIndex(parent.rows[tableRowIndex], function (column) {\n            return column.components.some(function (comp) {\n              return comp.key === component.key;\n            });\n          });\n          path = \"rows[\".concat(tableRowIndex, \"][\").concat(tableColumnIndex, \"].components\");\n          break;\n\n        case 'columns':\n          columnIndex = _lodash.default.findIndex(parent.columns, function (column) {\n            return column.components.some(function (comp) {\n              return comp.key === component.key;\n            });\n          });\n          path = \"columns[\".concat(columnIndex, \"].components\");\n          break;\n\n        case 'tabs':\n          tabIndex = _lodash.default.findIndex(parent.components, function (tab) {\n            return tab.components.some(function (comp) {\n              return comp.key === component.key;\n            });\n          });\n          path = \"components[\".concat(tabIndex, \"].components\");\n          break;\n      }\n\n      return path;\n    }\n    /* eslint-disable max-statements */\n\n  }, {\n    key: \"onDrop\",\n    value: function onDrop(element, target, source, sibling) {\n      var _this$groups$group,\n          _this8 = this;\n\n      if (!target) {\n        return;\n      } // If you try to drop within itself.\n\n\n      if (element.contains(target)) {\n        return;\n      }\n\n      var key = element.getAttribute('data-key');\n      var type = element.getAttribute('data-type');\n      var group = element.getAttribute('data-group');\n      var info, isNew, path, index;\n\n      if (key) {\n        // This is a new component.\n        info = this.getComponentInfo(key, group);\n\n        if (!info && type) {\n          info = this.getComponentInfo(type, group);\n        }\n\n        isNew = true;\n      } else if (source.formioContainer) {\n        index = _lodash.default.findIndex(source.formioContainer, {\n          key: element.formioComponent.component.key\n        });\n\n        if (index !== -1) {\n          // Grab and remove the component from the source container.\n          info = source.formioContainer.splice(_lodash.default.findIndex(source.formioContainer, {\n            key: element.formioComponent.component.key\n          }), 1); // Since splice returns an array of one object, we need to destructure it.\n\n          info = info[0];\n        }\n      } // If we haven't found the component, stop.\n\n\n      if (!info) {\n        return;\n      } // Show an error if siblings are disabled for a component and such a component already exists.\n\n\n      var draggableComponent = ((_this$groups$group = this.groups[group]) === null || _this$groups$group === void 0 ? void 0 : _this$groups$group.components[key]) || {};\n\n      if (draggableComponent.disableSiblings) {\n        var isCompAlreadyExists = false;\n        (0, _formUtils.eachComponent)(this.webform.components, function (component) {\n          if (component.key === draggableComponent.key) {\n            isCompAlreadyExists = true;\n            return;\n          }\n        }, true);\n\n        if (isCompAlreadyExists) {\n          this.webform.redraw();\n          this.webform.setAlert('danger', \"You cannot add more than one \".concat(draggableComponent.key, \" component to one page.\"));\n          return;\n        }\n      }\n\n      if (target !== source) {\n        // Ensure the key remains unique in its new container.\n        _builder.default.uniquify(this.findNamespaceRoot(target.formioComponent), info);\n      }\n\n      var parent = target.formioComponent; // Insert in the new container.\n\n      if (target.formioContainer) {\n        if (sibling) {\n          if (!sibling.getAttribute('data-noattach')) {\n            index = _lodash.default.findIndex(target.formioContainer, {\n              key: _lodash.default.get(sibling, 'formioComponent.component.key')\n            });\n            index = index === -1 ? 0 : index;\n          } else {\n            index = sibling.getAttribute('data-position');\n          }\n\n          if (index !== -1) {\n            target.formioContainer.splice(index, 0, info);\n          }\n        } else {\n          target.formioContainer.push(info);\n        }\n\n        path = this.getComponentsPath(info, parent.component);\n        index = _lodash.default.findIndex(_lodash.default.get(parent.schema, path), {\n          key: info.key\n        });\n\n        if (index === -1) {\n          index = 0;\n        }\n      }\n\n      if (parent && parent.addChildComponent) {\n        parent.addChildComponent(info, element, target, source, sibling);\n      }\n\n      var componentInDataGrid = parent.type === 'datagrid';\n\n      if (isNew && !this.options.noNewEdit && !info.noNewEdit) {\n        this.editComponent(info, target, isNew, null, null, {\n          inDataGrid: componentInDataGrid\n        });\n      } // Only rebuild the parts needing to be rebuilt.\n\n\n      var rebuild;\n\n      if (target !== source) {\n        if (source.formioContainer && source.contains(target)) {\n          rebuild = source.formioComponent.rebuild();\n        } else if (target.contains(source)) {\n          rebuild = target.formioComponent.rebuild();\n        } else {\n          if (source.formioContainer) {\n            rebuild = source.formioComponent.rebuild();\n          }\n\n          rebuild = target.formioComponent.rebuild();\n        }\n      } else {\n        // If they are the same, only rebuild one.\n        rebuild = target.formioComponent.rebuild();\n      }\n\n      if (!rebuild) {\n        rebuild = _nativePromiseOnly.default.resolve();\n      }\n\n      return rebuild.then(function () {\n        _this8.emit('addComponent', info, parent, path, index, isNew && !_this8.options.noNewEdit && !info.noNewEdit);\n\n        if (!isNew || _this8.options.noNewEdit || info.noNewEdit) {\n          _this8.emit('change', _this8.form);\n        }\n      });\n    }\n  }, {\n    key: \"setForm\",\n    value: function setForm(form) {\n      var _this9 = this;\n\n      if (!form.components) {\n        form.components = [];\n      }\n\n      var isShowSubmitButton = !this.options.noDefaultSubmitButton && !form.components.length; // Ensure there is at least a submit button.\n\n      if (isShowSubmitButton) {\n        form.components.push({\n          type: 'button',\n          label: 'Submit',\n          key: 'submit',\n          size: 'md',\n          block: false,\n          action: 'submit',\n          disableOnInvalid: true,\n          theme: 'primary'\n        });\n      }\n\n      if (this.webform) {\n        var shouldRebuild = !this.webform.form.components || form.components.length !== this.webform.form.components.length;\n        return this.webform.setForm(form, {\n          keepAsReference: true\n        }).then(function () {\n          if (_this9.refs.form) {\n            _this9.builderHeight = _this9.refs.form.offsetHeight;\n          }\n\n          if (!shouldRebuild) {\n            return _this9.form;\n          }\n\n          return _this9.rebuild().then(function () {\n            return _this9.form;\n          });\n        });\n      }\n\n      return _nativePromiseOnly.default.resolve(form);\n    }\n  }, {\n    key: \"populateRecaptchaSettings\",\n    value: function populateRecaptchaSettings(form) {\n      //populate isEnabled for recaptcha form settings\n      var isRecaptchaEnabled = false;\n\n      if (this.form.components) {\n        (0, _formUtils.eachComponent)(form.components, function (component) {\n          if (isRecaptchaEnabled) {\n            return;\n          }\n\n          if (component.type === 'recaptcha') {\n            isRecaptchaEnabled = true;\n            return false;\n          }\n        });\n\n        if (isRecaptchaEnabled) {\n          _lodash.default.set(form, 'settings.recaptcha.isEnabled', true);\n        } else if (_lodash.default.get(form, 'settings.recaptcha.isEnabled')) {\n          _lodash.default.set(form, 'settings.recaptcha.isEnabled', false);\n        }\n      }\n    }\n  }, {\n    key: \"removeComponent\",\n    value: function removeComponent(component, parent, original) {\n      var _this10 = this;\n\n      if (!parent) {\n        return;\n      }\n\n      var remove = true;\n      var removingComponentsGroup = !component.skipRemoveConfirm && (Array.isArray(component.components) && component.components.length || Array.isArray(component.rows) && component.rows.length || Array.isArray(component.columns) && component.columns.length);\n\n      if (this.options.alwaysConfirmComponentRemoval || removingComponentsGroup) {\n        var message = removingComponentsGroup ? 'Removing this component will also remove all of its children. Are you sure you want to do this?' : 'Are you sure you want to remove this component?';\n        remove = window.confirm(this.t(message));\n      }\n\n      if (!original) {\n        original = parent.formioContainer.find(function (comp) {\n          return comp.id === component.id;\n        });\n      }\n\n      var index = parent.formioContainer ? parent.formioContainer.indexOf(original) : 0;\n\n      if (remove && index !== -1) {\n        var path = this.getComponentsPath(component, parent.formioComponent.component);\n\n        if (parent.formioContainer) {\n          parent.formioContainer.splice(index, 1);\n        } else if (parent.formioComponent && parent.formioComponent.removeChildComponent) {\n          parent.formioComponent.removeChildComponent(component);\n        }\n\n        var rebuild = parent.formioComponent.rebuild() || _nativePromiseOnly.default.resolve();\n\n        rebuild.then(function () {\n          _this10.emit('removeComponent', component, parent.formioComponent.schema, path, index);\n\n          _this10.emit('change', _this10.form);\n        });\n      }\n\n      return remove;\n    }\n  }, {\n    key: \"updateComponent\",\n    value: function updateComponent(component, changed) {\n      // Update the preview.\n      if (this.preview) {\n        this.preview.form = {\n          components: [_lodash.default.omit(_objectSpread({}, component), ['hidden', 'conditional', 'calculateValue', 'logic', 'autofocus', 'customConditional'])],\n          config: this.options.formConfig || {}\n        };\n        var previewElement = this.componentEdit.querySelector('[ref=\"preview\"]');\n\n        if (previewElement) {\n          this.setContent(previewElement, this.preview.render());\n          this.preview.attach(previewElement);\n        }\n      } // Change the \"default value\" field to be reflective of this component.\n\n\n      var defaultValueComponent = (0, _formUtils.getComponent)(this.editForm.components, 'defaultValue', true);\n\n      if (defaultValueComponent && component.type !== 'hidden') {\n        var defaultChanged = changed && (changed.component && changed.component.key === 'defaultValue' || changed.instance && defaultValueComponent.hasComponent && defaultValueComponent.hasComponent(changed.instance));\n\n        if (!defaultChanged) {\n          _lodash.default.assign(defaultValueComponent.component, _lodash.default.omit(_objectSpread({}, component), ['key', 'label', 'placeholder', 'tooltip', 'hidden', 'autofocus', 'validate', 'disabled', 'defaultValue', 'customDefaultValue', 'calculateValue', 'conditional', 'customConditional', 'id']));\n\n          var parentComponent = defaultValueComponent.parent;\n          var tabIndex = -1;\n          var index = -1;\n          parentComponent.tabs.some(function (tab, tIndex) {\n            tab.some(function (comp, compIndex) {\n              if (comp.id === defaultValueComponent.id) {\n                tabIndex = tIndex;\n                index = compIndex;\n                return true;\n              }\n\n              return false;\n            });\n          });\n\n          if (tabIndex !== -1 && index !== -1) {\n            var sibling = parentComponent.tabs[tabIndex][index + 1];\n            parentComponent.removeComponent(defaultValueComponent);\n            var newComp = parentComponent.addComponent(defaultValueComponent.component, defaultValueComponent.data, sibling);\n\n            _lodash.default.pull(newComp.validators, 'required');\n\n            parentComponent.tabs[tabIndex].splice(index, 1, newComp);\n\n            newComp.checkValidity = function () {\n              return true;\n            };\n\n            newComp.build(defaultValueComponent.element);\n          }\n        } else {\n          this.preview._data[changed.instance._data.key] = changed.value;\n          this.webform._data[changed.instance._data.key] = changed.value;\n        }\n      } // Called when we update a component.\n\n\n      this.emit('updateComponent', component);\n    }\n  }, {\n    key: \"findRepeatablePaths\",\n    value: function findRepeatablePaths() {\n      var repeatablePaths = [];\n      var keys = new Map();\n      (0, _formUtils.eachComponent)(this.form.components, function (comp, path) {\n        if (!comp.key) {\n          return;\n        }\n\n        if (keys.has(comp.key)) {\n          if (keys.get(comp.key).includes(path)) {\n            repeatablePaths.push(path);\n          } else {\n            keys.set(comp.key, [].concat(_toConsumableArray(keys.get(comp.key)), [path]));\n          }\n        } else {\n          keys.set(comp.key, [path]);\n        }\n      });\n      return repeatablePaths;\n    }\n  }, {\n    key: \"highlightInvalidComponents\",\n    value: function highlightInvalidComponents() {\n      var repeatablePaths = this.findRepeatablePaths();\n      var hasInvalidComponents = false;\n      this.webform.everyComponent(function (comp) {\n        var _comp$error, _comp$error$message;\n\n        var path = comp.path;\n\n        if (repeatablePaths.includes(path)) {\n          comp.setCustomValidity(\"API Key is not unique: \".concat(comp.key));\n          hasInvalidComponents = true;\n        } else if ((_comp$error = comp.error) !== null && _comp$error !== void 0 && (_comp$error$message = _comp$error.message) !== null && _comp$error$message !== void 0 && _comp$error$message.startsWith('API Key is not unique')) {\n          comp.setCustomValidity('');\n        }\n      });\n      this.emit('builderFormValidityChange', hasInvalidComponents);\n    }\n    /**\n     * Called when a new component is saved.\n     *\n     * @param parent\n     * @param component\n     * @return {boolean}\n     */\n\n  }, {\n    key: \"saveComponent\",\n    value: function saveComponent(component, parent, isNew, original) {\n      var _this11 = this;\n\n      this.editForm.detach();\n      var parentContainer = parent ? parent.formioContainer : this.container;\n      var parentComponent = parent ? parent.formioComponent : this;\n      this.dialog.close();\n      var path = parentContainer ? this.getComponentsPath(component, parentComponent.component) : '';\n\n      if (!original) {\n        original = parent.formioContainer.find(function (comp) {\n          return comp.id === component.id;\n        });\n      }\n\n      var index = parentContainer ? parentContainer.indexOf(original) : 0;\n\n      if (index !== -1) {\n        var submissionData = this.editForm.submission.data;\n        submissionData = submissionData.componentJson || submissionData;\n        var comp = null;\n        parentComponent.getComponents().forEach(function (component) {\n          if (component.component.key === original.key) {\n            comp = component;\n          }\n        });\n        var originalComp = comp.component;\n        var originalComponentSchema = comp.schema;\n        var isParentSaveChildMethod = this.isParentSaveChildMethod(parent.formioComponent);\n\n        if (parentContainer && !isParentSaveChildMethod) {\n          parentContainer[index] = submissionData;\n\n          if (comp) {\n            comp.component = submissionData;\n          }\n        } else if (isParentSaveChildMethod) {\n          parent.formioComponent.saveChildComponent(submissionData);\n        }\n\n        var rebuild = parentComponent.rebuild() || _nativePromiseOnly.default.resolve();\n\n        return rebuild.then(function () {\n          var schema = parentContainer ? parentContainer[index] : comp ? comp.schema : [];\n\n          _this11.emitSaveComponentEvent(schema, originalComp, parentComponent.schema, path, index, isNew, originalComponentSchema);\n\n          _this11.emit('change', _this11.form);\n\n          _this11.highlightInvalidComponents();\n        });\n      }\n\n      this.highlightInvalidComponents();\n      return _nativePromiseOnly.default.resolve();\n    }\n  }, {\n    key: \"emitSaveComponentEvent\",\n    value: function emitSaveComponentEvent(schema, originalComp, parentComponentSchema, path, index, isNew, originalComponentSchema) {\n      this.emit('saveComponent', schema, originalComp, parentComponentSchema, path, index, isNew, originalComponentSchema);\n    }\n  }, {\n    key: \"editComponent\",\n    value: function editComponent(component, parent, isNew, isJsonEdit, original) {\n      var _this12 = this;\n\n      var flags = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n\n      if (!component.key) {\n        return;\n      }\n\n      var saved = false;\n      var componentCopy = (0, _utils.fastCloneDeep)(component);\n      var ComponentClass = _Components.default.components[componentCopy.type];\n      var isCustom = ComponentClass === undefined;\n      isJsonEdit = isJsonEdit || isCustom;\n      ComponentClass = isCustom ? _Components.default.components.unknown : ComponentClass; // Make sure we only have one dialog open at a time.\n\n      if (this.dialog) {\n        this.dialog.close();\n        this.highlightInvalidComponents();\n      } // This is the render step.\n\n\n      var editFormOptions = _lodash.default.clone(_lodash.default.get(this, 'options.editForm', {}));\n\n      if (this.editForm) {\n        this.editForm.destroy();\n      } // Allow editForm overrides per component.\n\n\n      var overrides = _lodash.default.get(this.options, \"editForm.\".concat(componentCopy.type), {}); // Pass along the form being edited.\n\n\n      editFormOptions.editForm = this.form;\n      editFormOptions.editComponent = component;\n      editFormOptions.flags = flags;\n      this.editForm = new _Webform.default(_objectSpread(_objectSpread({}, _lodash.default.omit(this.options, ['hooks', 'builder', 'events', 'attachMode', 'skipInit'])), {}, {\n        language: this.options.language\n      }, editFormOptions));\n      this.editForm.form = isJsonEdit && !isCustom ? {\n        components: [{\n          type: 'textarea',\n          as: 'json',\n          editor: 'ace',\n          weight: 10,\n          input: true,\n          key: 'componentJson',\n          label: 'Component JSON',\n          tooltip: 'Edit the JSON for this component.'\n        }, {\n          type: 'checkbox',\n          key: 'showFullSchema',\n          label: 'Full Schema'\n        }]\n      } : ComponentClass.editForm(_lodash.default.cloneDeep(overrides));\n      var instance = new ComponentClass(componentCopy);\n      this.editForm.submission = isJsonEdit ? {\n        data: {\n          componentJson: component,\n          showFullSchema: this.options.showFullJsonSchema\n        }\n      } : {\n        data: instance.component\n      };\n\n      if (this.preview) {\n        this.preview.destroy();\n      }\n\n      if (!ComponentClass.builderInfo.hasOwnProperty('preview') || ComponentClass.builderInfo.preview) {\n        this.preview = new _Webform.default(_lodash.default.omit(_objectSpread(_objectSpread({}, this.options), {}, {\n          preview: true\n        }), ['hooks', 'builder', 'events', 'attachMode', 'calculateValue']));\n      }\n\n      this.componentEdit = this.ce('div', {\n        'class': 'component-edit-container'\n      });\n      this.setContent(this.componentEdit, this.renderTemplate('builderEditForm', {\n        componentInfo: ComponentClass.builderInfo,\n        editForm: this.editForm.render(),\n        preview: this.preview ? this.preview.render() : false,\n        helplinks: this.helplinks\n      }));\n      this.dialog = this.createModal(this.componentEdit, _lodash.default.get(this.options, 'dialogAttr', {})); // This is the attach step.\n\n      this.editForm.attach(this.componentEdit.querySelector('[ref=\"editForm\"]'));\n      this.updateComponent(componentCopy);\n      this.editForm.on('change', function (event) {\n        if (event.changed) {\n          if (event.changed.component && event.changed.component.key === 'showFullSchema') {\n            var value = event.changed.value;\n            _this12.editForm.submission = {\n              data: {\n                componentJson: value ? instance.component : component,\n                showFullSchema: value\n              }\n            };\n            return;\n          } // See if this is a manually modified key. Treat custom component keys as manually modified\n\n\n          if (event.changed.component && event.changed.component.key === 'key' || isJsonEdit) {\n            componentCopy.keyModified = true;\n          }\n\n          if (event.changed.component && ['label', 'title'].includes(event.changed.component.key)) {\n            // Ensure this component has a key.\n            if (isNew) {\n              if (!event.data.keyModified) {\n                _this12.editForm.everyComponent(function (component) {\n                  if (component.key === 'key' && component.parent.component.key === 'tabs') {\n                    component.setValue(_lodash.default.camelCase(event.data.title || event.data.label || event.data.placeholder || event.data.type).replace(/^[0-9]*/, ''));\n                    return false;\n                  }\n                });\n              }\n\n              if (_this12.form) {\n                var formComponents = _this12.findNamespaceRoot(parent.formioComponent); // excluding component which key uniqueness is to be checked to prevent the comparing of the same keys\n\n\n                formComponents = formComponents.filter(function (comp) {\n                  return editFormOptions.editComponent.id !== comp.id;\n                }); // Set a unique key for this component.\n\n                _builder.default.uniquify(formComponents, event.data);\n              }\n            }\n          } // Update the component.\n\n\n          _this12.updateComponent(event.data.componentJson || event.data, event.changed);\n        }\n      });\n      this.addEventListener(this.componentEdit.querySelector('[ref=\"cancelButton\"]'), 'click', function (event) {\n        event.preventDefault();\n\n        _this12.editForm.detach();\n\n        _this12.emit('cancelComponent', component);\n\n        _this12.dialog.close();\n\n        _this12.highlightInvalidComponents();\n      });\n      this.addEventListener(this.componentEdit.querySelector('[ref=\"removeButton\"]'), 'click', function (event) {\n        event.preventDefault(); // Since we are already removing the component, don't trigger another remove.\n\n        saved = true;\n\n        _this12.editForm.detach();\n\n        _this12.removeComponent(component, parent, original);\n\n        _this12.dialog.close();\n\n        _this12.highlightInvalidComponents();\n      });\n      this.addEventListener(this.componentEdit.querySelector('[ref=\"saveButton\"]'), 'click', function (event) {\n        event.preventDefault();\n\n        if (!_this12.editForm.checkValidity(_this12.editForm.data, true, _this12.editForm.data)) {\n          _this12.editForm.setPristine(false);\n\n          _this12.editForm.showErrors();\n\n          return false;\n        }\n\n        saved = true;\n\n        _this12.saveComponent(component, parent, isNew, original);\n      });\n\n      var dialogClose = function dialogClose() {\n        _this12.editForm.destroy(true);\n\n        if (_this12.preview) {\n          _this12.preview.destroy(true);\n\n          _this12.preview = null;\n        }\n\n        if (isNew && !saved) {\n          _this12.removeComponent(component, parent, original);\n\n          _this12.highlightInvalidComponents();\n        } // Clean up.\n\n\n        _this12.removeEventListener(_this12.dialog, 'close', dialogClose);\n\n        _this12.dialog = null;\n      };\n\n      this.addEventListener(this.dialog, 'close', dialogClose); // Called when we edit a component.\n\n      this.emit('editComponent', component);\n    }\n    /**\n     * Creates copy of component schema and stores it under sessionStorage.\n     * @param {Component} component\n     * @return {*}\n     */\n\n  }, {\n    key: \"copyComponent\",\n    value: function copyComponent(component) {\n      if (!window.sessionStorage) {\n        return console.warn('Session storage is not supported in this browser.');\n      }\n\n      this.addClass(this.refs.form, 'builder-paste-mode');\n      window.sessionStorage.setItem('formio.clipboard', JSON.stringify(component.schema));\n    }\n    /**\n     * Paste copied component after the current component.\n     * @param {Component} component\n     * @return {*}\n     */\n\n  }, {\n    key: \"pasteComponent\",\n    value: function pasteComponent(component) {\n      if (!window.sessionStorage) {\n        return console.warn('Session storage is not supported in this browser.');\n      }\n\n      this.removeClass(this.refs.form, 'builder-paste-mode');\n\n      if (window.sessionStorage) {\n        var data = window.sessionStorage.getItem('formio.clipboard');\n\n        if (data) {\n          var schema = JSON.parse(data);\n          var parent = this.getParentElement(component.element);\n\n          if (parent) {\n            _builder.default.uniquify(this.findNamespaceRoot(parent.formioComponent), schema);\n\n            var path = '';\n            var index = 0;\n            var isParentSaveChildMethod = this.isParentSaveChildMethod(parent.formioComponent);\n\n            if (parent.formioContainer && !isParentSaveChildMethod) {\n              index = parent.formioContainer.indexOf(component.component);\n              path = this.getComponentsPath(schema, parent.formioComponent.component);\n              parent.formioContainer.splice(index + 1, 0, schema);\n            } else if (isParentSaveChildMethod) {\n              parent.formioComponent.saveChildComponent(schema, false);\n            }\n\n            parent.formioComponent.rebuild();\n            this.emitSaveComponentEvent(schema, schema, parent.formioComponent.component, path, index + 1, true, schema);\n          }\n\n          this.emit('change', this.form);\n        }\n      }\n    }\n  }, {\n    key: \"isParentSaveChildMethod\",\n    value: function isParentSaveChildMethod(parentComp) {\n      return !!(parentComp && parentComp.saveChildComponent);\n    }\n  }, {\n    key: \"getParentElement\",\n    value: function getParentElement(element) {\n      var container = element;\n\n      do {\n        container = container.parentNode;\n      } while (container && !container.formioComponent);\n\n      return container;\n    }\n  }, {\n    key: \"addBuilderComponentInfo\",\n    value: function addBuilderComponentInfo(component) {\n      if (!component || !component.group || !this.groups[component.group]) {\n        return;\n      }\n\n      component = _lodash.default.clone(component);\n      var groupInfo = this.groups[component.group];\n\n      if (!groupInfo.components.hasOwnProperty(component.key)) {\n        groupInfo.components[component.key] = component;\n      }\n\n      return component;\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      if (this.webform) {\n        this.webform.init();\n      }\n\n      return _get(_getPrototypeOf(WebformBuilder.prototype), \"init\", this).call(this);\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      if (this.webform.initialized) {\n        this.webform.clear();\n      }\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy(deleteFromGlobal) {\n      if (this.webform.initialized) {\n        this.webform.destroy(deleteFromGlobal);\n      }\n\n      _get(_getPrototypeOf(WebformBuilder.prototype), \"destroy\", this).call(this, deleteFromGlobal);\n    }\n  }, {\n    key: \"addBuilderGroup\",\n    value: function addBuilderGroup(name, group) {\n      if (!this.groups[name]) {\n        this.groups[name] = group;\n        this.groupOrder.push(name);\n        this.triggerRedraw();\n      } else {\n        this.updateBuilderGroup(name, group);\n      }\n    }\n  }, {\n    key: \"updateBuilderGroup\",\n    value: function updateBuilderGroup(name, group) {\n      if (this.groups[name]) {\n        this.groups[name] = group;\n        this.triggerRedraw();\n      }\n    }\n  }]);\n\n  return WebformBuilder;\n}(_Component2.default);\n\nexports.default = WebformBuilder;","map":{"version":3,"sources":["C:/Users/ShyamLakhani/Desktop/my-app/node_modules/formiojs/WebformBuilder.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","Object","defineProperty","exports","value","default","_Webform","_interopRequireDefault","require","_Component2","_tooltip","_nativePromiseOnly","_Components","_Formio","_utils","_formUtils","_builder","_lodash","_Templates","__esModule","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","o","minLen","_arrayLikeToArray","n","toString","call","slice","name","Array","from","test","iter","isArray","len","length","i","arr2","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","arguments","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","configurable","writable","_classCallCheck","instance","Constructor","_defineProperties","props","descriptor","_createClass","protoProps","staticProps","_get","property","receiver","Reflect","get","base","_superPropBase","desc","hasOwnProperty","_getPrototypeOf","_inherits","subClass","superClass","create","_setPrototypeOf","p","setPrototypeOf","__proto__","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","construct","_possibleConstructorReturn","self","_assertThisInitialized","ReferenceError","sham","Proxy","Boolean","valueOf","e","getPrototypeOf","dragula","window","WebformBuilder","_Component","_super","_this","element","options","HTMLElement","skipInit","builderHeight","schemas","repeatablePaths","sideBarScroll","sideBarScrollOffset","dragDropEnabled","builder","defaultsDeep","defaultGroups","each","config","groups","groupOrder","_loop","group","components","componentOrder","subgroups","map","groupKey","ignore","sort","a","b","weight","type","component","builderInfo","schema","addBuilderComponentInfo","_group","info","comp","orderComponents","hooks","renderComponent","html","_ref","_self$component","replace","disabled","includes","parent","noDragDrop","renderTemplate","disableBuilderActions","childComponent","renderComponents","_ref2","nodrop","position","renderInput","_ref3","renderLoading","_ref4","attachComponents","container","containerElement","querySelector","concat","formioContainer","formioComponent","allowDrop","containers","children","attachDatagrid","loadRefs","dataGridContainer","refs","parentNode","attachComponent","bind","query","params","limit","select","resourceTag","tags","formio","projectUrl","isResourcesDisabled","resource","loadProject","then","project","formConfig","noProject","resourceOptions","loadForms","resources","title","addExistingResourceFields","attachMode","webform","createForm","_this2","index","resourceKey","subgroup","eachComponent","resourceFilter","indexOf","componentName","label","upperFirst","merge","fastCloneDeep","lockKey","noSource","_id","undefined","isNew","triggerRedraw","attachTooltip","trigger","placement","_this3","removeComponent","editComponent","moveComponent","copyComponent","pasteComponent","editJson","t","addEventListener","pasteToolTip","hide","getParentElement","inDataGrid","isInDataGrid","form","ready","basic","advanced","layout","data","premium","redraw","set","setForm","findNamespaceRoot","path","getArrayFromComponentPath","getComponent","namespaceKey","recurseNamespace","componentSchema","namespaceComponent","tree","arrayTree","render","_this4","sidebar","scrollEnabled","groupId","id","attach","_this5","on","populateRecaptchaSettings","current","handleBuilderSidebarScroll","sessionStorage","getItem","addClass","bootstrapVersion","style","display","getAttribute","anchor","clickedParentId","clickedId","groupIndex","openByDefault","groupParent","debounce","searchString","searchFields","initDragula","_this6","searchValue","toLowerCase","sidebarGroups","filterGroupBy","toPlainObject","_result$subgroups","filteredComponents","isMatchedToTitle","match","isMatchedToKey","filterGroupOrder","cloneDeep","filterSubgroups","clone","isNull","toTemplate","innerHTML","join","updateDragAndDrop","groupInfo","foundComponents","ignoreForForm","_this7","destroy","containersArray","item","moves","el","list","classList","contains","copy","accepts","sibling","onDrop","detach","clearBuilderSidebarScroll","getComponentInfo","groupComponents","resourceGroups","resourceGroup","find","_resourceGroups","ix","_resourceGroup","camelCase","placeholder","getComponentsPath","columnIndex","tableRowIndex","tableColumnIndex","tabIndex","findIndex","rows","row","some","column","columns","tab","_this$groups$group","_this8","splice","draggableComponent","disableSiblings","isCompAlreadyExists","setAlert","uniquify","addChildComponent","componentInDataGrid","noNewEdit","rebuild","resolve","emit","_this9","isShowSubmitButton","noDefaultSubmitButton","size","block","action","disableOnInvalid","theme","shouldRebuild","keepAsReference","offsetHeight","isRecaptchaEnabled","original","_this10","remove","removingComponentsGroup","skipRemoveConfirm","alwaysConfirmComponentRemoval","message","confirm","removeChildComponent","updateComponent","changed","preview","omit","previewElement","componentEdit","setContent","defaultValueComponent","editForm","defaultChanged","hasComponent","assign","parentComponent","tabs","tIndex","compIndex","newComp","addComponent","pull","validators","checkValidity","build","_data","findRepeatablePaths","Map","has","highlightInvalidComponents","hasInvalidComponents","everyComponent","_comp$error","_comp$error$message","setCustomValidity","error","startsWith","saveComponent","_this11","parentContainer","dialog","close","submissionData","submission","componentJson","getComponents","originalComp","originalComponentSchema","isParentSaveChildMethod","saveChildComponent","emitSaveComponentEvent","parentComponentSchema","isJsonEdit","_this12","flags","saved","componentCopy","ComponentClass","isCustom","unknown","editFormOptions","overrides","language","as","editor","input","tooltip","showFullSchema","showFullJsonSchema","ce","componentInfo","helplinks","createModal","event","keyModified","setValue","formComponents","preventDefault","setPristine","showErrors","dialogClose","removeEventListener","console","warn","setItem","JSON","stringify","removeClass","parse","parentComp","init","clear","initialized","deleteFromGlobal","addBuilderGroup","updateBuilderGroup"],"mappings":"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","sourcesContent":["\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nrequire(\"core-js/modules/es.reflect.construct.js\");\n\nrequire(\"core-js/modules/es.reflect.get.js\");\n\nrequire(\"core-js/modules/es.object.get-own-property-descriptor.js\");\n\nrequire(\"core-js/modules/es.symbol.js\");\n\nrequire(\"core-js/modules/es.object.get-own-property-descriptors.js\");\n\nrequire(\"core-js/modules/es.symbol.description.js\");\n\nrequire(\"core-js/modules/es.symbol.iterator.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es.array.map.js\");\n\nrequire(\"core-js/modules/es.array.sort.js\");\n\nrequire(\"core-js/modules/es.array.filter.js\");\n\nrequire(\"core-js/modules/es.regexp.exec.js\");\n\nrequire(\"core-js/modules/es.string.replace.js\");\n\nrequire(\"core-js/modules/es.array.includes.js\");\n\nrequire(\"core-js/modules/es.string.includes.js\");\n\nrequire(\"core-js/modules/es.function.name.js\");\n\nrequire(\"core-js/modules/es.object.keys.js\");\n\nrequire(\"core-js/modules/es.array.concat.js\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\n\nrequire(\"core-js/modules/es.array.slice.js\");\n\nrequire(\"core-js/modules/es.string.match.js\");\n\nrequire(\"core-js/modules/es.array.join.js\");\n\nrequire(\"core-js/modules/es.array.from.js\");\n\nrequire(\"core-js/modules/es.string.iterator.js\");\n\nrequire(\"core-js/modules/es.array.find.js\");\n\nrequire(\"core-js/modules/es.array.find-index.js\");\n\nrequire(\"core-js/modules/es.array.splice.js\");\n\nrequire(\"core-js/modules/es.array.iterator.js\");\n\nrequire(\"core-js/modules/es.map.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator.js\");\n\nrequire(\"core-js/modules/es.string.starts-with.js\");\n\nrequire(\"core-js/modules/es.regexp.flags.js\");\n\nrequire(\"core-js/modules/es.object.get-prototype-of.js\");\n\nvar _Webform = _interopRequireDefault(require(\"./Webform\"));\n\nvar _Component2 = _interopRequireDefault(require(\"./components/_classes/component/Component\"));\n\nvar _tooltip = _interopRequireDefault(require(\"tooltip.js\"));\n\nvar _nativePromiseOnly = _interopRequireDefault(require(\"native-promise-only\"));\n\nvar _Components = _interopRequireDefault(require(\"./components/Components\"));\n\nvar _Formio = _interopRequireDefault(require(\"./Formio\"));\n\nvar _utils = require(\"./utils/utils\");\n\nvar _formUtils = require(\"./utils/formUtils\");\n\nvar _builder = _interopRequireDefault(require(\"./utils/builder\"));\n\nvar _lodash = _interopRequireDefault(require(\"lodash\"));\n\nvar _Templates = _interopRequireDefault(require(\"./templates/Templates\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _get(target, property, receiver) { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get; } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(receiver); } return desc.value; }; } return _get(target, property, receiver || target); }\n\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nrequire('./components/builder');\n\nvar dragula;\n\nif (typeof window !== 'undefined') {\n  // Import from \"dist\" because it would require and \"global\" would not be defined in Angular apps.\n  dragula = require('dragula/dist/dragula');\n}\n\nvar WebformBuilder = /*#__PURE__*/function (_Component) {\n  _inherits(WebformBuilder, _Component);\n\n  var _super = _createSuper(WebformBuilder);\n\n  // eslint-disable-next-line max-statements\n  function WebformBuilder() {\n    var _this;\n\n    _classCallCheck(this, WebformBuilder);\n\n    var element, options;\n\n    if (arguments[0] instanceof HTMLElement || arguments[1]) {\n      element = arguments[0];\n      options = arguments[1];\n    } else {\n      options = arguments[0];\n    } // Reset skipInit in case PDFBuilder has set it.\n\n\n    options.skipInit = false;\n    _this = _super.call(this, null, options);\n    _this.element = element;\n    _this.builderHeight = 0;\n    _this.schemas = {};\n    _this.repeatablePaths = [];\n    _this.sideBarScroll = _lodash.default.get(_this.options, 'sideBarScroll', true);\n    _this.sideBarScrollOffset = _lodash.default.get(_this.options, 'sideBarScrollOffset', 0);\n    _this.dragDropEnabled = true; // Setup the builder options.\n\n    _this.builder = _lodash.default.defaultsDeep({}, _this.options.builder, _this.defaultGroups); // Turn off if explicitely said to do so...\n\n    _lodash.default.each(_this.defaultGroups, function (config, key) {\n      if (config === false) {\n        _this.builder[key] = false;\n      }\n    }); // Add the groups.\n\n\n    _this.groups = {};\n    _this.groupOrder = [];\n\n    var _loop = function _loop(group) {\n      if (_this.builder[group]) {\n        _this.builder[group].key = group;\n        _this.groups[group] = _this.builder[group];\n        _this.groups[group].components = _this.groups[group].components || {};\n        _this.groups[group].componentOrder = _this.groups[group].componentOrder || [];\n        _this.groups[group].subgroups = Object.keys(_this.groups[group].groups || {}).map(function (groupKey) {\n          _this.groups[group].groups[groupKey].componentOrder = Object.keys(_this.groups[group].groups[groupKey].components).map(function (key) {\n            return key;\n          });\n          return _this.groups[group].groups[groupKey];\n        });\n\n        _this.groupOrder.push(_this.groups[group]);\n      }\n    };\n\n    for (var group in _this.builder) {\n      _loop(group);\n    }\n\n    _this.groupOrder = _this.groupOrder.filter(function (group) {\n      return group && !group.ignore;\n    }).sort(function (a, b) {\n      return a.weight - b.weight;\n    }).map(function (group) {\n      return group.key;\n    });\n\n    for (var type in _Components.default.components) {\n      var component = _Components.default.components[type];\n\n      if (component.builderInfo && component.builderInfo.schema) {\n        _this.schemas[type] = component.builderInfo.schema;\n        component.type = type;\n        var builderInfo = component.builderInfo;\n        builderInfo.key = component.type;\n\n        _this.addBuilderComponentInfo(builderInfo);\n      }\n    } // Filter out any extra components.\n    // Add the components in each group.\n\n\n    for (var _group in _this.groups) {\n      var info = _this.groups[_group];\n\n      for (var key in info.components) {\n        var comp = info.components[key];\n\n        if (comp === true && _Components.default.components[key] && _Components.default.components[key].builderInfo) {\n          comp = _Components.default.components[key].builderInfo;\n        }\n\n        if (comp && comp.schema) {\n          _this.schemas[key] = comp.schema;\n          info.components[key] = comp;\n          info.components[key].key = key;\n        } else {\n          // Do not include this component in the components array.\n          delete info.components[key];\n        }\n      } // Order the components.\n\n\n      _this.orderComponents(info);\n    }\n\n    _this.options.hooks = _this.options.hooks || {};\n\n    _this.options.hooks.renderComponent = function (html, _ref) {\n      var _self$component;\n\n      var component = _ref.component,\n          self = _ref.self;\n\n      if (self.type === 'form' && !self.key) {\n        // The main webform shouldn't have this class as it adds extra styles.\n        return html.replace('formio-component-form', '');\n      }\n\n      if (_this.options.disabled && _this.options.disabled.includes(self.key) || self.parent.noDragDrop) {\n        return html;\n      }\n\n      return _this.renderTemplate('builderComponent', {\n        html: html,\n        disableBuilderActions: self === null || self === void 0 ? void 0 : (_self$component = self.component) === null || _self$component === void 0 ? void 0 : _self$component.disableBuilderActions,\n        childComponent: component\n      });\n    };\n\n    _this.options.hooks.renderComponents = function (html, _ref2) {\n      var components = _ref2.components,\n          self = _ref2.self;\n\n      // if Datagrid and already has a component, don't make it droppable.\n      if (self.type === 'datagrid' && components.length > 0 || self.noDragDrop) {\n        return html;\n      }\n\n      if (!components || !components.length && !components.nodrop || self.type === 'form' && components.length <= 1 && (components.length === 0 || components[0].type === 'button')) {\n        html = _this.renderTemplate('builderPlaceholder', {\n          position: 0\n        }) + html;\n      }\n\n      return _this.renderTemplate('builderComponents', {\n        key: self.key,\n        type: self.type,\n        html: html\n      });\n    };\n\n    _this.options.hooks.renderInput = function (html, _ref3) {\n      var self = _ref3.self;\n\n      if (self.type === 'hidden') {\n        return html + self.name;\n      }\n\n      return html;\n    };\n\n    _this.options.hooks.renderLoading = function (html, _ref4) {\n      var self = _ref4.self;\n\n      if (self.type === 'form' && self.key) {\n        return self.name;\n      }\n\n      return html;\n    };\n\n    _this.options.hooks.attachComponents = function (element, components, container, component) {\n      // Don't attach if no element was found or component doesn't participate in drag'n'drop.\n      if (!element) {\n        return;\n      }\n\n      if (component.noDragDrop) {\n        return element;\n      } // Attach container and component to element for later reference.\n\n\n      var containerElement = element.querySelector(\"[ref=\\\"\".concat(component.component.key, \"-container\\\"]\")) || element;\n      containerElement.formioContainer = container;\n      containerElement.formioComponent = component; // Add container to draggable list.\n\n      if (_this.dragula && _this.allowDrop(element)) {\n        _this.dragula.containers.push(containerElement);\n      } // If this is an existing datagrid element, don't make it draggable.\n\n\n      if ((component.type === 'datagrid' || component.type === 'datamap') && components.length > 0) {\n        return element;\n      } // Since we added a wrapper, need to return the original element so that we can find the components inside it.\n\n\n      return element.children[0];\n    };\n\n    _this.options.hooks.attachDatagrid = function (element, component) {\n      component.loadRefs(element, _defineProperty({}, \"\".concat(component.key, \"-container\"), 'single'));\n      var dataGridContainer = component.refs[\"\".concat(component.key, \"-container\")];\n\n      if (dataGridContainer) {\n        component.attachComponents(dataGridContainer.parentNode, [], component.component.components);\n      } // Need to set up horizontal rearrangement of fields.\n\n    };\n\n    _this.options.hooks.attachComponent = _this.attachComponent.bind(_assertThisInitialized(_this)); // Load resources tagged as 'builder'\n\n    var query = {\n      params: {\n        type: 'resource',\n        limit: 4294967295,\n        select: '_id,title,name,components'\n      }\n    };\n\n    if (_this.options && _this.options.resourceTag) {\n      query.params.tags = [_this.options.resourceTag];\n    } else if (!_this.options || !_this.options.hasOwnProperty('resourceTag')) {\n      query.params.tags = ['builder'];\n    }\n\n    var formio = new _Formio.default(_Formio.default.projectUrl);\n    var isResourcesDisabled = _this.options.builder && _this.options.builder.resource === false;\n    formio.loadProject().then(function (project) {\n      if (project && _lodash.default.get(project, 'settings.addConfigToForms', false)) {\n        _this.options.formConfig = project.config || {};\n      }\n    });\n\n    if (!formio.noProject && !isResourcesDisabled) {\n      var resourceOptions = _this.options.builder && _this.options.builder.resource;\n      formio.loadForms(query).then(function (resources) {\n        if (resources.length) {\n          _this.builder.resource = {\n            title: resourceOptions ? resourceOptions.title : 'Existing Resource Fields',\n            key: 'resource',\n            weight: resourceOptions ? resourceOptions.weight : 50,\n            subgroups: [],\n            components: [],\n            componentOrder: []\n          };\n          _this.groups.resource = {\n            title: resourceOptions ? resourceOptions.title : 'Existing Resource Fields',\n            key: 'resource',\n            weight: resourceOptions ? resourceOptions.weight : 50,\n            subgroups: [],\n            components: [],\n            componentOrder: []\n          };\n\n          if (!_this.groupOrder.includes('resource')) {\n            _this.groupOrder.push('resource');\n          }\n\n          _this.addExistingResourceFields(resources);\n        }\n      });\n    } // Notify components if they need to modify their render.\n\n\n    _this.options.attachMode = 'builder';\n    _this.webform = _this.webform || _this.createForm(_this.options);\n    return _this;\n  }\n\n  _createClass(WebformBuilder, [{\n    key: \"allowDrop\",\n    value: function allowDrop() {\n      return true;\n    }\n  }, {\n    key: \"addExistingResourceFields\",\n    value: function addExistingResourceFields(resources) {\n      var _this2 = this;\n\n      _lodash.default.each(resources, function (resource, index) {\n        var resourceKey = \"resource-\".concat(resource.name);\n        var subgroup = {\n          key: resourceKey,\n          title: resource.title,\n          components: [],\n          componentOrder: [],\n          default: index === 0\n        };\n        (0, _formUtils.eachComponent)(resource.components, function (component) {\n          if (component.type === 'button') return;\n          if (_this2.options && _this2.options.resourceFilter && (!component.tags || component.tags.indexOf(_this2.options.resourceFilter) === -1)) return;\n          var componentName = component.label;\n\n          if (!componentName && component.key) {\n            componentName = _lodash.default.upperFirst(component.key);\n          }\n\n          subgroup.componentOrder.push(component.key);\n          subgroup.components[component.key] = _lodash.default.merge((0, _utils.fastCloneDeep)(_Components.default.components[component.type] ? _Components.default.components[component.type].builderInfo : _Components.default.components['unknown'].builderInfo), {\n            key: component.key,\n            title: componentName,\n            group: 'resource',\n            subgroup: resourceKey\n          }, {\n            schema: _objectSpread(_objectSpread({}, component), {}, {\n              label: component.label,\n              key: component.key,\n              lockKey: true,\n              source: !_this2.options.noSource ? resource._id : undefined,\n              isNew: true\n            })\n          });\n        }, true);\n\n        _this2.groups.resource.subgroups.push(subgroup);\n      });\n\n      this.triggerRedraw();\n    }\n  }, {\n    key: \"attachTooltip\",\n    value: function attachTooltip(component, title) {\n      return new _tooltip.default(component, {\n        trigger: 'hover focus',\n        placement: 'top',\n        title: title\n      });\n    }\n  }, {\n    key: \"attachComponent\",\n    value: function attachComponent(element, component) {\n      var _this3 = this;\n\n      // Add component to element for later reference.\n      element.formioComponent = component;\n      component.loadRefs(element, {\n        removeComponent: 'single',\n        editComponent: 'single',\n        moveComponent: 'single',\n        copyComponent: 'single',\n        pasteComponent: 'single',\n        editJson: 'single'\n      });\n\n      if (component.refs.copyComponent) {\n        this.attachTooltip(component.refs.copyComponent, this.t('Copy'));\n        component.addEventListener(component.refs.copyComponent, 'click', function () {\n          return _this3.copyComponent(component);\n        });\n      }\n\n      if (component.refs.pasteComponent) {\n        var pasteToolTip = this.attachTooltip(component.refs.pasteComponent, this.t('Paste below'));\n        component.addEventListener(component.refs.pasteComponent, 'click', function () {\n          pasteToolTip.hide();\n\n          _this3.pasteComponent(component);\n        });\n      }\n\n      if (component.refs.moveComponent) {\n        this.attachTooltip(component.refs.moveComponent, this.t('Move'));\n      }\n\n      var parent = this.getParentElement(element);\n\n      if (component.refs.editComponent) {\n        this.attachTooltip(component.refs.editComponent, this.t('Edit'));\n        component.addEventListener(component.refs.editComponent, 'click', function () {\n          return _this3.editComponent(component.schema, parent, false, false, component.component, {\n            inDataGrid: component.isInDataGrid\n          });\n        });\n      }\n\n      if (component.refs.editJson) {\n        this.attachTooltip(component.refs.editJson, this.t('Edit JSON'));\n        component.addEventListener(component.refs.editJson, 'click', function () {\n          return _this3.editComponent(component.schema, parent, false, true, component.component);\n        });\n      }\n\n      if (component.refs.removeComponent) {\n        this.attachTooltip(component.refs.removeComponent, this.t('Remove'));\n        component.addEventListener(component.refs.removeComponent, 'click', function () {\n          return _this3.removeComponent(component.schema, parent, component.component);\n        });\n      }\n\n      return element;\n    }\n  }, {\n    key: \"createForm\",\n    value: function createForm(options) {\n      this.webform = new _Webform.default(this.element, options);\n\n      if (this.element) {\n        this.loadRefs(this.element, {\n          form: 'single'\n        });\n\n        if (this.refs.form) {\n          this.webform.element = this.refs.form;\n        }\n      }\n\n      return this.webform;\n    }\n    /**\n     * Called when everything is ready.\n     *\n     * @returns {Promise} - Wait for webform to be ready.\n     */\n\n  }, {\n    key: \"ready\",\n    get: function get() {\n      return this.webform.ready;\n    }\n  }, {\n    key: \"defaultGroups\",\n    get: function get() {\n      return {\n        basic: {\n          title: 'Basic',\n          weight: 0,\n          default: true\n        },\n        advanced: {\n          title: 'Advanced',\n          weight: 10\n        },\n        layout: {\n          title: 'Layout',\n          weight: 20\n        },\n        data: {\n          title: 'Data',\n          weight: 30\n        },\n        premium: {\n          title: 'Premium',\n          weight: 40\n        }\n      };\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      return _Webform.default.prototype.redraw.call(this);\n    }\n  }, {\n    key: \"form\",\n    get: function get() {\n      return this.webform.form;\n    },\n    set: function set(value) {\n      this.setForm(value);\n    }\n  }, {\n    key: \"schema\",\n    get: function get() {\n      return this.webform.schema;\n    }\n  }, {\n    key: \"container\",\n    get: function get() {\n      return this.webform.form.components;\n    }\n    /**\n     * When a component sets its api key, we need to check if it is unique within its namespace. Find the namespace root\n     * so we can calculate this correctly.\n     * @param component\n     */\n\n  }, {\n    key: \"findNamespaceRoot\",\n    value: function findNamespaceRoot(component) {\n      var path = (0, _utils.getArrayFromComponentPath)(component.path); // First get the component with nested parents.\n\n      var comp = this.webform.getComponent(path);\n      comp = Array.isArray(comp) ? comp[0] : comp;\n      var namespaceKey = this.recurseNamespace(comp); // If there is no key, it is the root form.\n\n      if (!namespaceKey || this.form.key === namespaceKey) {\n        return this.form.components;\n      }\n\n      var componentSchema = component.component; // If the current component is the namespace, we don't need to find it again.\n\n      if (namespaceKey === component.key) {\n        return [].concat(_toConsumableArray(componentSchema.components), [componentSchema]);\n      } // Get the namespace component so we have the original object.\n\n\n      var namespaceComponent = (0, _formUtils.getComponent)(this.form.components, namespaceKey, true);\n      return namespaceComponent.components;\n    }\n  }, {\n    key: \"recurseNamespace\",\n    value: function recurseNamespace(component) {\n      // If there is no parent, we are at the root level.\n      if (!component) {\n        return null;\n      } // Some components are their own namespace.\n\n\n      if (['address', 'container', 'datagrid', 'editgrid', 'dynamicWizard', 'tree'].includes(component.type) || component.tree || component.arrayTree) {\n        return component.key;\n      } // Anything else, keep going up.\n\n\n      return this.recurseNamespace(component.parent);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return this.renderTemplate('builder', {\n        sidebar: this.renderTemplate('builderSidebar', {\n          scrollEnabled: this.sideBarScroll,\n          groupOrder: this.groupOrder,\n          groupId: \"builder-sidebar-\".concat(this.id),\n          groups: this.groupOrder.map(function (groupKey) {\n            return _this4.renderTemplate('builderSidebarGroup', {\n              group: _this4.groups[groupKey],\n              groupKey: groupKey,\n              groupId: \"builder-sidebar-\".concat(_this4.id),\n              subgroups: _this4.groups[groupKey].subgroups.map(function (group) {\n                return _this4.renderTemplate('builderSidebarGroup', {\n                  group: group,\n                  groupKey: group.key,\n                  groupId: \"group-container-\".concat(groupKey),\n                  subgroups: []\n                });\n              })\n            });\n          })\n        }),\n        form: this.webform.render()\n      });\n    }\n  }, {\n    key: \"attach\",\n    value: function attach(element) {\n      var _this5 = this;\n\n      this.on('change', function (form) {\n        _this5.populateRecaptchaSettings(form);\n      });\n      return _get(_getPrototypeOf(WebformBuilder.prototype), \"attach\", this).call(this, element).then(function () {\n        _this5.loadRefs(element, {\n          form: 'single',\n          sidebar: 'single',\n          'sidebar-search': 'single',\n          'sidebar-groups': 'single',\n          'container': 'multiple',\n          'sidebar-anchor': 'multiple',\n          'sidebar-group': 'multiple',\n          'sidebar-container': 'multiple'\n        });\n\n        if (_this5.sideBarScroll && _Templates.default.current.handleBuilderSidebarScroll) {\n          _Templates.default.current.handleBuilderSidebarScroll.call(_this5, _this5);\n        } // Add the paste status in form\n\n\n        if (typeof window !== 'undefined' && window.sessionStorage) {\n          var data = window.sessionStorage.getItem('formio.clipboard');\n\n          if (data) {\n            _this5.addClass(_this5.refs.form, 'builder-paste-mode');\n          }\n        }\n\n        if (!(0, _utils.bootstrapVersion)(_this5.options)) {\n          // Initialize\n          _this5.refs['sidebar-group'].forEach(function (group) {\n            group.style.display = group.getAttribute('data-default') === 'true' ? 'inherit' : 'none';\n          }); // Click event\n\n\n          _this5.refs['sidebar-anchor'].forEach(function (anchor, index) {\n            _this5.addEventListener(anchor, 'click', function () {\n              var clickedParentId = anchor.getAttribute('data-parent').slice('#builder-sidebar-'.length);\n              var clickedId = anchor.getAttribute('data-target').slice('#group-'.length);\n\n              _this5.refs['sidebar-group'].forEach(function (group, groupIndex) {\n                var openByDefault = group.getAttribute('data-default') === 'true';\n                var groupId = group.getAttribute('id').slice('group-'.length);\n                var groupParent = group.getAttribute('data-parent').slice('#builder-sidebar-'.length);\n                group.style.display = openByDefault && groupParent === clickedId || groupId === clickedParentId || groupIndex === index ? 'inherit' : 'none';\n              });\n            }, true);\n          });\n        }\n\n        _this5.addEventListener(_this5.refs['sidebar-search'], 'input', _lodash.default.debounce(function (e) {\n          var searchString = e.target.value;\n\n          _this5.searchFields(searchString);\n        }, 300));\n\n        if (_this5.dragDropEnabled) {\n          _this5.initDragula();\n        }\n\n        if (_this5.refs.form) {\n          return _this5.webform.attach(_this5.refs.form);\n        }\n      });\n    }\n  }, {\n    key: \"searchFields\",\n    value: function searchFields() {\n      var _this6 = this;\n\n      var searchString = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n      var searchValue = searchString.toLowerCase();\n      var sidebar = this.refs['sidebar'];\n      var sidebarGroups = this.refs['sidebar-groups'];\n\n      if (!sidebar || !sidebarGroups) {\n        return;\n      }\n\n      var filterGroupBy = function filterGroupBy(group) {\n        var searchValue = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n        var result = _lodash.default.toPlainObject(group);\n\n        var _result$subgroups = result.subgroups,\n            subgroups = _result$subgroups === void 0 ? [] : _result$subgroups,\n            components = result.components;\n        var filteredComponents = [];\n\n        for (var key in components) {\n          var isMatchedToTitle = components[key].title.toLowerCase().match(searchValue);\n          var isMatchedToKey = components[key].key.toLowerCase().match(searchValue);\n\n          if (isMatchedToTitle || isMatchedToKey) {\n            filteredComponents.push(components[key]);\n          }\n        }\n\n        _this6.orderComponents(result, filteredComponents);\n\n        if (searchValue) {\n          result.default = true;\n        }\n\n        if (result.componentOrder.length || subgroups.length) {\n          return result;\n        }\n\n        return null;\n      };\n\n      var filterGroupOrder = function filterGroupOrder(groupOrder, searchValue) {\n        var result = _lodash.default.cloneDeep(groupOrder);\n\n        return result.filter(function (key) {\n          return filterGroupBy(_this6.groups[key], searchValue);\n        });\n      };\n\n      var filterSubgroups = function filterSubgroups(groups, searchValue) {\n        var result = _lodash.default.clone(groups);\n\n        return result.map(function (subgroup) {\n          return filterGroupBy(subgroup, searchValue);\n        }).filter(function (subgroup) {\n          return !_lodash.default.isNull(subgroup);\n        });\n      };\n\n      var toTemplate = function toTemplate(groupKey) {\n        return {\n          group: filterGroupBy(_this6.groups[groupKey], searchValue),\n          groupKey: groupKey,\n          groupId: sidebar.id || sidebarGroups.id,\n          subgroups: filterSubgroups(_this6.groups[groupKey].subgroups, searchValue).map(function (group) {\n            return _this6.renderTemplate('builderSidebarGroup', {\n              group: group,\n              groupKey: group.key,\n              groupId: \"group-container-\".concat(groupKey),\n              subgroups: []\n            });\n          })\n        };\n      };\n\n      sidebarGroups.innerHTML = filterGroupOrder(this.groupOrder, searchValue).map(function (groupKey) {\n        return _this6.renderTemplate('builderSidebarGroup', toTemplate(groupKey));\n      }).join('');\n      this.loadRefs(this.element, {\n        'sidebar-groups': 'single',\n        'sidebar-anchor': 'multiple',\n        'sidebar-group': 'multiple',\n        'sidebar-container': 'multiple'\n      });\n      this.updateDragAndDrop();\n    }\n  }, {\n    key: \"orderComponents\",\n    value: function orderComponents(groupInfo, foundComponents) {\n      var components = foundComponents || groupInfo.components;\n\n      if (components) {\n        groupInfo.componentOrder = Object.keys(components).map(function (key) {\n          return components[key];\n        }).filter(function (component) {\n          return component && !component.ignore && !component.ignoreForForm;\n        }).sort(function (a, b) {\n          return a.weight - b.weight;\n        }).map(function (component) {\n          return component.key;\n        });\n      }\n    }\n  }, {\n    key: \"updateDragAndDrop\",\n    value: function updateDragAndDrop() {\n      if (this.dragDropEnabled) {\n        this.initDragula();\n      }\n\n      if (this.refs.form) {\n        return this.webform.attach(this.refs.form);\n      }\n    }\n  }, {\n    key: \"initDragula\",\n    value: function initDragula() {\n      var _this7 = this;\n\n      var options = this.options;\n\n      if (this.dragula) {\n        this.dragula.destroy();\n      }\n\n      var containersArray = Array.prototype.slice.call(this.refs['sidebar-container']).filter(function (item) {\n        return item.id !== 'group-container-resource';\n      });\n\n      if (!dragula) {\n        return;\n      }\n\n      this.dragula = dragula(containersArray, {\n        moves: function moves(el) {\n          var moves = true;\n          var list = Array.from(el.classList).filter(function (item) {\n            return item.indexOf('formio-component-') === 0;\n          });\n          list.forEach(function (item) {\n            var key = item.slice('formio-component-'.length);\n\n            if (options.disabled && options.disabled.includes(key)) {\n              moves = false;\n            }\n          });\n\n          if (el.classList.contains('no-drag')) {\n            moves = false;\n          }\n\n          return moves;\n        },\n        copy: function copy(el) {\n          return el.classList.contains('drag-copy');\n        },\n        accepts: function accepts(el, target) {\n          return !el.contains(target) && !target.classList.contains('no-drop');\n        }\n      }).on('drop', function (element, target, source, sibling) {\n        return _this7.onDrop(element, target, source, sibling);\n      });\n    }\n  }, {\n    key: \"detach\",\n    value: function detach() {\n      if (this.dragula) {\n        this.dragula.destroy();\n      }\n\n      this.dragula = null;\n\n      if (this.sideBarScroll && _Templates.default.current.clearBuilderSidebarScroll) {\n        _Templates.default.current.clearBuilderSidebarScroll.call(this, this);\n      }\n\n      _get(_getPrototypeOf(WebformBuilder.prototype), \"detach\", this).call(this);\n    }\n  }, {\n    key: \"getComponentInfo\",\n    value: function getComponentInfo(key, group) {\n      var info; // This is a new component\n\n      if (this.schemas.hasOwnProperty(key)) {\n        info = (0, _utils.fastCloneDeep)(this.schemas[key]);\n      } else if (this.groups.hasOwnProperty(group)) {\n        var groupComponents = this.groups[group].components;\n\n        if (groupComponents.hasOwnProperty(key)) {\n          info = (0, _utils.fastCloneDeep)(groupComponents[key].schema);\n        }\n      } else if (group.slice(0, group.indexOf('-')) === 'resource') {\n        // This is an existing resource field.\n        var resourceGroups = this.groups.resource.subgroups;\n\n        var resourceGroup = _lodash.default.find(resourceGroups, {\n          key: group\n        });\n\n        if (resourceGroup && resourceGroup.components.hasOwnProperty(key)) {\n          info = (0, _utils.fastCloneDeep)(resourceGroup.components[key].schema);\n        }\n      } else if (group === 'searchFields') {\n        //Search components go into this group\n        var _resourceGroups = this.groups.resource.subgroups;\n\n        for (var ix = 0; ix < _resourceGroups.length; ix++) {\n          var _resourceGroup = _resourceGroups[ix];\n\n          if (_resourceGroup.components.hasOwnProperty(key)) {\n            info = (0, _utils.fastCloneDeep)(_resourceGroup.components[key].schema);\n            break;\n          }\n        }\n      }\n\n      if (info) {\n        if (!info.key) {\n          info.key = _lodash.default.camelCase(info.key || info.title || info.label || info.placeholder || info.type);\n        }\n      }\n\n      return info;\n    }\n  }, {\n    key: \"getComponentsPath\",\n    value: function getComponentsPath(component, parent) {\n      // Get path to the component in the parent component.\n      var path = 'components';\n      var columnIndex = 0;\n      var tableRowIndex = 0;\n      var tableColumnIndex = 0;\n      var tabIndex = 0;\n\n      switch (parent.type) {\n        case 'table':\n          tableRowIndex = _lodash.default.findIndex(parent.rows, function (row) {\n            return row.some(function (column) {\n              return column.components.some(function (comp) {\n                return comp.key === component.key;\n              });\n            });\n          });\n          tableColumnIndex = _lodash.default.findIndex(parent.rows[tableRowIndex], function (column) {\n            return column.components.some(function (comp) {\n              return comp.key === component.key;\n            });\n          });\n          path = \"rows[\".concat(tableRowIndex, \"][\").concat(tableColumnIndex, \"].components\");\n          break;\n\n        case 'columns':\n          columnIndex = _lodash.default.findIndex(parent.columns, function (column) {\n            return column.components.some(function (comp) {\n              return comp.key === component.key;\n            });\n          });\n          path = \"columns[\".concat(columnIndex, \"].components\");\n          break;\n\n        case 'tabs':\n          tabIndex = _lodash.default.findIndex(parent.components, function (tab) {\n            return tab.components.some(function (comp) {\n              return comp.key === component.key;\n            });\n          });\n          path = \"components[\".concat(tabIndex, \"].components\");\n          break;\n      }\n\n      return path;\n    }\n    /* eslint-disable max-statements */\n\n  }, {\n    key: \"onDrop\",\n    value: function onDrop(element, target, source, sibling) {\n      var _this$groups$group,\n          _this8 = this;\n\n      if (!target) {\n        return;\n      } // If you try to drop within itself.\n\n\n      if (element.contains(target)) {\n        return;\n      }\n\n      var key = element.getAttribute('data-key');\n      var type = element.getAttribute('data-type');\n      var group = element.getAttribute('data-group');\n      var info, isNew, path, index;\n\n      if (key) {\n        // This is a new component.\n        info = this.getComponentInfo(key, group);\n\n        if (!info && type) {\n          info = this.getComponentInfo(type, group);\n        }\n\n        isNew = true;\n      } else if (source.formioContainer) {\n        index = _lodash.default.findIndex(source.formioContainer, {\n          key: element.formioComponent.component.key\n        });\n\n        if (index !== -1) {\n          // Grab and remove the component from the source container.\n          info = source.formioContainer.splice(_lodash.default.findIndex(source.formioContainer, {\n            key: element.formioComponent.component.key\n          }), 1); // Since splice returns an array of one object, we need to destructure it.\n\n          info = info[0];\n        }\n      } // If we haven't found the component, stop.\n\n\n      if (!info) {\n        return;\n      } // Show an error if siblings are disabled for a component and such a component already exists.\n\n\n      var draggableComponent = ((_this$groups$group = this.groups[group]) === null || _this$groups$group === void 0 ? void 0 : _this$groups$group.components[key]) || {};\n\n      if (draggableComponent.disableSiblings) {\n        var isCompAlreadyExists = false;\n        (0, _formUtils.eachComponent)(this.webform.components, function (component) {\n          if (component.key === draggableComponent.key) {\n            isCompAlreadyExists = true;\n            return;\n          }\n        }, true);\n\n        if (isCompAlreadyExists) {\n          this.webform.redraw();\n          this.webform.setAlert('danger', \"You cannot add more than one \".concat(draggableComponent.key, \" component to one page.\"));\n          return;\n        }\n      }\n\n      if (target !== source) {\n        // Ensure the key remains unique in its new container.\n        _builder.default.uniquify(this.findNamespaceRoot(target.formioComponent), info);\n      }\n\n      var parent = target.formioComponent; // Insert in the new container.\n\n      if (target.formioContainer) {\n        if (sibling) {\n          if (!sibling.getAttribute('data-noattach')) {\n            index = _lodash.default.findIndex(target.formioContainer, {\n              key: _lodash.default.get(sibling, 'formioComponent.component.key')\n            });\n            index = index === -1 ? 0 : index;\n          } else {\n            index = sibling.getAttribute('data-position');\n          }\n\n          if (index !== -1) {\n            target.formioContainer.splice(index, 0, info);\n          }\n        } else {\n          target.formioContainer.push(info);\n        }\n\n        path = this.getComponentsPath(info, parent.component);\n        index = _lodash.default.findIndex(_lodash.default.get(parent.schema, path), {\n          key: info.key\n        });\n\n        if (index === -1) {\n          index = 0;\n        }\n      }\n\n      if (parent && parent.addChildComponent) {\n        parent.addChildComponent(info, element, target, source, sibling);\n      }\n\n      var componentInDataGrid = parent.type === 'datagrid';\n\n      if (isNew && !this.options.noNewEdit && !info.noNewEdit) {\n        this.editComponent(info, target, isNew, null, null, {\n          inDataGrid: componentInDataGrid\n        });\n      } // Only rebuild the parts needing to be rebuilt.\n\n\n      var rebuild;\n\n      if (target !== source) {\n        if (source.formioContainer && source.contains(target)) {\n          rebuild = source.formioComponent.rebuild();\n        } else if (target.contains(source)) {\n          rebuild = target.formioComponent.rebuild();\n        } else {\n          if (source.formioContainer) {\n            rebuild = source.formioComponent.rebuild();\n          }\n\n          rebuild = target.formioComponent.rebuild();\n        }\n      } else {\n        // If they are the same, only rebuild one.\n        rebuild = target.formioComponent.rebuild();\n      }\n\n      if (!rebuild) {\n        rebuild = _nativePromiseOnly.default.resolve();\n      }\n\n      return rebuild.then(function () {\n        _this8.emit('addComponent', info, parent, path, index, isNew && !_this8.options.noNewEdit && !info.noNewEdit);\n\n        if (!isNew || _this8.options.noNewEdit || info.noNewEdit) {\n          _this8.emit('change', _this8.form);\n        }\n      });\n    }\n  }, {\n    key: \"setForm\",\n    value: function setForm(form) {\n      var _this9 = this;\n\n      if (!form.components) {\n        form.components = [];\n      }\n\n      var isShowSubmitButton = !this.options.noDefaultSubmitButton && !form.components.length; // Ensure there is at least a submit button.\n\n      if (isShowSubmitButton) {\n        form.components.push({\n          type: 'button',\n          label: 'Submit',\n          key: 'submit',\n          size: 'md',\n          block: false,\n          action: 'submit',\n          disableOnInvalid: true,\n          theme: 'primary'\n        });\n      }\n\n      if (this.webform) {\n        var shouldRebuild = !this.webform.form.components || form.components.length !== this.webform.form.components.length;\n        return this.webform.setForm(form, {\n          keepAsReference: true\n        }).then(function () {\n          if (_this9.refs.form) {\n            _this9.builderHeight = _this9.refs.form.offsetHeight;\n          }\n\n          if (!shouldRebuild) {\n            return _this9.form;\n          }\n\n          return _this9.rebuild().then(function () {\n            return _this9.form;\n          });\n        });\n      }\n\n      return _nativePromiseOnly.default.resolve(form);\n    }\n  }, {\n    key: \"populateRecaptchaSettings\",\n    value: function populateRecaptchaSettings(form) {\n      //populate isEnabled for recaptcha form settings\n      var isRecaptchaEnabled = false;\n\n      if (this.form.components) {\n        (0, _formUtils.eachComponent)(form.components, function (component) {\n          if (isRecaptchaEnabled) {\n            return;\n          }\n\n          if (component.type === 'recaptcha') {\n            isRecaptchaEnabled = true;\n            return false;\n          }\n        });\n\n        if (isRecaptchaEnabled) {\n          _lodash.default.set(form, 'settings.recaptcha.isEnabled', true);\n        } else if (_lodash.default.get(form, 'settings.recaptcha.isEnabled')) {\n          _lodash.default.set(form, 'settings.recaptcha.isEnabled', false);\n        }\n      }\n    }\n  }, {\n    key: \"removeComponent\",\n    value: function removeComponent(component, parent, original) {\n      var _this10 = this;\n\n      if (!parent) {\n        return;\n      }\n\n      var remove = true;\n      var removingComponentsGroup = !component.skipRemoveConfirm && (Array.isArray(component.components) && component.components.length || Array.isArray(component.rows) && component.rows.length || Array.isArray(component.columns) && component.columns.length);\n\n      if (this.options.alwaysConfirmComponentRemoval || removingComponentsGroup) {\n        var message = removingComponentsGroup ? 'Removing this component will also remove all of its children. Are you sure you want to do this?' : 'Are you sure you want to remove this component?';\n        remove = window.confirm(this.t(message));\n      }\n\n      if (!original) {\n        original = parent.formioContainer.find(function (comp) {\n          return comp.id === component.id;\n        });\n      }\n\n      var index = parent.formioContainer ? parent.formioContainer.indexOf(original) : 0;\n\n      if (remove && index !== -1) {\n        var path = this.getComponentsPath(component, parent.formioComponent.component);\n\n        if (parent.formioContainer) {\n          parent.formioContainer.splice(index, 1);\n        } else if (parent.formioComponent && parent.formioComponent.removeChildComponent) {\n          parent.formioComponent.removeChildComponent(component);\n        }\n\n        var rebuild = parent.formioComponent.rebuild() || _nativePromiseOnly.default.resolve();\n\n        rebuild.then(function () {\n          _this10.emit('removeComponent', component, parent.formioComponent.schema, path, index);\n\n          _this10.emit('change', _this10.form);\n        });\n      }\n\n      return remove;\n    }\n  }, {\n    key: \"updateComponent\",\n    value: function updateComponent(component, changed) {\n      // Update the preview.\n      if (this.preview) {\n        this.preview.form = {\n          components: [_lodash.default.omit(_objectSpread({}, component), ['hidden', 'conditional', 'calculateValue', 'logic', 'autofocus', 'customConditional'])],\n          config: this.options.formConfig || {}\n        };\n        var previewElement = this.componentEdit.querySelector('[ref=\"preview\"]');\n\n        if (previewElement) {\n          this.setContent(previewElement, this.preview.render());\n          this.preview.attach(previewElement);\n        }\n      } // Change the \"default value\" field to be reflective of this component.\n\n\n      var defaultValueComponent = (0, _formUtils.getComponent)(this.editForm.components, 'defaultValue', true);\n\n      if (defaultValueComponent && component.type !== 'hidden') {\n        var defaultChanged = changed && (changed.component && changed.component.key === 'defaultValue' || changed.instance && defaultValueComponent.hasComponent && defaultValueComponent.hasComponent(changed.instance));\n\n        if (!defaultChanged) {\n          _lodash.default.assign(defaultValueComponent.component, _lodash.default.omit(_objectSpread({}, component), ['key', 'label', 'placeholder', 'tooltip', 'hidden', 'autofocus', 'validate', 'disabled', 'defaultValue', 'customDefaultValue', 'calculateValue', 'conditional', 'customConditional', 'id']));\n\n          var parentComponent = defaultValueComponent.parent;\n          var tabIndex = -1;\n          var index = -1;\n          parentComponent.tabs.some(function (tab, tIndex) {\n            tab.some(function (comp, compIndex) {\n              if (comp.id === defaultValueComponent.id) {\n                tabIndex = tIndex;\n                index = compIndex;\n                return true;\n              }\n\n              return false;\n            });\n          });\n\n          if (tabIndex !== -1 && index !== -1) {\n            var sibling = parentComponent.tabs[tabIndex][index + 1];\n            parentComponent.removeComponent(defaultValueComponent);\n            var newComp = parentComponent.addComponent(defaultValueComponent.component, defaultValueComponent.data, sibling);\n\n            _lodash.default.pull(newComp.validators, 'required');\n\n            parentComponent.tabs[tabIndex].splice(index, 1, newComp);\n\n            newComp.checkValidity = function () {\n              return true;\n            };\n\n            newComp.build(defaultValueComponent.element);\n          }\n        } else {\n          this.preview._data[changed.instance._data.key] = changed.value;\n          this.webform._data[changed.instance._data.key] = changed.value;\n        }\n      } // Called when we update a component.\n\n\n      this.emit('updateComponent', component);\n    }\n  }, {\n    key: \"findRepeatablePaths\",\n    value: function findRepeatablePaths() {\n      var repeatablePaths = [];\n      var keys = new Map();\n      (0, _formUtils.eachComponent)(this.form.components, function (comp, path) {\n        if (!comp.key) {\n          return;\n        }\n\n        if (keys.has(comp.key)) {\n          if (keys.get(comp.key).includes(path)) {\n            repeatablePaths.push(path);\n          } else {\n            keys.set(comp.key, [].concat(_toConsumableArray(keys.get(comp.key)), [path]));\n          }\n        } else {\n          keys.set(comp.key, [path]);\n        }\n      });\n      return repeatablePaths;\n    }\n  }, {\n    key: \"highlightInvalidComponents\",\n    value: function highlightInvalidComponents() {\n      var repeatablePaths = this.findRepeatablePaths();\n      var hasInvalidComponents = false;\n      this.webform.everyComponent(function (comp) {\n        var _comp$error, _comp$error$message;\n\n        var path = comp.path;\n\n        if (repeatablePaths.includes(path)) {\n          comp.setCustomValidity(\"API Key is not unique: \".concat(comp.key));\n          hasInvalidComponents = true;\n        } else if ((_comp$error = comp.error) !== null && _comp$error !== void 0 && (_comp$error$message = _comp$error.message) !== null && _comp$error$message !== void 0 && _comp$error$message.startsWith('API Key is not unique')) {\n          comp.setCustomValidity('');\n        }\n      });\n      this.emit('builderFormValidityChange', hasInvalidComponents);\n    }\n    /**\n     * Called when a new component is saved.\n     *\n     * @param parent\n     * @param component\n     * @return {boolean}\n     */\n\n  }, {\n    key: \"saveComponent\",\n    value: function saveComponent(component, parent, isNew, original) {\n      var _this11 = this;\n\n      this.editForm.detach();\n      var parentContainer = parent ? parent.formioContainer : this.container;\n      var parentComponent = parent ? parent.formioComponent : this;\n      this.dialog.close();\n      var path = parentContainer ? this.getComponentsPath(component, parentComponent.component) : '';\n\n      if (!original) {\n        original = parent.formioContainer.find(function (comp) {\n          return comp.id === component.id;\n        });\n      }\n\n      var index = parentContainer ? parentContainer.indexOf(original) : 0;\n\n      if (index !== -1) {\n        var submissionData = this.editForm.submission.data;\n        submissionData = submissionData.componentJson || submissionData;\n        var comp = null;\n        parentComponent.getComponents().forEach(function (component) {\n          if (component.component.key === original.key) {\n            comp = component;\n          }\n        });\n        var originalComp = comp.component;\n        var originalComponentSchema = comp.schema;\n        var isParentSaveChildMethod = this.isParentSaveChildMethod(parent.formioComponent);\n\n        if (parentContainer && !isParentSaveChildMethod) {\n          parentContainer[index] = submissionData;\n\n          if (comp) {\n            comp.component = submissionData;\n          }\n        } else if (isParentSaveChildMethod) {\n          parent.formioComponent.saveChildComponent(submissionData);\n        }\n\n        var rebuild = parentComponent.rebuild() || _nativePromiseOnly.default.resolve();\n\n        return rebuild.then(function () {\n          var schema = parentContainer ? parentContainer[index] : comp ? comp.schema : [];\n\n          _this11.emitSaveComponentEvent(schema, originalComp, parentComponent.schema, path, index, isNew, originalComponentSchema);\n\n          _this11.emit('change', _this11.form);\n\n          _this11.highlightInvalidComponents();\n        });\n      }\n\n      this.highlightInvalidComponents();\n      return _nativePromiseOnly.default.resolve();\n    }\n  }, {\n    key: \"emitSaveComponentEvent\",\n    value: function emitSaveComponentEvent(schema, originalComp, parentComponentSchema, path, index, isNew, originalComponentSchema) {\n      this.emit('saveComponent', schema, originalComp, parentComponentSchema, path, index, isNew, originalComponentSchema);\n    }\n  }, {\n    key: \"editComponent\",\n    value: function editComponent(component, parent, isNew, isJsonEdit, original) {\n      var _this12 = this;\n\n      var flags = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n\n      if (!component.key) {\n        return;\n      }\n\n      var saved = false;\n      var componentCopy = (0, _utils.fastCloneDeep)(component);\n      var ComponentClass = _Components.default.components[componentCopy.type];\n      var isCustom = ComponentClass === undefined;\n      isJsonEdit = isJsonEdit || isCustom;\n      ComponentClass = isCustom ? _Components.default.components.unknown : ComponentClass; // Make sure we only have one dialog open at a time.\n\n      if (this.dialog) {\n        this.dialog.close();\n        this.highlightInvalidComponents();\n      } // This is the render step.\n\n\n      var editFormOptions = _lodash.default.clone(_lodash.default.get(this, 'options.editForm', {}));\n\n      if (this.editForm) {\n        this.editForm.destroy();\n      } // Allow editForm overrides per component.\n\n\n      var overrides = _lodash.default.get(this.options, \"editForm.\".concat(componentCopy.type), {}); // Pass along the form being edited.\n\n\n      editFormOptions.editForm = this.form;\n      editFormOptions.editComponent = component;\n      editFormOptions.flags = flags;\n      this.editForm = new _Webform.default(_objectSpread(_objectSpread({}, _lodash.default.omit(this.options, ['hooks', 'builder', 'events', 'attachMode', 'skipInit'])), {}, {\n        language: this.options.language\n      }, editFormOptions));\n      this.editForm.form = isJsonEdit && !isCustom ? {\n        components: [{\n          type: 'textarea',\n          as: 'json',\n          editor: 'ace',\n          weight: 10,\n          input: true,\n          key: 'componentJson',\n          label: 'Component JSON',\n          tooltip: 'Edit the JSON for this component.'\n        }, {\n          type: 'checkbox',\n          key: 'showFullSchema',\n          label: 'Full Schema'\n        }]\n      } : ComponentClass.editForm(_lodash.default.cloneDeep(overrides));\n      var instance = new ComponentClass(componentCopy);\n      this.editForm.submission = isJsonEdit ? {\n        data: {\n          componentJson: component,\n          showFullSchema: this.options.showFullJsonSchema\n        }\n      } : {\n        data: instance.component\n      };\n\n      if (this.preview) {\n        this.preview.destroy();\n      }\n\n      if (!ComponentClass.builderInfo.hasOwnProperty('preview') || ComponentClass.builderInfo.preview) {\n        this.preview = new _Webform.default(_lodash.default.omit(_objectSpread(_objectSpread({}, this.options), {}, {\n          preview: true\n        }), ['hooks', 'builder', 'events', 'attachMode', 'calculateValue']));\n      }\n\n      this.componentEdit = this.ce('div', {\n        'class': 'component-edit-container'\n      });\n      this.setContent(this.componentEdit, this.renderTemplate('builderEditForm', {\n        componentInfo: ComponentClass.builderInfo,\n        editForm: this.editForm.render(),\n        preview: this.preview ? this.preview.render() : false,\n        helplinks: this.helplinks\n      }));\n      this.dialog = this.createModal(this.componentEdit, _lodash.default.get(this.options, 'dialogAttr', {})); // This is the attach step.\n\n      this.editForm.attach(this.componentEdit.querySelector('[ref=\"editForm\"]'));\n      this.updateComponent(componentCopy);\n      this.editForm.on('change', function (event) {\n        if (event.changed) {\n          if (event.changed.component && event.changed.component.key === 'showFullSchema') {\n            var value = event.changed.value;\n            _this12.editForm.submission = {\n              data: {\n                componentJson: value ? instance.component : component,\n                showFullSchema: value\n              }\n            };\n            return;\n          } // See if this is a manually modified key. Treat custom component keys as manually modified\n\n\n          if (event.changed.component && event.changed.component.key === 'key' || isJsonEdit) {\n            componentCopy.keyModified = true;\n          }\n\n          if (event.changed.component && ['label', 'title'].includes(event.changed.component.key)) {\n            // Ensure this component has a key.\n            if (isNew) {\n              if (!event.data.keyModified) {\n                _this12.editForm.everyComponent(function (component) {\n                  if (component.key === 'key' && component.parent.component.key === 'tabs') {\n                    component.setValue(_lodash.default.camelCase(event.data.title || event.data.label || event.data.placeholder || event.data.type).replace(/^[0-9]*/, ''));\n                    return false;\n                  }\n                });\n              }\n\n              if (_this12.form) {\n                var formComponents = _this12.findNamespaceRoot(parent.formioComponent); // excluding component which key uniqueness is to be checked to prevent the comparing of the same keys\n\n\n                formComponents = formComponents.filter(function (comp) {\n                  return editFormOptions.editComponent.id !== comp.id;\n                }); // Set a unique key for this component.\n\n                _builder.default.uniquify(formComponents, event.data);\n              }\n            }\n          } // Update the component.\n\n\n          _this12.updateComponent(event.data.componentJson || event.data, event.changed);\n        }\n      });\n      this.addEventListener(this.componentEdit.querySelector('[ref=\"cancelButton\"]'), 'click', function (event) {\n        event.preventDefault();\n\n        _this12.editForm.detach();\n\n        _this12.emit('cancelComponent', component);\n\n        _this12.dialog.close();\n\n        _this12.highlightInvalidComponents();\n      });\n      this.addEventListener(this.componentEdit.querySelector('[ref=\"removeButton\"]'), 'click', function (event) {\n        event.preventDefault(); // Since we are already removing the component, don't trigger another remove.\n\n        saved = true;\n\n        _this12.editForm.detach();\n\n        _this12.removeComponent(component, parent, original);\n\n        _this12.dialog.close();\n\n        _this12.highlightInvalidComponents();\n      });\n      this.addEventListener(this.componentEdit.querySelector('[ref=\"saveButton\"]'), 'click', function (event) {\n        event.preventDefault();\n\n        if (!_this12.editForm.checkValidity(_this12.editForm.data, true, _this12.editForm.data)) {\n          _this12.editForm.setPristine(false);\n\n          _this12.editForm.showErrors();\n\n          return false;\n        }\n\n        saved = true;\n\n        _this12.saveComponent(component, parent, isNew, original);\n      });\n\n      var dialogClose = function dialogClose() {\n        _this12.editForm.destroy(true);\n\n        if (_this12.preview) {\n          _this12.preview.destroy(true);\n\n          _this12.preview = null;\n        }\n\n        if (isNew && !saved) {\n          _this12.removeComponent(component, parent, original);\n\n          _this12.highlightInvalidComponents();\n        } // Clean up.\n\n\n        _this12.removeEventListener(_this12.dialog, 'close', dialogClose);\n\n        _this12.dialog = null;\n      };\n\n      this.addEventListener(this.dialog, 'close', dialogClose); // Called when we edit a component.\n\n      this.emit('editComponent', component);\n    }\n    /**\n     * Creates copy of component schema and stores it under sessionStorage.\n     * @param {Component} component\n     * @return {*}\n     */\n\n  }, {\n    key: \"copyComponent\",\n    value: function copyComponent(component) {\n      if (!window.sessionStorage) {\n        return console.warn('Session storage is not supported in this browser.');\n      }\n\n      this.addClass(this.refs.form, 'builder-paste-mode');\n      window.sessionStorage.setItem('formio.clipboard', JSON.stringify(component.schema));\n    }\n    /**\n     * Paste copied component after the current component.\n     * @param {Component} component\n     * @return {*}\n     */\n\n  }, {\n    key: \"pasteComponent\",\n    value: function pasteComponent(component) {\n      if (!window.sessionStorage) {\n        return console.warn('Session storage is not supported in this browser.');\n      }\n\n      this.removeClass(this.refs.form, 'builder-paste-mode');\n\n      if (window.sessionStorage) {\n        var data = window.sessionStorage.getItem('formio.clipboard');\n\n        if (data) {\n          var schema = JSON.parse(data);\n          var parent = this.getParentElement(component.element);\n\n          if (parent) {\n            _builder.default.uniquify(this.findNamespaceRoot(parent.formioComponent), schema);\n\n            var path = '';\n            var index = 0;\n            var isParentSaveChildMethod = this.isParentSaveChildMethod(parent.formioComponent);\n\n            if (parent.formioContainer && !isParentSaveChildMethod) {\n              index = parent.formioContainer.indexOf(component.component);\n              path = this.getComponentsPath(schema, parent.formioComponent.component);\n              parent.formioContainer.splice(index + 1, 0, schema);\n            } else if (isParentSaveChildMethod) {\n              parent.formioComponent.saveChildComponent(schema, false);\n            }\n\n            parent.formioComponent.rebuild();\n            this.emitSaveComponentEvent(schema, schema, parent.formioComponent.component, path, index + 1, true, schema);\n          }\n\n          this.emit('change', this.form);\n        }\n      }\n    }\n  }, {\n    key: \"isParentSaveChildMethod\",\n    value: function isParentSaveChildMethod(parentComp) {\n      return !!(parentComp && parentComp.saveChildComponent);\n    }\n  }, {\n    key: \"getParentElement\",\n    value: function getParentElement(element) {\n      var container = element;\n\n      do {\n        container = container.parentNode;\n      } while (container && !container.formioComponent);\n\n      return container;\n    }\n  }, {\n    key: \"addBuilderComponentInfo\",\n    value: function addBuilderComponentInfo(component) {\n      if (!component || !component.group || !this.groups[component.group]) {\n        return;\n      }\n\n      component = _lodash.default.clone(component);\n      var groupInfo = this.groups[component.group];\n\n      if (!groupInfo.components.hasOwnProperty(component.key)) {\n        groupInfo.components[component.key] = component;\n      }\n\n      return component;\n    }\n  }, {\n    key: \"init\",\n    value: function init() {\n      if (this.webform) {\n        this.webform.init();\n      }\n\n      return _get(_getPrototypeOf(WebformBuilder.prototype), \"init\", this).call(this);\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      if (this.webform.initialized) {\n        this.webform.clear();\n      }\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy(deleteFromGlobal) {\n      if (this.webform.initialized) {\n        this.webform.destroy(deleteFromGlobal);\n      }\n\n      _get(_getPrototypeOf(WebformBuilder.prototype), \"destroy\", this).call(this, deleteFromGlobal);\n    }\n  }, {\n    key: \"addBuilderGroup\",\n    value: function addBuilderGroup(name, group) {\n      if (!this.groups[name]) {\n        this.groups[name] = group;\n        this.groupOrder.push(name);\n        this.triggerRedraw();\n      } else {\n        this.updateBuilderGroup(name, group);\n      }\n    }\n  }, {\n    key: \"updateBuilderGroup\",\n    value: function updateBuilderGroup(name, group) {\n      if (this.groups[name]) {\n        this.groups[name] = group;\n        this.triggerRedraw();\n      }\n    }\n  }]);\n\n  return WebformBuilder;\n}(_Component2.default);\n\nexports.default = WebformBuilder;"]},"metadata":{},"sourceType":"script"}